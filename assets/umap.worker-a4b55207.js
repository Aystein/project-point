(function(){"use strict";var I=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Lr(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var r=function t(){if(this instanceof t){var i=[null];i.push.apply(i,arguments);var o=Function.bind.apply(e,i);return new o}return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(n).forEach(function(t){var i=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(r,t,i.get?i:{enumerable:!0,get:function(){return n[t]}})}),r}var ke={},lt={},it={},C={},qr=I&&I.__values||function(n){var e=typeof Symbol=="function"&&n[Symbol.iterator],r=0;return e?e.call(n):{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}}};Object.defineProperty(C,"__esModule",{value:!0});function je(n,e){return Math.floor(e()*n)}C.tauRandInt=je;function Dr(n){return n()}C.tauRand=Dr;function Cr(n){var e,r,t=0;try{for(var i=qr(n),o=i.next();!o.done;o=i.next()){var s=o.value;t+=Math.pow(s,2)}}catch(u){e={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return Math.sqrt(t)}C.norm=Cr;function Ot(n){for(var e=[],r=0;r<n;r++)e.push(void 0);return e}C.empty=Ot;function Br(n){return Ot(n).map(function(e,r){return r})}C.range=Br;function se(n,e){return Ot(n).map(function(){return e})}C.filled=se;function Re(n){return se(n,0)}C.zeros=Re;function Ur(n){return se(n,1)}C.ones=Ur;function Yr(n,e,r){return Ot(r).map(function(t,i){return n+i*((e-n)/(r-1))})}C.linear=Yr;function $e(n){return n.reduce(function(e,r){return e+r})}C.sum=$e;function Gr(n){return $e(n)/n.length}C.mean=Gr;function Wr(n){for(var e=0,r=0;r<n.length;r++)e=n[r]>e?n[r]:e;return e}C.max=Wr;function Xr(n){for(var e=0,r=0;r<n.length;r++)for(var t=0;t<n[r].length;t++)e=n[r][t]>e?n[r][t]:e;return e}C.max2d=Xr;function Kr(n,e,r){for(var t=Re(n),i=0;i<n;i++)for(var o=!0;o;){for(var s=je(e,r),u=!1,h=0;h<i;h++)if(s===t[h]){u=!0;break}u||(o=!1),t[i]=s}return t}C.rejectionSample=Kr;function Qr(n,e,r){var t=[],i=0;if(n.length!==e*r)throw new Error("Array dimensions must match input length.");for(var o=0;o<e;o++){for(var s=[],u=0;u<r;u++)s.push(n[i]),i+=1;t.push(s)}return t}C.reshape2d=Qr;var Hr=I&&I.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var r in n)Object.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e.default=n,e};Object.defineProperty(it,"__esModule",{value:!0});var Et=Hr(C);function ze(n,e){var r=function(i){return Et.empty(n).map(function(){return Et.filled(e,i)})},t=[];return t.push(r(-1)),t.push(r(1/0)),t.push(r(0)),t}it.makeHeap=ze;function Jr(n,e,r){for(var t=Et.zeros(n),i=0;i<n;i++){for(var o=!0,s=0;o;){s=Et.tauRandInt(e,r);for(var u=!1,h=0;h<i;h++)if(s===t[h]){u=!0;break}u||(o=!1)}t[i]=s}return t}it.rejectionSample=Jr;function ue(n,e,r,t,i){e=Math.floor(e);var o=n[0][e],s=n[1][e];if(n[2][e],r>=s[0])return 0;for(var u=0;u<o.length;u++)if(t===o[u])return 0;return Ie(n,e,r,t,i)}it.heapPush=ue;function Ie(n,e,r,t,i){var o=n[0][e],s=n[1][e],u=n[2][e];if(r>=s[0])return 0;s[0]=r,o[0]=t,u[0]=i;for(var h=0,l=0;;){var a=2*h+1,f=a+1,c=n[0][0].length;if(a>=c)break;if(f>=c)if(s[a]>r)l=a;else break;else if(s[a]>=s[f])if(r<s[a])l=a;else break;else if(r<s[f])l=f;else break;s[h]=s[l],o[h]=o[l],u[h]=u[l],h=l}return s[h]=r,o[h]=t,u[h]=i,1}it.uncheckedHeapPush=Ie;function Zr(n,e,r,t,i){for(var o=ze(e,t),s=0;s<e;s++)for(var u=0;u<r;u++)if(!(n[0][s][u]<0)){var h=n[0][s][u],l=n[2][s][u],a=Et.tauRand(i);ue(o,s,a,h,l),ue(o,h,a,s,l),n[2][s][u]=0}return o}it.buildCandidates=Zr;function Ar(n){for(var e=n[0],r=n[1],t=0;t<e.length;t++)for(var i=e[t],o=r[t],s=0;s<i.length-1;s++){var u=i.length-s-1,h=o.length-s-1,l=i[0];i[0]=i[u],i[u]=l;var a=o[0];o[0]=o[h],o[h]=a,tn(o,i,h,0)}return{indices:e,weights:r}}it.deheapSort=Ar;function tn(n,e,r,t){for(;t*2+1<r;){var i=t*2+1,o=i+1,s=t;if(n[s]<n[i]&&(s=i),o<r&&n[s]<n[o]&&(s=o),s===t)break;var u=n[t];n[t]=n[s],n[s]=u;var h=e[t];e[t]=e[s],e[s]=h,t=s}}function en(n,e){for(var r=n[0][e],t=n[1][e],i=n[2][e],o=1/0,s=-1,u=0;u>r.length;u++)i[u]===1&&t[u]<o&&(o=t[u],s=u);return s>=0?(i[s]=0,Math.floor(r[s])):-1}it.smallestFlagged=en;var H={},Lt=I&&I.__read||function(n,e){var r=typeof Symbol=="function"&&n[Symbol.iterator];if(!r)return n;var t=r.call(n),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=t.next()).done;)o.push(i.value)}catch(u){s={error:u}}finally{try{i&&!i.done&&(r=t.return)&&r.call(t)}finally{if(s)throw s.error}}return o},rn=I&&I.__values||function(n){var e=typeof Symbol=="function"&&n[Symbol.iterator],r=0;return e?e.call(n):{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}}},nn=I&&I.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var r in n)Object.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e.default=n,e};Object.defineProperty(H,"__esModule",{value:!0});var _t,Pe=nn(C),pt=function(){function n(e,r,t,i){if(this.entries=new Map,this.nRows=0,this.nCols=0,e.length!==r.length||e.length!==t.length)throw new Error("rows, cols and values arrays must all have the same length");this.nRows=i[0],this.nCols=i[1];for(var o=0;o<t.length;o++){var s=e[o],u=r[o];this.checkDims(s,u);var h=this.makeKey(s,u);this.entries.set(h,{value:t[o],row:s,col:u})}}return n.prototype.makeKey=function(e,r){return e+":"+r},n.prototype.checkDims=function(e,r){var t=e<this.nRows&&r<this.nCols;if(!t)throw new Error("row and/or col specified outside of matrix dimensions")},n.prototype.set=function(e,r,t){this.checkDims(e,r);var i=this.makeKey(e,r);this.entries.has(i)?this.entries.get(i).value=t:this.entries.set(i,{value:t,row:e,col:r})},n.prototype.get=function(e,r,t){t===void 0&&(t=0),this.checkDims(e,r);var i=this.makeKey(e,r);return this.entries.has(i)?this.entries.get(i).value:t},n.prototype.getAll=function(e){e===void 0&&(e=!0);var r=[];return this.entries.forEach(function(t){r.push(t)}),e&&r.sort(function(t,i){return t.row===i.row?t.col-i.col:t.row-i.row}),r},n.prototype.getDims=function(){return[this.nRows,this.nCols]},n.prototype.getRows=function(){return Array.from(this.entries,function(e){var r=Lt(e,2);r[0];var t=r[1];return t.row})},n.prototype.getCols=function(){return Array.from(this.entries,function(e){var r=Lt(e,2);r[0];var t=r[1];return t.col})},n.prototype.getValues=function(){return Array.from(this.entries,function(e){var r=Lt(e,2);r[0];var t=r[1];return t.value})},n.prototype.forEach=function(e){this.entries.forEach(function(r){return e(r.value,r.row,r.col)})},n.prototype.map=function(e){var r=[];this.entries.forEach(function(i){r.push(e(i.value,i.row,i.col))});var t=[this.nRows,this.nCols];return new n(this.getRows(),this.getCols(),r,t)},n.prototype.toArray=function(){var e=this,r=Pe.empty(this.nRows),t=r.map(function(){return Pe.zeros(e.nCols)});return this.entries.forEach(function(i){t[i.row][i.col]=i.value}),t},n}();H.SparseMatrix=pt;function on(n){var e=[],r=[],t=[];n.forEach(function(o,s,u){e.push(s),r.push(u),t.push(o)});var i=[n.nCols,n.nRows];return new pt(r,e,t,i)}H.transpose=on;function sn(n){for(var e=Lt(n,1),r=e[0],t=new pt([],[],[],n),i=0;i<r;i++)t.set(i,i,1);return t}H.identity=sn;function un(n,e){return qt(n,e,function(r,t){return r*t})}H.pairwiseMultiply=un;function ln(n,e){return qt(n,e,function(r,t){return r+t})}H.add=ln;function hn(n,e){return qt(n,e,function(r,t){return r-t})}H.subtract=hn;function an(n,e){return qt(n,e,function(r,t){return r>t?r:t})}H.maximum=an;function fn(n,e){return n.map(function(r){return r*e})}H.multiplyScalar=fn;function cn(n){for(var e=new Set,r=n.getValues(),t=n.getRows(),i=n.getCols(),o=0;o<r.length;o++)r[o]===0&&e.add(o);var s=function(a,f){return!e.has(f)},u=r.filter(s),h=t.filter(s),l=i.filter(s);return new pt(h,l,u,n.getDims())}H.eliminateZeros=cn;function gn(n,e){e===void 0&&(e="l2");var r,t,i=mn[e],o=new Map;n.forEach(function(f,c,w){var p=o.get(c)||[];p.push(w),o.set(c,p)});var s=new pt([],[],[],n.getDims()),u=function(f){for(var c=o.get(f).sort(),w=c.map(function(d){return n.get(f,d)}),p=i(w),m=0;m<p.length;m++)s.set(f,c[m],p[m])};try{for(var h=rn(o.keys()),l=h.next();!l.done;l=h.next()){var a=l.value;u(a)}}catch(f){r={error:f}}finally{try{l&&!l.done&&(t=h.return)&&t.call(h)}finally{if(r)throw r.error}}return s}H.normalize=gn;var mn=(_t={},_t.max=function(n){for(var e=-1/0,r=0;r<n.length;r++)e=n[r]>e?n[r]:e;return n.map(function(t){return t/e})},_t.l1=function(n){for(var e=0,r=0;r<n.length;r++)e+=n[r];return n.map(function(t){return t/e})},_t.l2=function(n){for(var e=0,r=0;r<n.length;r++)e+=Math.pow(n[r],2);return n.map(function(t){return Math.sqrt(Math.pow(t,2)/e)})},_t);function qt(n,e,r){for(var t=new Set,i=[],o=[],s=[],u=function(N,S){i.push(N),o.push(S);var E=r(n.get(N,S),e.get(N,S));s.push(E)},h=n.getValues(),l=n.getRows(),a=n.getCols(),f=0;f<h.length;f++){var c=l[f],w=a[f],p=c+":"+w;t.add(p),u(c,w)}for(var m=e.getValues(),d=e.getRows(),v=e.getCols(),f=0;f<m.length;f++){var c=d[f],w=v[f],p=c+":"+w;t.has(p)||u(c,w)}var M=[n.nRows,n.nCols];return new pt(i,o,s,M)}function pn(n){var e=[];n.forEach(function(f,c,w){e.push({value:f,row:c,col:w})}),e.sort(function(f,c){return f.row===c.row?f.col-c.col:f.row-c.row});for(var r=[],t=[],i=[],o=-1,s=0;s<e.length;s++){var u=e[s],h=u.row,l=u.col,a=u.value;h!==o&&(o=h,i.push(s)),r.push(l),t.push(a)}return{indices:r,values:t,indptr:i}}H.getCSR=pn;var wt={},at={},wn=I&&I.__read||function(n,e){var r=typeof Symbol=="function"&&n[Symbol.iterator];if(!r)return n;var t=r.call(n),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=t.next()).done;)o.push(i.value)}catch(u){s={error:u}}finally{try{i&&!i.done&&(r=t.return)&&r.call(t)}finally{if(s)throw s.error}}return o},Te=I&&I.__spread||function(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(wn(arguments[e]));return n},vn=I&&I.__values||function(n){var e=typeof Symbol=="function"&&n[Symbol.iterator],r=0;return e?e.call(n):{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}}},dn=I&&I.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var r in n)Object.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e.default=n,e};Object.defineProperty(at,"__esModule",{value:!0});var W=dn(C),Fe=function(){function n(e,r,t,i){this.hyperplanes=e,this.offsets=r,this.children=t,this.indices=i}return n}();at.FlatTree=Fe;function yn(n,e,r,t){var i=Math.max(10,e),o=W.range(r).map(function(u,h){return xn(n,i,h,t)}),s=o.map(function(u){return Mn(u,i)});return s}at.makeForest=yn;function xn(n,e,r,t){e===void 0&&(e=30);var i=W.range(n.length),o=le(n,i,e,r,t);return o}function le(n,e,r,t,i){if(r===void 0&&(r=30),e.length>r){var o=bn(n,e,i),s=o.indicesLeft,u=o.indicesRight,h=o.hyperplane,l=o.offset,a=le(n,s,r,t+1,i),f=le(n,u,r,t+1,i),c={leftChild:a,rightChild:f,isLeaf:!1,hyperplane:h,offset:l};return c}else{var c={indices:e,isLeaf:!0};return c}}function bn(n,e,r){var t=n[0].length,i=W.tauRandInt(e.length,r),o=W.tauRandInt(e.length,r);o+=i===o?1:0,o=o%e.length;for(var s=e[i],u=e[o],h=0,l=W.zeros(t),a=0;a<l.length;a++)l[a]=n[s][a]-n[u][a],h-=l[a]*(n[s][a]+n[u][a])/2;for(var f=0,c=0,w=W.zeros(e.length),a=0;a<e.length;a++){for(var p=h,m=0;m<t;m++)p+=l[m]*n[e[a]][m];p===0?(w[a]=W.tauRandInt(2,r),w[a]===0?f+=1:c+=1):p>0?(w[a]=0,f+=1):(w[a]=1,c+=1)}var d=W.zeros(f),v=W.zeros(c);f=0,c=0;for(var a=0;a<w.length;a++)w[a]===0?(d[f]=e[a],f+=1):(v[c]=e[a],c+=1);return{indicesLeft:d,indicesRight:v,hyperplane:l,offset:h}}function Mn(n,e){var r=ae(n),t=fe(n),i=W.range(r).map(function(){return W.zeros(n.hyperplane?n.hyperplane.length:0)}),o=W.zeros(r),s=W.range(r).map(function(){return[-1,-1]}),u=W.range(t).map(function(){return W.range(e).map(function(){return-1})});return he(n,i,o,s,u,0,0),new Fe(i,o,s,u)}function he(n,e,r,t,i,o,s){var u;if(n.isLeaf)return t[o][0]=-s,(u=i[s]).splice.apply(u,Te([0,n.indices.length],n.indices)),s+=1,{nodeNum:o,leafNum:s};e[o]=n.hyperplane,r[o]=n.offset,t[o][0]=o+1;var h=o,l=he(n.leftChild,e,r,t,i,o+1,s);return o=l.nodeNum,s=l.leafNum,t[h][1]=o+1,l=he(n.rightChild,e,r,t,i,o+1,s),{nodeNum:l.nodeNum,leafNum:l.leafNum}}function ae(n){return n.isLeaf?1:1+ae(n.leftChild)+ae(n.rightChild)}function fe(n){return n.isLeaf?1:fe(n.leftChild)+fe(n.rightChild)}function Sn(n){var e,r;if(n.length>0){var t=[];try{for(var i=vn(n),o=i.next();!o.done;o=i.next()){var s=o.value;t.push.apply(t,Te(s.indices))}}catch(u){e={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return t}else return[[-1]]}at.makeLeafArray=Sn;function Nn(n,e,r,t){for(var i=e,o=0;o<r.length;o++)i+=n[o]*r[o];if(i===0){var s=W.tauRandInt(2,t);return s}else return i>0?0:1}function En(n,e,r){for(var t=0;e.children[t][0]>0;){var i=Nn(e.hyperplanes[t],e.offsets[t],n,r);i===0?t=e.children[t][0]:t=e.children[t][1]}var o=-1*e.children[t][0];return e.indices[o]}at.searchFlatTree=En;var Ve=I&&I.__values||function(n){var e=typeof Symbol=="function"&&n[Symbol.iterator],r=0;return e?e.call(n):{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}}},Dt=I&&I.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var r in n)Object.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e.default=n,e};Object.defineProperty(wt,"__esModule",{value:!0});var X=Dt(it),_n=Dt(H),kn=Dt(at),Oe=Dt(C);function jn(n,e){return function(t,i,o,s,u,h,l,a){s===void 0&&(s=10),u===void 0&&(u=50),h===void 0&&(h=.001),l===void 0&&(l=.5),a===void 0&&(a=!0);for(var f=t.length,c=X.makeHeap(t.length,o),w=0;w<t.length;w++)for(var p=X.rejectionSample(o,t.length,e),m=0;m<p.length;m++){var d=n(t[w],t[p[m]]);X.heapPush(c,w,d,p[m],1),X.heapPush(c,p[m],d,w,1)}if(a)for(var v=0;v<i.length;v++)for(var w=0;w<i[v].length&&!(i[v][w]<0);w++)for(var m=w+1;m<i[v].length&&!(i[v][m]<0);m++){var d=n(t[i[v][w]],t[i[v][m]]);X.heapPush(c,i[v][w],d,i[v][m],1),X.heapPush(c,i[v][m],d,i[v][w],1)}for(var v=0;v<s;v++){for(var M=X.buildCandidates(c,f,o,u,e),N=0,w=0;w<f;w++)for(var m=0;m<u;m++){var S=Math.floor(M[0][w][m]);if(!(S<0||Oe.tauRand(e)<l))for(var E=0;E<u;E++){var F=Math.floor(M[0][w][E]),k=M[2][w][m],j=M[2][w][E];if(!(F<0||!k&&!j)){var d=n(t[S],t[F]);N+=X.heapPush(c,S,d,F,1),N+=X.heapPush(c,F,d,S,1)}}}if(N<=h*o*t.length)break}var q=X.deheapSort(c);return q}}wt.makeNNDescent=jn;function Rn(n){function e(t,i,o,s,u){for(var h=0;h<o.length;h++)for(var l=Oe.rejectionSample(t,i.length,u),a=0;a<l.length;a++)if(!(l[a]<0)){var f=n(i[l[a]],o[h]);X.heapPush(s,h,f,l[a],1)}}function r(t,i,o,s,u){for(var h=0;h<o.length;h++)for(var l=kn.searchFlatTree(o[h],t,u),a=0;a<l.length;a++){if(l[a]<0)return;var f=n(i[l[a]],o[h]);X.heapPush(s,h,f,l[a],1)}}return{initFromRandom:e,initFromTree:r}}wt.makeInitializations=Rn;function $n(n){return function(r,t,i,o){for(var s,u,h=_n.getCSR(t),l=h.indices,a=h.indptr,f=0;f<o.length;f++)for(var c=new Set(i[0][f]);;){var w=X.smallestFlagged(i,f);if(w===-1)break;var p=l.slice(a[w],a[w+1]);try{for(var m=Ve(p),d=m.next();!d.done;d=m.next()){var v=d.value;if(!(v===w||v===-1||c.has(v))){var M=n(r[v],o[f]);X.uncheckedHeapPush(i,f,M,v,1),c.add(v)}}}catch(N){s={error:N}}finally{try{d&&!d.done&&(u=m.return)&&u.call(m)}finally{if(s)throw s.error}}}return i}}wt.makeInitializedNNSearch=$n;function zn(n,e,r,t,i,o,s){var u,h,l=X.makeHeap(r.length,t);if(i(t,e,r,l,s),n)try{for(var a=Ve(n),f=a.next();!f.done;f=a.next()){var c=f.value;o(c,e,r,l,s)}}catch(w){u={error:w}}finally{try{f&&!f.done&&(h=a.return)&&h.call(a)}finally{if(u)throw u.error}}return l}wt.initializeSearch=zn;const In=Object.prototype.toString;function ce(n){return In.call(n).endsWith("Array]")}function Le(n,e,r){let t=0;const i=r(e);for(let o=0;o<n.x.length;o++)t+=Math.abs(n.y[o]-i(n.x[o]));return t}const Pn=Object.prototype.toString;function Z(n){const e=Pn.call(n);return e.endsWith("Array]")&&!e.includes("Big")}function Tn(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Z(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var r=e.fromIndex,t=r===void 0?0:r,i=e.toIndex,o=i===void 0?n.length:i;if(t<0||t>=n.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=t||o>n.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var s=n[t],u=t+1;u<o;u++)n[u]>s&&(s=n[u]);return s}function Fn(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Z(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var r=e.fromIndex,t=r===void 0?0:r,i=e.toIndex,o=i===void 0?n.length:i;if(t<0||t>=n.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=t||o>n.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var s=n[t],u=t+1;u<o;u++)n[u]<s&&(s=n[u]);return s}function qe(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Z(n)){if(n.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var r;if(e.output!==void 0){if(!Z(e.output))throw new TypeError("output option must be an array if specified");r=e.output}else r=new Array(n.length);var t=Fn(n),i=Tn(n);if(t===i)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var o=e.min,s=o===void 0?e.autoMinMax?t:0:o,u=e.max,h=u===void 0?e.autoMinMax?i:1:u;if(s>=h)throw new RangeError("min option must be smaller than max option");for(var l=(h-s)/(i-t),a=0;a<n.length;a++)r[a]=(n[a]-t)*l+s;return r}const Ct=" ".repeat(2),De=" ".repeat(4);function Vn(){return Ce(this)}function Ce(n,e={}){const{maxRows:r=15,maxColumns:t=10,maxNumSize:i=8,padMinus:o="auto"}=e;return`${n.constructor.name} {
${Ct}[
${De}${On(n,r,t,i,o)}
${Ct}]
${Ct}rows: ${n.rows}
${Ct}columns: ${n.columns}
}`}function On(n,e,r,t,i){const{rows:o,columns:s}=n,u=Math.min(o,e),h=Math.min(s,r),l=[];if(i==="auto"){i=!1;t:for(let a=0;a<u;a++)for(let f=0;f<h;f++)if(n.get(a,f)<0){i=!0;break t}}for(let a=0;a<u;a++){let f=[];for(let c=0;c<h;c++)f.push(Ln(n.get(a,c),t,i));l.push(`${f.join(" ")}`)}return h!==s&&(l[l.length-1]+=` ... ${s-r} more columns`),u!==o&&l.push(`... ${o-e} more rows`),l.join(`
${De}`)}function Ln(n,e,r){return(n>=0&&r?` ${Be(n,e-1)}`:Be(n,e)).padEnd(e)}function Be(n,e){let r=n.toString();if(r.length<=e)return r;let t=n.toFixed(e);if(t.length>e&&(t=n.toFixed(Math.max(0,e-(t.length-e)))),t.length<=e&&!t.startsWith("0.000")&&!t.startsWith("-0.000"))return t;let i=n.toExponential(e);return i.length>e&&(i=n.toExponential(Math.max(0,e-(i.length-e)))),i.slice(0)}function qn(n,e){n.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},n.prototype.addS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)+t);return this},n.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)+t.get(i,o));return this},n.add=function(t,i){return new e(t).add(i)},n.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},n.prototype.subS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)-t);return this},n.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)-t.get(i,o));return this},n.sub=function(t,i){return new e(t).sub(i)},n.prototype.subtract=n.prototype.sub,n.prototype.subtractS=n.prototype.subS,n.prototype.subtractM=n.prototype.subM,n.subtract=n.sub,n.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},n.prototype.mulS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)*t);return this},n.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)*t.get(i,o));return this},n.mul=function(t,i){return new e(t).mul(i)},n.prototype.multiply=n.prototype.mul,n.prototype.multiplyS=n.prototype.mulS,n.prototype.multiplyM=n.prototype.mulM,n.multiply=n.mul,n.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},n.prototype.divS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)/t);return this},n.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)/t.get(i,o));return this},n.div=function(t,i){return new e(t).div(i)},n.prototype.divide=n.prototype.div,n.prototype.divideS=n.prototype.divS,n.prototype.divideM=n.prototype.divM,n.divide=n.div,n.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},n.prototype.modS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)%t);return this},n.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)%t.get(i,o));return this},n.mod=function(t,i){return new e(t).mod(i)},n.prototype.modulus=n.prototype.mod,n.prototype.modulusS=n.prototype.modS,n.prototype.modulusM=n.prototype.modM,n.modulus=n.mod,n.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},n.prototype.andS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)&t);return this},n.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)&t.get(i,o));return this},n.and=function(t,i){return new e(t).and(i)},n.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},n.prototype.orS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)|t);return this},n.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)|t.get(i,o));return this},n.or=function(t,i){return new e(t).or(i)},n.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},n.prototype.xorS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)^t);return this},n.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)^t.get(i,o));return this},n.xor=function(t,i){return new e(t).xor(i)},n.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},n.prototype.leftShiftS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)<<t);return this},n.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)<<t.get(i,o));return this},n.leftShift=function(t,i){return new e(t).leftShift(i)},n.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},n.prototype.signPropagatingRightShiftS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)>>t);return this},n.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)>>t.get(i,o));return this},n.signPropagatingRightShift=function(t,i){return new e(t).signPropagatingRightShift(i)},n.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},n.prototype.rightShiftS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)>>>t);return this},n.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)>>>t.get(i,o));return this},n.rightShift=function(t,i){return new e(t).rightShift(i)},n.prototype.zeroFillRightShift=n.prototype.rightShift,n.prototype.zeroFillRightShiftS=n.prototype.rightShiftS,n.prototype.zeroFillRightShiftM=n.prototype.rightShiftM,n.zeroFillRightShift=n.rightShift,n.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,~this.get(t,i));return this},n.not=function(t){return new e(t).not()},n.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.abs(this.get(t,i)));return this},n.abs=function(t){return new e(t).abs()},n.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.acos(this.get(t,i)));return this},n.acos=function(t){return new e(t).acos()},n.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.acosh(this.get(t,i)));return this},n.acosh=function(t){return new e(t).acosh()},n.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.asin(this.get(t,i)));return this},n.asin=function(t){return new e(t).asin()},n.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.asinh(this.get(t,i)));return this},n.asinh=function(t){return new e(t).asinh()},n.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.atan(this.get(t,i)));return this},n.atan=function(t){return new e(t).atan()},n.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.atanh(this.get(t,i)));return this},n.atanh=function(t){return new e(t).atanh()},n.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.cbrt(this.get(t,i)));return this},n.cbrt=function(t){return new e(t).cbrt()},n.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.ceil(this.get(t,i)));return this},n.ceil=function(t){return new e(t).ceil()},n.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.clz32(this.get(t,i)));return this},n.clz32=function(t){return new e(t).clz32()},n.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.cos(this.get(t,i)));return this},n.cos=function(t){return new e(t).cos()},n.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.cosh(this.get(t,i)));return this},n.cosh=function(t){return new e(t).cosh()},n.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.exp(this.get(t,i)));return this},n.exp=function(t){return new e(t).exp()},n.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.expm1(this.get(t,i)));return this},n.expm1=function(t){return new e(t).expm1()},n.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.floor(this.get(t,i)));return this},n.floor=function(t){return new e(t).floor()},n.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.fround(this.get(t,i)));return this},n.fround=function(t){return new e(t).fround()},n.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.log(this.get(t,i)));return this},n.log=function(t){return new e(t).log()},n.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.log1p(this.get(t,i)));return this},n.log1p=function(t){return new e(t).log1p()},n.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.log10(this.get(t,i)));return this},n.log10=function(t){return new e(t).log10()},n.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.log2(this.get(t,i)));return this},n.log2=function(t){return new e(t).log2()},n.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.round(this.get(t,i)));return this},n.round=function(t){return new e(t).round()},n.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.sign(this.get(t,i)));return this},n.sign=function(t){return new e(t).sign()},n.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.sin(this.get(t,i)));return this},n.sin=function(t){return new e(t).sin()},n.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.sinh(this.get(t,i)));return this},n.sinh=function(t){return new e(t).sinh()},n.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.sqrt(this.get(t,i)));return this},n.sqrt=function(t){return new e(t).sqrt()},n.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.tan(this.get(t,i)));return this},n.tan=function(t){return new e(t).tan()},n.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.tanh(this.get(t,i)));return this},n.tanh=function(t){return new e(t).tanh()},n.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.trunc(this.get(t,i)));return this},n.trunc=function(t){return new e(t).trunc()},n.pow=function(t,i){return new e(t).pow(i)},n.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},n.prototype.powS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,Math.pow(this.get(i,o),t));return this},n.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,Math.pow(this.get(i,o),t.get(i,o)));return this}}function et(n,e,r){let t=r?n.rows:n.rows-1;if(e<0||e>t)throw new RangeError("Row index out of range")}function rt(n,e,r){let t=r?n.columns:n.columns-1;if(e<0||e>t)throw new RangeError("Column index out of range")}function vt(n,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==n.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function dt(n,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==n.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function Dn(n,e){if(!Z(e))throw new TypeError("row indices must be an array");for(let r=0;r<e.length;r++)if(e[r]<0||e[r]>=n.rows)throw new RangeError("row indices are out of range")}function Cn(n,e){if(!Z(e))throw new TypeError("column indices must be an array");for(let r=0;r<e.length;r++)if(e[r]<0||e[r]>=n.columns)throw new RangeError("column indices are out of range")}function Ue(n,e,r,t,i){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(Ut("startRow",e),Ut("endRow",r),Ut("startColumn",t),Ut("endColumn",i),e>r||t>i||e<0||e>=n.rows||r<0||r>=n.rows||t<0||t>=n.columns||i<0||i>=n.columns)throw new RangeError("Submatrix indices are out of range")}function Bt(n,e=0){let r=[];for(let t=0;t<n;t++)r.push(e);return r}function Ut(n,e){if(typeof e!="number")throw new TypeError(`${n} must be a number`)}function yt(n){if(n.isEmpty())throw new Error("Empty matrix has no elements to index")}function Bn(n){let e=Bt(n.rows);for(let r=0;r<n.rows;++r)for(let t=0;t<n.columns;++t)e[r]+=n.get(r,t);return e}function Un(n){let e=Bt(n.columns);for(let r=0;r<n.rows;++r)for(let t=0;t<n.columns;++t)e[t]+=n.get(r,t);return e}function Yn(n){let e=0;for(let r=0;r<n.rows;r++)for(let t=0;t<n.columns;t++)e+=n.get(r,t);return e}function Gn(n){let e=Bt(n.rows,1);for(let r=0;r<n.rows;++r)for(let t=0;t<n.columns;++t)e[r]*=n.get(r,t);return e}function Wn(n){let e=Bt(n.columns,1);for(let r=0;r<n.rows;++r)for(let t=0;t<n.columns;++t)e[t]*=n.get(r,t);return e}function Xn(n){let e=1;for(let r=0;r<n.rows;r++)for(let t=0;t<n.columns;t++)e*=n.get(r,t);return e}function Kn(n,e,r){const t=n.rows,i=n.columns,o=[];for(let s=0;s<t;s++){let u=0,h=0,l=0;for(let a=0;a<i;a++)l=n.get(s,a)-r[s],u+=l,h+=l*l;e?o.push((h-u*u/i)/(i-1)):o.push((h-u*u/i)/i)}return o}function Qn(n,e,r){const t=n.rows,i=n.columns,o=[];for(let s=0;s<i;s++){let u=0,h=0,l=0;for(let a=0;a<t;a++)l=n.get(a,s)-r[s],u+=l,h+=l*l;e?o.push((h-u*u/t)/(t-1)):o.push((h-u*u/t)/t)}return o}function Hn(n,e,r){const t=n.rows,i=n.columns,o=t*i;let s=0,u=0,h=0;for(let l=0;l<t;l++)for(let a=0;a<i;a++)h=n.get(l,a)-r,s+=h,u+=h*h;return e?(u-s*s/o)/(o-1):(u-s*s/o)/o}function Jn(n,e){for(let r=0;r<n.rows;r++)for(let t=0;t<n.columns;t++)n.set(r,t,n.get(r,t)-e[r])}function Zn(n,e){for(let r=0;r<n.rows;r++)for(let t=0;t<n.columns;t++)n.set(r,t,n.get(r,t)-e[t])}function An(n,e){for(let r=0;r<n.rows;r++)for(let t=0;t<n.columns;t++)n.set(r,t,n.get(r,t)-e)}function ti(n){const e=[];for(let r=0;r<n.rows;r++){let t=0;for(let i=0;i<n.columns;i++)t+=Math.pow(n.get(r,i),2)/(n.columns-1);e.push(Math.sqrt(t))}return e}function ei(n,e){for(let r=0;r<n.rows;r++)for(let t=0;t<n.columns;t++)n.set(r,t,n.get(r,t)/e[r])}function ri(n){const e=[];for(let r=0;r<n.columns;r++){let t=0;for(let i=0;i<n.rows;i++)t+=Math.pow(n.get(i,r),2)/(n.rows-1);e.push(Math.sqrt(t))}return e}function ni(n,e){for(let r=0;r<n.rows;r++)for(let t=0;t<n.columns;t++)n.set(r,t,n.get(r,t)/e[t])}function ii(n){const e=n.size-1;let r=0;for(let t=0;t<n.columns;t++)for(let i=0;i<n.rows;i++)r+=Math.pow(n.get(i,t),2)/e;return Math.sqrt(r)}function oi(n,e){for(let r=0;r<n.rows;r++)for(let t=0;t<n.columns;t++)n.set(r,t,n.get(r,t)/e)}class R{static from1DArray(e,r,t){if(e*r!==t.length)throw new RangeError("data length does not match given dimensions");let o=new _(e,r);for(let s=0;s<e;s++)for(let u=0;u<r;u++)o.set(s,u,t[s*r+u]);return o}static rowVector(e){let r=new _(1,e.length);for(let t=0;t<e.length;t++)r.set(0,t,e[t]);return r}static columnVector(e){let r=new _(e.length,1);for(let t=0;t<e.length;t++)r.set(t,0,e[t]);return r}static zeros(e,r){return new _(e,r)}static ones(e,r){return new _(e,r).fill(1)}static rand(e,r,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{random:i=Math.random}=t;let o=new _(e,r);for(let s=0;s<e;s++)for(let u=0;u<r;u++)o.set(s,u,i());return o}static randInt(e,r,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:i=0,max:o=1e3,random:s=Math.random}=t;if(!Number.isInteger(i))throw new TypeError("min must be an integer");if(!Number.isInteger(o))throw new TypeError("max must be an integer");if(i>=o)throw new RangeError("min must be smaller than max");let u=o-i,h=new _(e,r);for(let l=0;l<e;l++)for(let a=0;a<r;a++){let f=i+Math.round(s()*u);h.set(l,a,f)}return h}static eye(e,r,t){r===void 0&&(r=e),t===void 0&&(t=1);let i=Math.min(e,r),o=this.zeros(e,r);for(let s=0;s<i;s++)o.set(s,s,t);return o}static diag(e,r,t){let i=e.length;r===void 0&&(r=i),t===void 0&&(t=r);let o=Math.min(i,r,t),s=this.zeros(r,t);for(let u=0;u<o;u++)s.set(u,u,e[u]);return s}static min(e,r){e=this.checkMatrix(e),r=this.checkMatrix(r);let t=e.rows,i=e.columns,o=new _(t,i);for(let s=0;s<t;s++)for(let u=0;u<i;u++)o.set(s,u,Math.min(e.get(s,u),r.get(s,u)));return o}static max(e,r){e=this.checkMatrix(e),r=this.checkMatrix(r);let t=e.rows,i=e.columns,o=new this(t,i);for(let s=0;s<t;s++)for(let u=0;u<i;u++)o.set(s,u,Math.max(e.get(s,u),r.get(s,u)));return o}static checkMatrix(e){return R.isMatrix(e)?e:new _(e)}static isMatrix(e){return e!=null&&e.klass==="Matrix"}get size(){return this.rows*this.columns}apply(e){if(typeof e!="function")throw new TypeError("callback must be a function");for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.call(this,r,t);return this}to1DArray(){let e=[];for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.push(this.get(r,t));return e}to2DArray(){let e=[];for(let r=0;r<this.rows;r++){e.push([]);for(let t=0;t<this.columns;t++)e[r].push(this.get(r,t))}return e}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let r=0;r<=e;r++)if(this.get(e,r)!==this.get(r,e))return!1;return!0}return!1}isEchelonForm(){let e=0,r=0,t=-1,i=!0,o=!1;for(;e<this.rows&&i;){for(r=0,o=!1;r<this.columns&&o===!1;)this.get(e,r)===0?r++:this.get(e,r)===1&&r>t?(o=!0,t=r):(i=!1,o=!0);e++}return i}isReducedEchelonForm(){let e=0,r=0,t=-1,i=!0,o=!1;for(;e<this.rows&&i;){for(r=0,o=!1;r<this.columns&&o===!1;)this.get(e,r)===0?r++:this.get(e,r)===1&&r>t?(o=!0,t=r):(i=!1,o=!0);for(let s=r+1;s<this.rows;s++)this.get(e,s)!==0&&(i=!1);e++}return i}echelonForm(){let e=this.clone(),r=0,t=0;for(;r<e.rows&&t<e.columns;){let i=r;for(let o=r;o<e.rows;o++)e.get(o,t)>e.get(i,t)&&(i=o);if(e.get(i,t)===0)t++;else{e.swapRows(r,i);let o=e.get(r,t);for(let s=t;s<e.columns;s++)e.set(r,s,e.get(r,s)/o);for(let s=r+1;s<e.rows;s++){let u=e.get(s,t)/e.get(r,t);e.set(s,t,0);for(let h=t+1;h<e.columns;h++)e.set(s,h,e.get(s,h)-e.get(r,h)*u)}r++,t++}}return e}reducedEchelonForm(){let e=this.echelonForm(),r=e.columns,t=e.rows,i=t-1;for(;i>=0;)if(e.maxRow(i)===0)i--;else{let o=0,s=!1;for(;o<t&&s===!1;)e.get(i,o)===1?s=!0:o++;for(let u=0;u<i;u++){let h=e.get(u,o);for(let l=o;l<r;l++){let a=e.get(u,l)-h*e.get(i,l);e.set(u,l,a)}}i--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{rows:r=1,columns:t=1}=e;if(!Number.isInteger(r)||r<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let i=new _(this.rows*r,this.columns*t);for(let o=0;o<r;o++)for(let s=0;s<t;s++)i.setSubMatrix(this,this.rows*o,this.columns*s);return i}fill(e){for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,e);return this}neg(){return this.mulS(-1)}getRow(e){et(this,e);let r=[];for(let t=0;t<this.columns;t++)r.push(this.get(e,t));return r}getRowVector(e){return _.rowVector(this.getRow(e))}setRow(e,r){et(this,e),r=vt(this,r);for(let t=0;t<this.columns;t++)this.set(e,t,r[t]);return this}swapRows(e,r){et(this,e),et(this,r);for(let t=0;t<this.columns;t++){let i=this.get(e,t);this.set(e,t,this.get(r,t)),this.set(r,t,i)}return this}getColumn(e){rt(this,e);let r=[];for(let t=0;t<this.rows;t++)r.push(this.get(t,e));return r}getColumnVector(e){return _.columnVector(this.getColumn(e))}setColumn(e,r){rt(this,e),r=dt(this,r);for(let t=0;t<this.rows;t++)this.set(t,e,r[t]);return this}swapColumns(e,r){rt(this,e),rt(this,r);for(let t=0;t<this.rows;t++){let i=this.get(t,e);this.set(t,e,this.get(t,r)),this.set(t,r,i)}return this}addRowVector(e){e=vt(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)+e[t]);return this}subRowVector(e){e=vt(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)-e[t]);return this}mulRowVector(e){e=vt(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e[t]);return this}divRowVector(e){e=vt(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)/e[t]);return this}addColumnVector(e){e=dt(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)+e[r]);return this}subColumnVector(e){e=dt(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)-e[r]);return this}mulColumnVector(e){e=dt(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e[r]);return this}divColumnVector(e){e=dt(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)/e[r]);return this}mulRow(e,r){et(this,e);for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r);return this}mulColumn(e,r){rt(this,e);for(let t=0;t<this.rows;t++)this.set(t,e,this.get(t,e)*r);return this}max(e){if(this.isEmpty())return NaN;switch(e){case"row":{const r=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)>r[t]&&(r[t]=this.get(t,i));return r}case"column":{const r=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)>r[i]&&(r[i]=this.get(t,i));return r}case void 0:{let r=this.get(0,0);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)>r&&(r=this.get(t,i));return r}default:throw new Error(`invalid option: ${e}`)}}maxIndex(){yt(this);let e=this.get(0,0),r=[0,0];for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)>e&&(e=this.get(t,i),r[0]=t,r[1]=i);return r}min(e){if(this.isEmpty())return NaN;switch(e){case"row":{const r=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)<r[t]&&(r[t]=this.get(t,i));return r}case"column":{const r=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)<r[i]&&(r[i]=this.get(t,i));return r}case void 0:{let r=this.get(0,0);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)<r&&(r=this.get(t,i));return r}default:throw new Error(`invalid option: ${e}`)}}minIndex(){yt(this);let e=this.get(0,0),r=[0,0];for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)<e&&(e=this.get(t,i),r[0]=t,r[1]=i);return r}maxRow(e){if(et(this,e),this.isEmpty())return NaN;let r=this.get(e,0);for(let t=1;t<this.columns;t++)this.get(e,t)>r&&(r=this.get(e,t));return r}maxRowIndex(e){et(this,e),yt(this);let r=this.get(e,0),t=[e,0];for(let i=1;i<this.columns;i++)this.get(e,i)>r&&(r=this.get(e,i),t[1]=i);return t}minRow(e){if(et(this,e),this.isEmpty())return NaN;let r=this.get(e,0);for(let t=1;t<this.columns;t++)this.get(e,t)<r&&(r=this.get(e,t));return r}minRowIndex(e){et(this,e),yt(this);let r=this.get(e,0),t=[e,0];for(let i=1;i<this.columns;i++)this.get(e,i)<r&&(r=this.get(e,i),t[1]=i);return t}maxColumn(e){if(rt(this,e),this.isEmpty())return NaN;let r=this.get(0,e);for(let t=1;t<this.rows;t++)this.get(t,e)>r&&(r=this.get(t,e));return r}maxColumnIndex(e){rt(this,e),yt(this);let r=this.get(0,e),t=[0,e];for(let i=1;i<this.rows;i++)this.get(i,e)>r&&(r=this.get(i,e),t[0]=i);return t}minColumn(e){if(rt(this,e),this.isEmpty())return NaN;let r=this.get(0,e);for(let t=1;t<this.rows;t++)this.get(t,e)<r&&(r=this.get(t,e));return r}minColumnIndex(e){rt(this,e),yt(this);let r=this.get(0,e),t=[0,e];for(let i=1;i<this.rows;i++)this.get(i,e)<r&&(r=this.get(i,e),t[0]=i);return t}diag(){let e=Math.min(this.rows,this.columns),r=[];for(let t=0;t<e;t++)r.push(this.get(t,t));return r}norm(e="frobenius"){let r=0;if(e==="max")return this.max();if(e==="frobenius"){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)r=r+this.get(t,i)*this.get(t,i);return Math.sqrt(r)}else throw new RangeError(`unknown norm type: ${e}`)}cumulativeSum(){let e=0;for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e+=this.get(r,t),this.set(r,t,e);return this}dot(e){R.isMatrix(e)&&(e=e.to1DArray());let r=this.to1DArray();if(r.length!==e.length)throw new RangeError("vectors do not have the same size");let t=0;for(let i=0;i<r.length;i++)t+=r[i]*e[i];return t}mmul(e){e=_.checkMatrix(e);let r=this.rows,t=this.columns,i=e.columns,o=new _(r,i),s=new Float64Array(t);for(let u=0;u<i;u++){for(let h=0;h<t;h++)s[h]=e.get(h,u);for(let h=0;h<r;h++){let l=0;for(let a=0;a<t;a++)l+=this.get(h,a)*s[a];o.set(h,u,l)}}return o}strassen2x2(e){e=_.checkMatrix(e);let r=new _(2,2);const t=this.get(0,0),i=e.get(0,0),o=this.get(0,1),s=e.get(0,1),u=this.get(1,0),h=e.get(1,0),l=this.get(1,1),a=e.get(1,1),f=(t+l)*(i+a),c=(u+l)*i,w=t*(s-a),p=l*(h-i),m=(t+o)*a,d=(u-t)*(i+s),v=(o-l)*(h+a),M=f+p-m+v,N=w+m,S=c+p,E=f-c+w+d;return r.set(0,0,M),r.set(0,1,N),r.set(1,0,S),r.set(1,1,E),r}strassen3x3(e){e=_.checkMatrix(e);let r=new _(3,3);const t=this.get(0,0),i=this.get(0,1),o=this.get(0,2),s=this.get(1,0),u=this.get(1,1),h=this.get(1,2),l=this.get(2,0),a=this.get(2,1),f=this.get(2,2),c=e.get(0,0),w=e.get(0,1),p=e.get(0,2),m=e.get(1,0),d=e.get(1,1),v=e.get(1,2),M=e.get(2,0),N=e.get(2,1),S=e.get(2,2),E=(t+i+o-s-u-a-f)*d,F=(t-s)*(-w+d),k=u*(-c+w+m-d-v-M+S),j=(-t+s+u)*(c-w+d),q=(s+u)*(-c+w),g=t*c,y=(-t+l+a)*(c-p+v),b=(-t+l)*(p-v),x=(l+a)*(-c+p),V=(t+i+o-u-h-l-a)*v,P=a*(-c+p+m-d-v-M+N),$=(-o+a+f)*(d+M-N),T=(o-f)*(d-N),O=o*M,L=(a+f)*(-M+N),U=(-o+u+h)*(v+M-S),ut=(o-h)*(v-S),ht=(u+h)*(-M+S),z=i*m,G=h*N,A=s*p,tt=l*w,Y=f*S,fs=g+O+z,cs=E+j+q+g+$+O+L,gs=g+y+x+V+O+U+ht,ms=F+k+j+g+O+U+ut,ps=F+j+q+g+G,ws=O+U+ut+ht+A,vs=g+y+b+P+$+T+O,ds=$+T+O+L+tt,ys=g+y+b+x+Y;return r.set(0,0,fs),r.set(0,1,cs),r.set(0,2,gs),r.set(1,0,ms),r.set(1,1,ps),r.set(1,2,ws),r.set(2,0,vs),r.set(2,1,ds),r.set(2,2,ys),r}mmulStrassen(e){e=_.checkMatrix(e);let r=this.clone(),t=r.rows,i=r.columns,o=e.rows,s=e.columns;i!==o&&console.warn(`Multiplying ${t} x ${i} and ${o} x ${s} matrix: dimensions do not match.`);function u(f,c,w){let p=f.rows,m=f.columns;if(p===c&&m===w)return f;{let d=R.zeros(c,w);return d=d.setSubMatrix(f,0,0),d}}let h=Math.max(t,o),l=Math.max(i,s);r=u(r,h,l),e=u(e,h,l);function a(f,c,w,p){if(w<=512||p<=512)return f.mmul(c);w%2===1&&p%2===1?(f=u(f,w+1,p+1),c=u(c,w+1,p+1)):w%2===1?(f=u(f,w+1,p),c=u(c,w+1,p)):p%2===1&&(f=u(f,w,p+1),c=u(c,w,p+1));let m=parseInt(f.rows/2,10),d=parseInt(f.columns/2,10),v=f.subMatrix(0,m-1,0,d-1),M=c.subMatrix(0,m-1,0,d-1),N=f.subMatrix(0,m-1,d,f.columns-1),S=c.subMatrix(0,m-1,d,c.columns-1),E=f.subMatrix(m,f.rows-1,0,d-1),F=c.subMatrix(m,c.rows-1,0,d-1),k=f.subMatrix(m,f.rows-1,d,f.columns-1),j=c.subMatrix(m,c.rows-1,d,c.columns-1),q=a(R.add(v,k),R.add(M,j),m,d),g=a(R.add(E,k),M,m,d),y=a(v,R.sub(S,j),m,d),b=a(k,R.sub(F,M),m,d),x=a(R.add(v,N),j,m,d),V=a(R.sub(E,v),R.add(M,S),m,d),P=a(R.sub(N,k),R.add(F,j),m,d),$=R.add(q,b);$.sub(x),$.add(P);let T=R.add(y,x),O=R.add(g,b),L=R.sub(q,g);L.add(y),L.add(V);let U=R.zeros(2*$.rows,2*$.columns);return U=U.setSubMatrix($,0,0),U=U.setSubMatrix(T,$.rows,0),U=U.setSubMatrix(O,0,$.columns),U=U.setSubMatrix(L,$.rows,$.columns),U.subMatrix(0,w-1,0,p-1)}return a(r,e,h,l)}scaleRows(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:r=0,max:t=1}=e;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(r>=t)throw new RangeError("min must be smaller than max");let i=new _(this.rows,this.columns);for(let o=0;o<this.rows;o++){const s=this.getRow(o);s.length>0&&qe(s,{min:r,max:t,output:s}),i.setRow(o,s)}return i}scaleColumns(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:r=0,max:t=1}=e;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(r>=t)throw new RangeError("min must be smaller than max");let i=new _(this.rows,this.columns);for(let o=0;o<this.columns;o++){const s=this.getColumn(o);s.length&&qe(s,{min:r,max:t,output:s}),i.setColumn(o,s)}return i}flipRows(){const e=Math.ceil(this.columns/2);for(let r=0;r<this.rows;r++)for(let t=0;t<e;t++){let i=this.get(r,t),o=this.get(r,this.columns-1-t);this.set(r,t,o),this.set(r,this.columns-1-t,i)}return this}flipColumns(){const e=Math.ceil(this.rows/2);for(let r=0;r<this.columns;r++)for(let t=0;t<e;t++){let i=this.get(t,r),o=this.get(this.rows-1-t,r);this.set(t,r,o),this.set(this.rows-1-t,r,i)}return this}kroneckerProduct(e){e=_.checkMatrix(e);let r=this.rows,t=this.columns,i=e.rows,o=e.columns,s=new _(r*i,t*o);for(let u=0;u<r;u++)for(let h=0;h<t;h++)for(let l=0;l<i;l++)for(let a=0;a<o;a++)s.set(i*u+l,o*h+a,this.get(u,h)*e.get(l,a));return s}kroneckerSum(e){if(e=_.checkMatrix(e),!this.isSquare()||!e.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let r=this.rows,t=e.rows,i=this.kroneckerProduct(_.eye(t,t)),o=_.eye(r,r).kroneckerProduct(e);return i.add(o)}transpose(){let e=new _(this.columns,this.rows);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.set(t,r,this.get(r,t));return e}sortRows(e=Ye){for(let r=0;r<this.rows;r++)this.setRow(r,this.getRow(r).sort(e));return this}sortColumns(e=Ye){for(let r=0;r<this.columns;r++)this.setColumn(r,this.getColumn(r).sort(e));return this}subMatrix(e,r,t,i){Ue(this,e,r,t,i);let o=new _(r-e+1,i-t+1);for(let s=e;s<=r;s++)for(let u=t;u<=i;u++)o.set(s-e,u-t,this.get(s,u));return o}subMatrixRow(e,r,t){if(r===void 0&&(r=0),t===void 0&&(t=this.columns-1),r>t||r<0||r>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let i=new _(e.length,t-r+1);for(let o=0;o<e.length;o++)for(let s=r;s<=t;s++){if(e[o]<0||e[o]>=this.rows)throw new RangeError(`Row index out of range: ${e[o]}`);i.set(o,s-r,this.get(e[o],s))}return i}subMatrixColumn(e,r,t){if(r===void 0&&(r=0),t===void 0&&(t=this.rows-1),r>t||r<0||r>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let i=new _(t-r+1,e.length);for(let o=0;o<e.length;o++)for(let s=r;s<=t;s++){if(e[o]<0||e[o]>=this.columns)throw new RangeError(`Column index out of range: ${e[o]}`);i.set(s-r,o,this.get(s,e[o]))}return i}setSubMatrix(e,r,t){if(e=_.checkMatrix(e),e.isEmpty())return this;let i=r+e.rows-1,o=t+e.columns-1;Ue(this,r,i,t,o);for(let s=0;s<e.rows;s++)for(let u=0;u<e.columns;u++)this.set(r+s,t+u,e.get(s,u));return this}selection(e,r){Dn(this,e),Cn(this,r);let t=new _(e.length,r.length);for(let i=0;i<e.length;i++){let o=e[i];for(let s=0;s<r.length;s++){let u=r[s];t.set(i,s,this.get(o,u))}}return t}trace(){let e=Math.min(this.rows,this.columns),r=0;for(let t=0;t<e;t++)r+=this.get(t,t);return r}clone(){let e=new _(this.rows,this.columns);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.set(r,t,this.get(r,t));return e}sum(e){switch(e){case"row":return Bn(this);case"column":return Un(this);case void 0:return Yn(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return Gn(this);case"column":return Wn(this);case void 0:return Xn(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){const r=this.sum(e);switch(e){case"row":{for(let t=0;t<this.rows;t++)r[t]/=this.columns;return r}case"column":{for(let t=0;t<this.columns;t++)r[t]/=this.rows;return r}case void 0:return r/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");const{unbiased:t=!0,mean:i=this.mean(e)}=r;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(e){case"row":{if(!Z(i))throw new TypeError("mean must be an array");return Kn(this,t,i)}case"column":{if(!Z(i))throw new TypeError("mean must be an array");return Qn(this,t,i)}case void 0:{if(typeof i!="number")throw new TypeError("mean must be a number");return Hn(this,t,i)}default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,r){typeof e=="object"&&(r=e,e=void 0);const t=this.variance(e,r);if(e===void 0)return Math.sqrt(t);for(let i=0;i<t.length;i++)t[i]=Math.sqrt(t[i]);return t}center(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");const{center:t=this.mean(e)}=r;switch(e){case"row":{if(!Z(t))throw new TypeError("center must be an array");return Jn(this,t),this}case"column":{if(!Z(t))throw new TypeError("center must be an array");return Zn(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return An(this,t),this}default:throw new Error(`invalid option: ${e}`)}}scale(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");let t=r.scale;switch(e){case"row":{if(t===void 0)t=ti(this);else if(!Z(t))throw new TypeError("scale must be an array");return ei(this,t),this}case"column":{if(t===void 0)t=ri(this);else if(!Z(t))throw new TypeError("scale must be an array");return ni(this,t),this}case void 0:{if(t===void 0)t=ii(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return oi(this,t),this}default:throw new Error(`invalid option: ${e}`)}}toString(e){return Ce(this,e)}}R.prototype.klass="Matrix",typeof Symbol<"u"&&(R.prototype[Symbol.for("nodejs.util.inspect.custom")]=Vn);function Ye(n,e){return n-e}function si(n){return n.every(e=>typeof e=="number")}R.random=R.rand,R.randomInt=R.randInt,R.diagonal=R.diag,R.prototype.diagonal=R.prototype.diag,R.identity=R.eye,R.prototype.negate=R.prototype.neg,R.prototype.tensorProduct=R.prototype.kroneckerProduct;class _ extends R{constructor(e,r){if(super(),_.isMatrix(e))return e.clone();if(Number.isInteger(e)&&e>=0)if(this.data=[],Number.isInteger(r)&&r>=0)for(let t=0;t<e;t++)this.data.push(new Float64Array(r));else throw new TypeError("nColumns must be a positive integer");else if(Z(e)){const t=e;if(e=t.length,r=e?t[0].length:0,typeof r!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let i=0;i<e;i++){if(t[i].length!==r)throw new RangeError("Inconsistent array dimensions");if(!si(t[i]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(t[i]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=e,this.columns=r}set(e,r,t){return this.data[e][r]=t,this}get(e,r){return this.data[e][r]}removeRow(e){return et(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,r){return r===void 0&&(r=e,e=this.rows),et(this,e,!0),r=Float64Array.from(vt(this,r)),this.data.splice(e,0,r),this.rows+=1,this}removeColumn(e){rt(this,e);for(let r=0;r<this.rows;r++){const t=new Float64Array(this.columns-1);for(let i=0;i<e;i++)t[i]=this.data[r][i];for(let i=e+1;i<this.columns;i++)t[i-1]=this.data[r][i];this.data[r]=t}return this.columns-=1,this}addColumn(e,r){typeof r>"u"&&(r=e,e=this.columns),rt(this,e,!0),r=dt(this,r);for(let t=0;t<this.rows;t++){const i=new Float64Array(this.columns+1);let o=0;for(;o<e;o++)i[o]=this.data[t][o];for(i[o++]=r[t];o<this.columns+1;o++)i[o]=this.data[t][o-1];this.data[t]=i}return this.columns+=1,this}}qn(R,_);class xt extends R{constructor(e){super(),this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,r,t){return this.data[e][r]=t,this}get(e,r){return this.data[e][r]}}class ui{constructor(e){e=xt.checkMatrix(e);let r=e.clone(),t=r.rows,i=r.columns,o=new Float64Array(t),s=1,u,h,l,a,f,c,w,p,m;for(u=0;u<t;u++)o[u]=u;for(p=new Float64Array(t),h=0;h<i;h++){for(u=0;u<t;u++)p[u]=r.get(u,h);for(u=0;u<t;u++){for(m=Math.min(u,h),f=0,l=0;l<m;l++)f+=r.get(u,l)*p[l];p[u]-=f,r.set(u,h,p[u])}for(a=h,u=h+1;u<t;u++)Math.abs(p[u])>Math.abs(p[a])&&(a=u);if(a!==h){for(l=0;l<i;l++)c=r.get(a,l),r.set(a,l,r.get(h,l)),r.set(h,l,c);w=o[a],o[a]=o[h],o[h]=w,s=-s}if(h<t&&r.get(h,h)!==0)for(u=h+1;u<t;u++)r.set(u,h,r.get(u,h)/r.get(h,h))}this.LU=r,this.pivotVector=o,this.pivotSign=s}isSingular(){let e=this.LU,r=e.columns;for(let t=0;t<r;t++)if(e.get(t,t)===0)return!0;return!1}solve(e){e=_.checkMatrix(e);let r=this.LU;if(r.rows!==e.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let i=e.columns,o=e.subMatrixRow(this.pivotVector,0,i-1),s=r.columns,u,h,l;for(l=0;l<s;l++)for(u=l+1;u<s;u++)for(h=0;h<i;h++)o.set(u,h,o.get(u,h)-o.get(l,h)*r.get(u,l));for(l=s-1;l>=0;l--){for(h=0;h<i;h++)o.set(l,h,o.get(l,h)/r.get(l,l));for(u=0;u<l;u++)for(h=0;h<i;h++)o.set(u,h,o.get(u,h)-o.get(l,h)*r.get(u,l))}return o}get determinant(){let e=this.LU;if(!e.isSquare())throw new Error("Matrix must be square");let r=this.pivotSign,t=e.columns;for(let i=0;i<t;i++)r*=e.get(i,i);return r}get lowerTriangularMatrix(){let e=this.LU,r=e.rows,t=e.columns,i=new _(r,t);for(let o=0;o<r;o++)for(let s=0;s<t;s++)o>s?i.set(o,s,e.get(o,s)):o===s?i.set(o,s,1):i.set(o,s,0);return i}get upperTriangularMatrix(){let e=this.LU,r=e.rows,t=e.columns,i=new _(r,t);for(let o=0;o<r;o++)for(let s=0;s<t;s++)o<=s?i.set(o,s,e.get(o,s)):i.set(o,s,0);return i}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function ft(n,e){let r=0;return Math.abs(n)>Math.abs(e)?(r=e/n,Math.abs(n)*Math.sqrt(1+r*r)):e!==0?(r=n/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class li{constructor(e){e=xt.checkMatrix(e);let r=e.clone(),t=e.rows,i=e.columns,o=new Float64Array(i),s,u,h,l;for(h=0;h<i;h++){let a=0;for(s=h;s<t;s++)a=ft(a,r.get(s,h));if(a!==0){for(r.get(h,h)<0&&(a=-a),s=h;s<t;s++)r.set(s,h,r.get(s,h)/a);for(r.set(h,h,r.get(h,h)+1),u=h+1;u<i;u++){for(l=0,s=h;s<t;s++)l+=r.get(s,h)*r.get(s,u);for(l=-l/r.get(h,h),s=h;s<t;s++)r.set(s,u,r.get(s,u)+l*r.get(s,h))}}o[h]=-a}this.QR=r,this.Rdiag=o}solve(e){e=_.checkMatrix(e);let r=this.QR,t=r.rows;if(e.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let i=e.columns,o=e.clone(),s=r.columns,u,h,l,a;for(l=0;l<s;l++)for(h=0;h<i;h++){for(a=0,u=l;u<t;u++)a+=r.get(u,l)*o.get(u,h);for(a=-a/r.get(l,l),u=l;u<t;u++)o.set(u,h,o.get(u,h)+a*r.get(u,l))}for(l=s-1;l>=0;l--){for(h=0;h<i;h++)o.set(l,h,o.get(l,h)/this.Rdiag[l]);for(u=0;u<l;u++)for(h=0;h<i;h++)o.set(u,h,o.get(u,h)-o.get(l,h)*r.get(u,l))}return o.subMatrix(0,s-1,0,i-1)}isFullRank(){let e=this.QR.columns;for(let r=0;r<e;r++)if(this.Rdiag[r]===0)return!1;return!0}get upperTriangularMatrix(){let e=this.QR,r=e.columns,t=new _(r,r),i,o;for(i=0;i<r;i++)for(o=0;o<r;o++)i<o?t.set(i,o,e.get(i,o)):i===o?t.set(i,o,this.Rdiag[i]):t.set(i,o,0);return t}get orthogonalMatrix(){let e=this.QR,r=e.rows,t=e.columns,i=new _(r,t),o,s,u,h;for(u=t-1;u>=0;u--){for(o=0;o<r;o++)i.set(o,u,0);for(i.set(u,u,1),s=u;s<t;s++)if(e.get(u,u)!==0){for(h=0,o=u;o<r;o++)h+=e.get(o,u)*i.get(o,s);for(h=-h/e.get(u,u),o=u;o<r;o++)i.set(o,s,i.get(o,s)+h*e.get(o,u))}}return i}}class Ge{constructor(e,r={}){if(e=xt.checkMatrix(e),e.isEmpty())throw new Error("Matrix must be non-empty");let t=e.rows,i=e.columns;const{computeLeftSingularVectors:o=!0,computeRightSingularVectors:s=!0,autoTranspose:u=!1}=r;let h=!!o,l=!!s,a=!1,f;if(t<i)if(!u)f=e.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{f=e.transpose(),t=f.rows,i=f.columns,a=!0;let g=h;h=l,l=g}else f=e.clone();let c=Math.min(t,i),w=Math.min(t+1,i),p=new Float64Array(w),m=new _(t,c),d=new _(i,i),v=new Float64Array(i),M=new Float64Array(t),N=new Float64Array(w);for(let g=0;g<w;g++)N[g]=g;let S=Math.min(t-1,i),E=Math.max(0,Math.min(i-2,t)),F=Math.max(S,E);for(let g=0;g<F;g++){if(g<S){p[g]=0;for(let y=g;y<t;y++)p[g]=ft(p[g],f.get(y,g));if(p[g]!==0){f.get(g,g)<0&&(p[g]=-p[g]);for(let y=g;y<t;y++)f.set(y,g,f.get(y,g)/p[g]);f.set(g,g,f.get(g,g)+1)}p[g]=-p[g]}for(let y=g+1;y<i;y++){if(g<S&&p[g]!==0){let b=0;for(let x=g;x<t;x++)b+=f.get(x,g)*f.get(x,y);b=-b/f.get(g,g);for(let x=g;x<t;x++)f.set(x,y,f.get(x,y)+b*f.get(x,g))}v[y]=f.get(g,y)}if(h&&g<S)for(let y=g;y<t;y++)m.set(y,g,f.get(y,g));if(g<E){v[g]=0;for(let y=g+1;y<i;y++)v[g]=ft(v[g],v[y]);if(v[g]!==0){v[g+1]<0&&(v[g]=0-v[g]);for(let y=g+1;y<i;y++)v[y]/=v[g];v[g+1]+=1}if(v[g]=-v[g],g+1<t&&v[g]!==0){for(let y=g+1;y<t;y++)M[y]=0;for(let y=g+1;y<t;y++)for(let b=g+1;b<i;b++)M[y]+=v[b]*f.get(y,b);for(let y=g+1;y<i;y++){let b=-v[y]/v[g+1];for(let x=g+1;x<t;x++)f.set(x,y,f.get(x,y)+b*M[x])}}if(l)for(let y=g+1;y<i;y++)d.set(y,g,v[y])}}let k=Math.min(i,t+1);if(S<i&&(p[S]=f.get(S,S)),t<k&&(p[k-1]=0),E+1<k&&(v[E]=f.get(E,k-1)),v[k-1]=0,h){for(let g=S;g<c;g++){for(let y=0;y<t;y++)m.set(y,g,0);m.set(g,g,1)}for(let g=S-1;g>=0;g--)if(p[g]!==0){for(let y=g+1;y<c;y++){let b=0;for(let x=g;x<t;x++)b+=m.get(x,g)*m.get(x,y);b=-b/m.get(g,g);for(let x=g;x<t;x++)m.set(x,y,m.get(x,y)+b*m.get(x,g))}for(let y=g;y<t;y++)m.set(y,g,-m.get(y,g));m.set(g,g,1+m.get(g,g));for(let y=0;y<g-1;y++)m.set(y,g,0)}else{for(let y=0;y<t;y++)m.set(y,g,0);m.set(g,g,1)}}if(l)for(let g=i-1;g>=0;g--){if(g<E&&v[g]!==0)for(let y=g+1;y<i;y++){let b=0;for(let x=g+1;x<i;x++)b+=d.get(x,g)*d.get(x,y);b=-b/d.get(g+1,g);for(let x=g+1;x<i;x++)d.set(x,y,d.get(x,y)+b*d.get(x,g))}for(let y=0;y<i;y++)d.set(y,g,0);d.set(g,g,1)}let j=k-1,q=Number.EPSILON;for(;k>0;){let g,y;for(g=k-2;g>=-1&&g!==-1;g--){const b=Number.MIN_VALUE+q*Math.abs(p[g]+Math.abs(p[g+1]));if(Math.abs(v[g])<=b||Number.isNaN(v[g])){v[g]=0;break}}if(g===k-2)y=4;else{let b;for(b=k-1;b>=g&&b!==g;b--){let x=(b!==k?Math.abs(v[b]):0)+(b!==g+1?Math.abs(v[b-1]):0);if(Math.abs(p[b])<=q*x){p[b]=0;break}}b===g?y=3:b===k-1?y=1:(y=2,g=b)}switch(g++,y){case 1:{let b=v[k-2];v[k-2]=0;for(let x=k-2;x>=g;x--){let V=ft(p[x],b),P=p[x]/V,$=b/V;if(p[x]=V,x!==g&&(b=-$*v[x-1],v[x-1]=P*v[x-1]),l)for(let T=0;T<i;T++)V=P*d.get(T,x)+$*d.get(T,k-1),d.set(T,k-1,-$*d.get(T,x)+P*d.get(T,k-1)),d.set(T,x,V)}break}case 2:{let b=v[g-1];v[g-1]=0;for(let x=g;x<k;x++){let V=ft(p[x],b),P=p[x]/V,$=b/V;if(p[x]=V,b=-$*v[x],v[x]=P*v[x],h)for(let T=0;T<t;T++)V=P*m.get(T,x)+$*m.get(T,g-1),m.set(T,g-1,-$*m.get(T,x)+P*m.get(T,g-1)),m.set(T,x,V)}break}case 3:{const b=Math.max(Math.abs(p[k-1]),Math.abs(p[k-2]),Math.abs(v[k-2]),Math.abs(p[g]),Math.abs(v[g])),x=p[k-1]/b,V=p[k-2]/b,P=v[k-2]/b,$=p[g]/b,T=v[g]/b,O=((V+x)*(V-x)+P*P)/2,L=x*P*(x*P);let U=0;(O!==0||L!==0)&&(O<0?U=0-Math.sqrt(O*O+L):U=Math.sqrt(O*O+L),U=L/(O+U));let ut=($+x)*($-x)+U,ht=$*T;for(let z=g;z<k-1;z++){let G=ft(ut,ht);G===0&&(G=Number.MIN_VALUE);let A=ut/G,tt=ht/G;if(z!==g&&(v[z-1]=G),ut=A*p[z]+tt*v[z],v[z]=A*v[z]-tt*p[z],ht=tt*p[z+1],p[z+1]=A*p[z+1],l)for(let Y=0;Y<i;Y++)G=A*d.get(Y,z)+tt*d.get(Y,z+1),d.set(Y,z+1,-tt*d.get(Y,z)+A*d.get(Y,z+1)),d.set(Y,z,G);if(G=ft(ut,ht),G===0&&(G=Number.MIN_VALUE),A=ut/G,tt=ht/G,p[z]=G,ut=A*v[z]+tt*p[z+1],p[z+1]=-tt*v[z]+A*p[z+1],ht=tt*v[z+1],v[z+1]=A*v[z+1],h&&z<t-1)for(let Y=0;Y<t;Y++)G=A*m.get(Y,z)+tt*m.get(Y,z+1),m.set(Y,z+1,-tt*m.get(Y,z)+A*m.get(Y,z+1)),m.set(Y,z,G)}v[k-2]=ut;break}case 4:{if(p[g]<=0&&(p[g]=p[g]<0?-p[g]:0,l))for(let b=0;b<=j;b++)d.set(b,g,-d.get(b,g));for(;g<j&&!(p[g]>=p[g+1]);){let b=p[g];if(p[g]=p[g+1],p[g+1]=b,l&&g<i-1)for(let x=0;x<i;x++)b=d.get(x,g+1),d.set(x,g+1,d.get(x,g)),d.set(x,g,b);if(h&&g<t-1)for(let x=0;x<t;x++)b=m.get(x,g+1),m.set(x,g+1,m.get(x,g)),m.set(x,g,b);g++}k--;break}}}if(a){let g=d;d=m,m=g}this.m=t,this.n=i,this.s=p,this.U=m,this.V=d}solve(e){let r=e,t=this.threshold,i=this.s.length,o=_.zeros(i,i);for(let c=0;c<i;c++)Math.abs(this.s[c])<=t?o.set(c,c,0):o.set(c,c,1/this.s[c]);let s=this.U,u=this.rightSingularVectors,h=u.mmul(o),l=u.rows,a=s.rows,f=_.zeros(l,a);for(let c=0;c<l;c++)for(let w=0;w<a;w++){let p=0;for(let m=0;m<i;m++)p+=h.get(c,m)*s.get(w,m);f.set(c,w,p)}return f.mmul(r)}solveForDiagonal(e){return this.solve(_.diag(e))}inverse(){let e=this.V,r=this.threshold,t=e.rows,i=e.columns,o=new _(t,this.s.length);for(let a=0;a<t;a++)for(let f=0;f<i;f++)Math.abs(this.s[f])>r&&o.set(a,f,e.get(a,f)/this.s[f]);let s=this.U,u=s.rows,h=s.columns,l=new _(t,u);for(let a=0;a<t;a++)for(let f=0;f<u;f++){let c=0;for(let w=0;w<h;w++)c+=o.get(a,w)*s.get(f,w);l.set(a,f,c)}return l}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let e=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,r=0,t=this.s;for(let i=0,o=t.length;i<o;i++)t[i]>e&&r++;return r}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return _.diag(this.s)}}function hi(n,e=!1){return n=xt.checkMatrix(n),e?new Ge(n).inverse():ai(n,_.eye(n.rows))}function ai(n,e,r=!1){return n=xt.checkMatrix(n),e=xt.checkMatrix(e),r?new Ge(n).solve(e):n.isSquare()?new ui(n).solve(e):new li(n).solve(e)}function fi(n,e,r,t,i){const o=r.length,s=n.x.length;let u=new Array(o);for(let h=0;h<o;h++){u[h]=new Array(s);let l=r.slice();l[h]+=t;let a=i(l);for(let f=0;f<s;f++)u[h][f]=e[f]-a(n.x[f])}return new _(u)}function ci(n,e){const r=n.x.length;let t=new Array(r);for(let i=0;i<r;i++)t[i]=[n.y[i]-e[i]];return new _(t)}function gi(n,e,r,t,i){let o=r*t*t,s=_.eye(e.length,e.length,o);const u=i(e);let h=new Float64Array(n.x.length);for(let c=0;c<n.x.length;c++)h[c]=u(n.x[c]);let l=fi(n,h,e,t,i),a=ci(n,h),f=hi(s.add(l.mmul(l.transpose())));return e=new _([e]),e=e.sub(f.mmul(l).mmul(a).mul(t).transpose()),e.to1DArray()}function mi(n,e,r={}){let{maxIterations:t=100,gradientDifference:i=.1,damping:o=0,errorTolerance:s=.01,minValues:u,maxValues:h,initialValues:l}=r;if(o<=0)throw new Error("The damping option must be a positive number");if(!n.x||!n.y)throw new Error("The data parameter must have x and y elements");if(!ce(n.x)||n.x.length<2||!ce(n.y)||n.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(n.x.length!==n.y.length)throw new Error("The data parameter elements must have the same size");let a=l||new Array(e.length).fill(1),f=a.length;if(h=h||new Array(f).fill(Number.MAX_SAFE_INTEGER),u=u||new Array(f).fill(Number.MIN_SAFE_INTEGER),h.length!==u.length)throw new Error("minValues and maxValues must be the same size");if(!ce(a))throw new Error("initialValues must be an array");let c=Le(n,a,e),w=c<=s,p;for(p=0;p<t&&!w;p++){a=gi(n,a,o,i,e);for(let m=0;m<f;m++)a[m]=Math.min(Math.max(u[m],a[m]),h[m]);if(c=Le(n,a,e),isNaN(c))break;w=c<=s}return{parameterValues:a,parameterError:c,iterations:p}}var pi=Object.freeze({__proto__:null,default:mi}),wi=Lr(pi),We=I&&I.__awaiter||function(n,e,r,t){return new(r||(r=Promise))(function(i,o){function s(l){try{h(t.next(l))}catch(a){o(a)}}function u(l){try{h(t.throw(l))}catch(a){o(a)}}function h(l){l.done?i(l.value):new r(function(a){a(l.value)}).then(s,u)}h((t=t.apply(n,e||[])).next())})},Xe=I&&I.__generator||function(n,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},t,i,o,s;return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(l){return function(a){return h([l,a])}}function h(l){if(t)throw new TypeError("Generator is already executing.");for(;r;)try{if(t=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(n,r)}catch(a){l=[6,a],i=0}finally{t=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},ge=I&&I.__read||function(n,e){var r=typeof Symbol=="function"&&n[Symbol.iterator];if(!r)return n;var t=r.call(n),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=t.next()).done;)o.push(i.value)}catch(u){s={error:u}}finally{try{i&&!i.done&&(r=t.return)&&r.call(t)}finally{if(s)throw s.error}}return o},Ke=I&&I.__spread||function(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(ge(arguments[e]));return n},kt=I&&I.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var r in n)Object.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e.default=n,e},vi=I&&I.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(lt,"__esModule",{value:!0});var di=kt(it),D=kt(H),Yt=kt(wt),Qe=kt(at),B=kt(C),yi=vi(wi),He=1e-5,Gt=.001,xi=function(){function n(e){e===void 0&&(e={});var r=this;this.learningRate=1,this.localConnectivity=1,this.minDist=.1,this.nComponents=2,this.nEpochs=0,this.nNeighbors=15,this.negativeSampleRate=5,this.random=Math.random,this.repulsionStrength=1,this.setOpMixRatio=1,this.spread=1,this.transformQueueSize=4,this.targetMetric="categorical",this.targetWeight=.5,this.targetNNeighbors=this.nNeighbors,this.distanceFn=Je,this.isInitialized=!1,this.rpForest=[],this.embedding=[],this.optimizationState=new Mi;var t=function(i){e[i]!==void 0&&(r[i]=e[i])};t("distanceFn"),t("learningRate"),t("localConnectivity"),t("minDist"),t("nComponents"),t("nEpochs"),t("nNeighbors"),t("negativeSampleRate"),t("random"),t("repulsionStrength"),t("setOpMixRatio"),t("spread"),t("transformQueueSize")}return n.prototype.fit=function(e){return this.initializeFit(e),this.optimizeLayout(),this.embedding},n.prototype.fitAsync=function(e,r){return r===void 0&&(r=function(){return!0}),We(this,void 0,void 0,function(){return Xe(this,function(t){switch(t.label){case 0:return this.initializeFit(e),[4,this.optimizeLayoutAsync(r)];case 1:return t.sent(),[2,this.embedding]}})})},n.prototype.setSupervisedProjection=function(e,r){r===void 0&&(r={}),this.Y=e,this.targetMetric=r.targetMetric||this.targetMetric,this.targetWeight=r.targetWeight||this.targetWeight,this.targetNNeighbors=r.targetNNeighbors||this.targetNNeighbors},n.prototype.setPrecomputedKNN=function(e,r){this.knnIndices=e,this.knnDistances=r},n.prototype.initializeFit=function(e){if(e.length<=this.nNeighbors)throw new Error("Not enough data points ("+e.length+") to create nNeighbors: "+this.nNeighbors+".  Add more data points or adjust the configuration.");if(this.X===e&&this.isInitialized)return this.getNEpochs();if(this.X=e,!this.knnIndices&&!this.knnDistances){var r=this.nearestNeighbors(e);this.knnIndices=r.knnIndices,this.knnDistances=r.knnDistances}this.graph=this.fuzzySimplicialSet(e,this.nNeighbors,this.setOpMixRatio),this.makeSearchFns(),this.searchGraph=this.makeSearchGraph(e),this.processGraphForSupervisedProjection();var t=this.initializeSimplicialSetEmbedding(),i=t.head,o=t.tail,s=t.epochsPerSample;return this.optimizationState.head=i,this.optimizationState.tail=o,this.optimizationState.epochsPerSample=s,this.initializeOptimization(),this.prepareForOptimizationLoop(),this.isInitialized=!0,this.getNEpochs()},n.prototype.makeSearchFns=function(){var e=Yt.makeInitializations(this.distanceFn),r=e.initFromTree,t=e.initFromRandom;this.initFromTree=r,this.initFromRandom=t,this.search=Yt.makeInitializedNNSearch(this.distanceFn)},n.prototype.makeSearchGraph=function(e){for(var r=this.knnIndices,t=this.knnDistances,i=[e.length,e.length],o=new D.SparseMatrix([],[],[],i),s=0;s<r.length;s++)for(var u=r[s],h=t[s],l=0;l<u.length;l++){var a=u[l],f=h[l];f>0&&o.set(s,a,f)}var c=D.transpose(o);return D.maximum(o,c)},n.prototype.transform=function(e){var r=this,t=this.X;if(t===void 0||t.length===0)throw new Error("No data has been fit.");var i=Math.floor(this.nNeighbors*this.transformQueueSize);i=Math.min(t.length,i);var o=Yt.initializeSearch(this.rpForest,t,e,i,this.initFromRandom,this.initFromTree,this.random),s=this.search(t,this.searchGraph,o,e),u=di.deheapSort(s),h=u.indices,l=u.weights;h=h.map(function(P){return P.slice(0,r.nNeighbors)}),l=l.map(function(P){return P.slice(0,r.nNeighbors)});var a=Math.max(0,this.localConnectivity-1),f=this.smoothKNNDistance(l,this.nNeighbors,a),c=f.sigmas,w=f.rhos,p=this.computeMembershipStrengths(h,l,c,w),m=p.rows,d=p.cols,v=p.vals,M=[e.length,t.length],N=new D.SparseMatrix(m,d,v,M),S=D.normalize(N,"l1"),E=D.getCSR(S),F=e.length,k=B.reshape2d(E.indices,F,this.nNeighbors),j=B.reshape2d(E.values,F,this.nNeighbors),q=nr(k,j,this.embedding),g=this.nEpochs?this.nEpochs/3:N.nRows<=1e4?100:30,y=N.getValues().reduce(function(P,$){return $>P?$:P},0);N=N.map(function(P){return P<y/g?0:P}),N=D.eliminateZeros(N);var b=this.makeEpochsPerSample(N.getValues(),g),x=N.getRows(),V=N.getCols();return this.assignOptimizationStateParameters({headEmbedding:q,tailEmbedding:this.embedding,head:x,tail:V,currentEpoch:0,nEpochs:g,nVertices:N.getDims()[1],epochsPerSample:b}),this.prepareForOptimizationLoop(),this.optimizeLayout()},n.prototype.processGraphForSupervisedProjection=function(){var e=this,r=e.Y,t=e.X;if(r){if(r.length!==t.length)throw new Error("Length of X and y must be equal");if(this.targetMetric==="categorical"){var i=this.targetWeight<1,o=i?2.5*(1/(1-this.targetWeight)):1e12;this.graph=this.categoricalSimplicialSetIntersection(this.graph,r,o)}}},n.prototype.step=function(){var e=this.optimizationState.currentEpoch;return e<this.getNEpochs()&&this.optimizeLayoutStep(e),this.optimizationState.currentEpoch},n.prototype.getEmbedding=function(){return this.embedding},n.prototype.nearestNeighbors=function(e){var r=this,t=r.distanceFn,i=r.nNeighbors,o=function(p){return Math.log(p)/Math.log(2)},s=Yt.makeNNDescent(t,this.random),u=function(p){return p===.5?0:Math.round(p)},h=5+Math.floor(u(Math.pow(e.length,.5)/20)),l=Math.max(5,Math.floor(Math.round(o(e.length))));this.rpForest=Qe.makeForest(e,i,h,this.random);var a=Qe.makeLeafArray(this.rpForest),f=s(e,a,i,l),c=f.indices,w=f.weights;return{knnIndices:c,knnDistances:w}},n.prototype.fuzzySimplicialSet=function(e,r,t){t===void 0&&(t=1);var i=this,o=i.knnIndices,s=o===void 0?[]:o,u=i.knnDistances,h=u===void 0?[]:u,l=i.localConnectivity,a=this.smoothKNNDistance(h,r,l),f=a.sigmas,c=a.rhos,w=this.computeMembershipStrengths(s,h,f,c),p=w.rows,m=w.cols,d=w.vals,v=[e.length,e.length],M=new D.SparseMatrix(p,m,d,v),N=D.transpose(M),S=D.pairwiseMultiply(M,N),E=D.subtract(D.add(M,N),S),F=D.multiplyScalar(E,t),k=D.multiplyScalar(S,1-t),j=D.add(F,k);return j},n.prototype.categoricalSimplicialSetIntersection=function(e,r,t,i){i===void 0&&(i=1);var o=er(e,r,i,t);return o=D.eliminateZeros(o),rr(o)},n.prototype.smoothKNNDistance=function(e,r,t,i,o){t===void 0&&(t=1),i===void 0&&(i=64),o===void 0&&(o=1);for(var s=Math.log(r)/Math.log(2)*o,u=B.zeros(e.length),h=B.zeros(e.length),l=0;l<e.length;l++){var a=0,f=1/0,c=1,w=e[l],p=w.filter(function(k){return k>0});if(p.length>=t){var m=Math.floor(t),d=t-m;m>0?(u[l]=p[m-1],d>He&&(u[l]+=d*(p[m]-p[m-1]))):u[l]=d*p[0]}else p.length>0&&(u[l]=B.max(p));for(var v=0;v<i;v++){for(var M=0,N=1;N<e[l].length;N++){var S=e[l][N]-u[l];S>0?M+=Math.exp(-(S/c)):M+=1}if(Math.abs(M-s)<He)break;M>s?(f=c,c=(a+f)/2):(a=c,f===1/0?c*=2:c=(a+f)/2)}if(h[l]=c,u[l]>0){var E=B.mean(w);h[l]<Gt*E&&(h[l]=Gt*E)}else{var F=B.mean(e.map(B.mean));h[l]<Gt*F&&(h[l]=Gt*F)}}return{sigmas:h,rhos:u}},n.prototype.computeMembershipStrengths=function(e,r,t,i){for(var o=e.length,s=e[0].length,u=B.zeros(o*s),h=B.zeros(o*s),l=B.zeros(o*s),a=0;a<o;a++)for(var f=0;f<s;f++){var c=0;e[a][f]!==-1&&(e[a][f]===a?c=0:r[a][f]-i[a]<=0?c=1:c=Math.exp(-((r[a][f]-i[a])/t[a])),u[a*s+f]=a,h[a*s+f]=e[a][f],l[a*s+f]=c)}return{rows:u,cols:h,vals:l}},n.prototype.initializeSimplicialSetEmbedding=function(){for(var e=this,r=this.getNEpochs(),t=this.nComponents,i=this.graph.getValues(),o=0,s=0;s<i.length;s++){var u=i[s];o<i[s]&&(o=u)}var h=this.graph.map(function(m){return m<o/r?0:m});this.embedding=B.zeros(h.nRows).map(function(){return B.zeros(t).map(function(){return B.tauRand(e.random)*20+-10})});for(var l=[],a=[],f=[],c=h.getAll(),s=0;s<c.length;s++){var w=c[s];w.value&&(l.push(w.value),f.push(w.row),a.push(w.col))}var p=this.makeEpochsPerSample(l,r);return{head:a,tail:f,epochsPerSample:p}},n.prototype.makeEpochsPerSample=function(e,r){var t=B.filled(e.length,-1),i=B.max(e),o=e.map(function(s){return s/i*r});return o.forEach(function(s,u){s>0&&(t[u]=r/o[u])}),t},n.prototype.assignOptimizationStateParameters=function(e){Object.assign(this.optimizationState,e)},n.prototype.prepareForOptimizationLoop=function(){var e=this,r=e.repulsionStrength,t=e.learningRate,i=e.negativeSampleRate,o=this.optimizationState,s=o.epochsPerSample,u=o.headEmbedding,h=o.tailEmbedding,l=u[0].length,a=u.length===h.length,f=s.map(function(p){return p/i}),c=Ke(f),w=Ke(s);this.assignOptimizationStateParameters({epochOfNextSample:w,epochOfNextNegativeSample:c,epochsPerNegativeSample:f,moveOther:a,initialAlpha:t,alpha:t,gamma:r,dim:l})},n.prototype.initializeOptimization=function(){var e=this.embedding,r=this.embedding,t=this.optimizationState,i=t.head,o=t.tail,s=t.epochsPerSample,u=this.getNEpochs(),h=this.graph.nCols,l=tr(this.spread,this.minDist),a=l.a,f=l.b;this.assignOptimizationStateParameters({headEmbedding:e,tailEmbedding:r,head:i,tail:o,epochsPerSample:s,a,b:f,nEpochs:u,nVertices:h})},n.prototype.optimizeLayoutStep=function(e){for(var r=this.optimizationState,t=r.head,i=r.tail,o=r.headEmbedding,s=r.tailEmbedding,u=r.epochsPerSample,h=r.epochOfNextSample,l=r.epochOfNextNegativeSample,a=r.epochsPerNegativeSample,f=r.moveOther,c=r.initialAlpha,w=r.alpha,p=r.gamma,m=r.a,d=r.b,v=r.dim,M=r.nEpochs,N=r.nVertices,S=4,E=0;E<u.length;E++)if(!(h[E]>e)){var F=t[E],k=i[E],j=o[F],q=s[k],g=Ae(j,q),y=0;g>0&&(y=-2*m*d*Math.pow(g,d-1),y/=m*Math.pow(g,d)+1);for(var b=0;b<v;b++){var x=Ze(y*(j[b]-q[b]),S);j[b]+=x*w,f&&(q[b]+=-x*w)}h[E]+=u[E];for(var V=Math.floor((e-l[E])/a[E]),P=0;P<V;P++){var $=B.tauRandInt(N,this.random),T=s[$],O=Ae(j,T),L=0;if(O>0)L=2*p*d,L/=(.001+O)*(m*Math.pow(O,d)+1);else if(F===$)continue;for(var b=0;b<v;b++){var x=4;L>0&&(x=Ze(L*(j[b]-T[b]),S)),j[b]+=x*w}}l[E]+=V*a[E]}return r.alpha=c*(1-e/M),r.currentEpoch+=1,o},n.prototype.optimizeLayoutAsync=function(e){var r=this;return e===void 0&&(e=function(){return!0}),new Promise(function(t,i){var o=function(){return We(r,void 0,void 0,function(){var s,u,h,l,a,f;return Xe(this,function(c){try{if(s=this.optimizationState,u=s.nEpochs,h=s.currentEpoch,this.embedding=this.optimizeLayoutStep(h),l=this.optimizationState.currentEpoch,a=e(l)===!1,f=l===u,!a&&!f)setTimeout(function(){return o()},0);else return[2,t(f)]}catch(w){i(w)}return[2]})})};setTimeout(function(){return o()},0)})},n.prototype.optimizeLayout=function(e){e===void 0&&(e=function(){return!0});for(var r=!1,t=[];!r;){var i=this.optimizationState,o=i.nEpochs,s=i.currentEpoch;t=this.optimizeLayoutStep(s);var u=this.optimizationState.currentEpoch,h=e(u)===!1;r=u===o||h}return t},n.prototype.getNEpochs=function(){var e=this.graph;if(this.nEpochs>0)return this.nEpochs;var r=e.nRows;return r<=2500?500:r<=5e3?400:r<=7500?300:200},n}();lt.UMAP=xi;function Je(n,e){for(var r=0,t=0;t<n.length;t++)r+=Math.pow(n[t]-e[t],2);return Math.sqrt(r)}lt.euclidean=Je;function bi(n,e){for(var r=0,t=0,i=0,o=0;o<n.length;o++)r+=n[o]*e[o],t+=Math.pow(n[o],2),i+=Math.pow(e[o],2);return t===0&&i===0?0:t===0||i===0?1:1-r/Math.sqrt(t*i)}lt.cosine=bi;var Mi=function(){function n(){this.currentEpoch=0,this.headEmbedding=[],this.tailEmbedding=[],this.head=[],this.tail=[],this.epochsPerSample=[],this.epochOfNextSample=[],this.epochOfNextNegativeSample=[],this.epochsPerNegativeSample=[],this.moveOther=!0,this.initialAlpha=1,this.alpha=1,this.gamma=1,this.a=1.5769434603113077,this.b=.8950608779109733,this.dim=2,this.nEpochs=500,this.nVertices=0}return n}();function Ze(n,e){return n>e?e:n<-e?-e:n}function Ae(n,e){for(var r=0,t=0;t<n.length;t++)r+=Math.pow(n[t]-e[t],2);return r}function tr(n,e){var r=function(c){var w=ge(c,2),p=w[0],m=w[1];return function(d){return 1/(1+p*Math.pow(d,2*m))}},t=B.linear(0,n*3,300).map(function(c){return c<e?1:c}),i=B.zeros(t.length).map(function(c,w){var p=t[w]>=e;return p?Math.exp(-(t[w]-e)/n):c}),o=[.5,.5],s={x:t,y:i},u={damping:1.5,initialValues:o,gradientDifference:.1,maxIterations:100,errorTolerance:.01},h=yi.default(s,r,u).parameterValues,l=ge(h,2),a=l[0],f=l[1];return{a,b:f}}lt.findABParams=tr;function er(n,e,r,t){return r===void 0&&(r=1),t===void 0&&(t=5),n.map(function(i,o,s){return e[o]===-1||e[s]===-1?i*Math.exp(-r):e[o]!==e[s]?i*Math.exp(-t):i})}lt.fastIntersection=er;function rr(n){n=D.normalize(n,"max");var e=D.transpose(n),r=D.pairwiseMultiply(e,n);return n=D.add(n,D.subtract(e,r)),D.eliminateZeros(n)}lt.resetLocalConnectivity=rr;function nr(n,e,r){for(var t=B.zeros(n.length).map(function(h){return B.zeros(r[0].length)}),i=0;i<n.length;i++)for(var o=0;o<n[0].length;o++)for(var s=0;s<r[0].length;s++){var u=n[i][o];t[i][s]+=e[i][o]*r[u][s]}return t}lt.initTransform=nr,Object.defineProperty(ke,"__esModule",{value:!0});var Si=lt,Ni=ke.UMAP=Si.UMAP;function Ei(n){const e=+this._x.call(null,n),r=+this._y.call(null,n);return ir(this.cover(e,r),e,r,n)}function ir(n,e,r,t){if(isNaN(e)||isNaN(r))return n;var i,o=n._root,s={data:t},u=n._x0,h=n._y0,l=n._x1,a=n._y1,f,c,w,p,m,d,v,M;if(!o)return n._root=s,n;for(;o.length;)if((m=e>=(f=(u+l)/2))?u=f:l=f,(d=r>=(c=(h+a)/2))?h=c:a=c,i=o,!(o=o[v=d<<1|m]))return i[v]=s,n;if(w=+n._x.call(null,o.data),p=+n._y.call(null,o.data),e===w&&r===p)return s.next=o,i?i[v]=s:n._root=s,n;do i=i?i[v]=new Array(4):n._root=new Array(4),(m=e>=(f=(u+l)/2))?u=f:l=f,(d=r>=(c=(h+a)/2))?h=c:a=c;while((v=d<<1|m)===(M=(p>=c)<<1|w>=f));return i[M]=o,i[v]=s,n}function _i(n){var e,r,t=n.length,i,o,s=new Array(t),u=new Array(t),h=1/0,l=1/0,a=-1/0,f=-1/0;for(r=0;r<t;++r)isNaN(i=+this._x.call(null,e=n[r]))||isNaN(o=+this._y.call(null,e))||(s[r]=i,u[r]=o,i<h&&(h=i),i>a&&(a=i),o<l&&(l=o),o>f&&(f=o));if(h>a||l>f)return this;for(this.cover(h,l).cover(a,f),r=0;r<t;++r)ir(this,s[r],u[r],n[r]);return this}function ki(n,e){if(isNaN(n=+n)||isNaN(e=+e))return this;var r=this._x0,t=this._y0,i=this._x1,o=this._y1;if(isNaN(r))i=(r=Math.floor(n))+1,o=(t=Math.floor(e))+1;else{for(var s=i-r||1,u=this._root,h,l;r>n||n>=i||t>e||e>=o;)switch(l=(e<t)<<1|n<r,h=new Array(4),h[l]=u,u=h,s*=2,l){case 0:i=r+s,o=t+s;break;case 1:r=i-s,o=t+s;break;case 2:i=r+s,t=o-s;break;case 3:r=i-s,t=o-s;break}this._root&&this._root.length&&(this._root=u)}return this._x0=r,this._y0=t,this._x1=i,this._y1=o,this}function ji(){var n=[];return this.visit(function(e){if(!e.length)do n.push(e.data);while(e=e.next)}),n}function Ri(n){return arguments.length?this.cover(+n[0][0],+n[0][1]).cover(+n[1][0],+n[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function K(n,e,r,t,i){this.node=n,this.x0=e,this.y0=r,this.x1=t,this.y1=i}function $i(n,e,r){var t,i=this._x0,o=this._y0,s,u,h,l,a=this._x1,f=this._y1,c=[],w=this._root,p,m;for(w&&c.push(new K(w,i,o,a,f)),r==null?r=1/0:(i=n-r,o=e-r,a=n+r,f=e+r,r*=r);p=c.pop();)if(!(!(w=p.node)||(s=p.x0)>a||(u=p.y0)>f||(h=p.x1)<i||(l=p.y1)<o))if(w.length){var d=(s+h)/2,v=(u+l)/2;c.push(new K(w[3],d,v,h,l),new K(w[2],s,v,d,l),new K(w[1],d,u,h,v),new K(w[0],s,u,d,v)),(m=(e>=v)<<1|n>=d)&&(p=c[c.length-1],c[c.length-1]=c[c.length-1-m],c[c.length-1-m]=p)}else{var M=n-+this._x.call(null,w.data),N=e-+this._y.call(null,w.data),S=M*M+N*N;if(S<r){var E=Math.sqrt(r=S);i=n-E,o=e-E,a=n+E,f=e+E,t=w.data}}return t}function zi(n){if(isNaN(a=+this._x.call(null,n))||isNaN(f=+this._y.call(null,n)))return this;var e,r=this._root,t,i,o,s=this._x0,u=this._y0,h=this._x1,l=this._y1,a,f,c,w,p,m,d,v;if(!r)return this;if(r.length)for(;;){if((p=a>=(c=(s+h)/2))?s=c:h=c,(m=f>=(w=(u+l)/2))?u=w:l=w,e=r,!(r=r[d=m<<1|p]))return this;if(!r.length)break;(e[d+1&3]||e[d+2&3]||e[d+3&3])&&(t=e,v=d)}for(;r.data!==n;)if(i=r,!(r=r.next))return this;return(o=r.next)&&delete r.next,i?(o?i.next=o:delete i.next,this):e?(o?e[d]=o:delete e[d],(r=e[0]||e[1]||e[2]||e[3])&&r===(e[3]||e[2]||e[1]||e[0])&&!r.length&&(t?t[v]=r:this._root=r),this):(this._root=o,this)}function Ii(n){for(var e=0,r=n.length;e<r;++e)this.remove(n[e]);return this}function Pi(){return this._root}function Ti(){var n=0;return this.visit(function(e){if(!e.length)do++n;while(e=e.next)}),n}function Fi(n){var e=[],r,t=this._root,i,o,s,u,h;for(t&&e.push(new K(t,this._x0,this._y0,this._x1,this._y1));r=e.pop();)if(!n(t=r.node,o=r.x0,s=r.y0,u=r.x1,h=r.y1)&&t.length){var l=(o+u)/2,a=(s+h)/2;(i=t[3])&&e.push(new K(i,l,a,u,h)),(i=t[2])&&e.push(new K(i,o,a,l,h)),(i=t[1])&&e.push(new K(i,l,s,u,a)),(i=t[0])&&e.push(new K(i,o,s,l,a))}return this}function Vi(n){var e=[],r=[],t;for(this._root&&e.push(new K(this._root,this._x0,this._y0,this._x1,this._y1));t=e.pop();){var i=t.node;if(i.length){var o,s=t.x0,u=t.y0,h=t.x1,l=t.y1,a=(s+h)/2,f=(u+l)/2;(o=i[0])&&e.push(new K(o,s,u,a,f)),(o=i[1])&&e.push(new K(o,a,u,h,f)),(o=i[2])&&e.push(new K(o,s,f,a,l)),(o=i[3])&&e.push(new K(o,a,f,h,l))}r.push(t)}for(;t=r.pop();)n(t.node,t.x0,t.y0,t.x1,t.y1);return this}function Oi(n){return n[0]}function Li(n){return arguments.length?(this._x=n,this):this._x}function qi(n){return n[1]}function Di(n){return arguments.length?(this._y=n,this):this._y}function or(n,e,r){var t=new me(e??Oi,r??qi,NaN,NaN,NaN,NaN);return n==null?t:t.addAll(n)}function me(n,e,r,t,i,o){this._x=n,this._y=e,this._x0=r,this._y0=t,this._x1=i,this._y1=o,this._root=void 0}function sr(n){for(var e={data:n.data},r=e;n=n.next;)r=r.next={data:n.data};return e}var Q=or.prototype=me.prototype;Q.copy=function(){var n=new me(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,r,t;if(!e)return n;if(!e.length)return n._root=sr(e),n;for(r=[{source:e,target:n._root=new Array(4)}];e=r.pop();)for(var i=0;i<4;++i)(t=e.source[i])&&(t.length?r.push({source:t,target:e.target[i]=new Array(4)}):e.target[i]=sr(t));return n},Q.add=Ei,Q.addAll=_i,Q.cover=ki,Q.data=ji,Q.extent=Ri,Q.find=$i,Q.remove=zi,Q.removeAll=Ii,Q.root=Pi,Q.size=Ti,Q.visit=Fi,Q.visitAfter=Vi,Q.x=Li,Q.y=Di;function ot(n){return function(){return n}}function ur(n){return(n()-.5)*1e-6}function Ci(n){return n.x+n.vx}function Bi(n){return n.y+n.vy}function Ui(n){var e,r,t,i=1,o=1;typeof n!="function"&&(n=ot(n==null?1:+n));function s(){for(var l,a=e.length,f,c,w,p,m,d,v=0;v<o;++v)for(f=or(e,Ci,Bi).visitAfter(u),l=0;l<a;++l)c=e[l],m=r[c.index],d=m*m,w=c.x+c.vx,p=c.y+c.vy,f.visit(M);function M(N,S,E,F,k){var j=N.data,q=N.r,g=m+q;if(j){if(j.index>c.index){var y=w-j.x-j.vx,b=p-j.y-j.vy,x=y*y+b*b;x<g*g&&(y===0&&(y=ur(t),x+=y*y),b===0&&(b=ur(t),x+=b*b),x=(g-(x=Math.sqrt(x)))/x*i,c.vx+=(y*=x)*(g=(q*=q)/(d+q)),c.vy+=(b*=x)*g,j.vx-=y*(g=1-g),j.vy-=b*g)}return}return S>w+g||F<w-g||E>p+g||k<p-g}}function u(l){if(l.data)return l.r=r[l.data.index];for(var a=l.r=0;a<4;++a)l[a]&&l[a].r>l.r&&(l.r=l[a].r)}function h(){if(e){var l,a=e.length,f;for(r=new Array(a),l=0;l<a;++l)f=e[l],r[f.index]=+n(f,l,e)}}return s.initialize=function(l,a){e=l,t=a,h()},s.iterations=function(l){return arguments.length?(o=+l,s):o},s.strength=function(l){return arguments.length?(i=+l,s):i},s.radius=function(l){return arguments.length?(n=typeof l=="function"?l:ot(+l),h(),s):n},s}var Yi={value:()=>{}};function lr(){for(var n=0,e=arguments.length,r={},t;n<e;++n){if(!(t=arguments[n]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new Wt(r)}function Wt(n){this._=n}function Gi(n,e){return n.trim().split(/^|\s+/).map(function(r){var t="",i=r.indexOf(".");if(i>=0&&(t=r.slice(i+1),r=r.slice(0,i)),r&&!e.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:t}})}Wt.prototype=lr.prototype={constructor:Wt,on:function(n,e){var r=this._,t=Gi(n+"",r),i,o=-1,s=t.length;if(arguments.length<2){for(;++o<s;)if((i=(n=t[o]).type)&&(i=Wi(r[i],n.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<s;)if(i=(n=t[o]).type)r[i]=hr(r[i],n.name,e);else if(e==null)for(i in r)r[i]=hr(r[i],n.name,null);return this},copy:function(){var n={},e=this._;for(var r in e)n[r]=e[r].slice();return new Wt(n)},call:function(n,e){if((i=arguments.length-2)>0)for(var r=new Array(i),t=0,i,o;t<i;++t)r[t]=arguments[t+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(o=this._[n],t=0,i=o.length;t<i;++t)o[t].value.apply(e,r)},apply:function(n,e,r){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var t=this._[n],i=0,o=t.length;i<o;++i)t[i].value.apply(e,r)}};function Wi(n,e){for(var r=0,t=n.length,i;r<t;++r)if((i=n[r]).name===e)return i.value}function hr(n,e,r){for(var t=0,i=n.length;t<i;++t)if(n[t].name===e){n[t]=Yi,n=n.slice(0,t).concat(n.slice(t+1));break}return r!=null&&n.push({name:e,value:r}),n}var bt=0,jt=0,Rt=0,ar=1e3,Xt,$t,Kt=0,ct=0,Qt=0,zt=typeof performance=="object"&&performance.now?performance:Date,fr=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function cr(){return ct||(fr(Xi),ct=zt.now()+Qt)}function Xi(){ct=0}function pe(){this._call=this._time=this._next=null}pe.prototype=gr.prototype={constructor:pe,restart:function(n,e,r){if(typeof n!="function")throw new TypeError("callback is not a function");r=(r==null?cr():+r)+(e==null?0:+e),!this._next&&$t!==this&&($t?$t._next=this:Xt=this,$t=this),this._call=n,this._time=r,we()},stop:function(){this._call&&(this._call=null,this._time=1/0,we())}};function gr(n,e,r){var t=new pe;return t.restart(n,e,r),t}function Ki(){cr(),++bt;for(var n=Xt,e;n;)(e=ct-n._time)>=0&&n._call.call(void 0,e),n=n._next;--bt}function mr(){ct=(Kt=zt.now())+Qt,bt=jt=0;try{Ki()}finally{bt=0,Hi(),ct=0}}function Qi(){var n=zt.now(),e=n-Kt;e>ar&&(Qt-=e,Kt=n)}function Hi(){for(var n,e=Xt,r,t=1/0;e;)e._call?(t>e._time&&(t=e._time),n=e,e=e._next):(r=e._next,e._next=null,e=n?n._next=r:Xt=r);$t=n,we(t)}function we(n){if(!bt){jt&&(jt=clearTimeout(jt));var e=n-ct;e>24?(n<1/0&&(jt=setTimeout(mr,n-zt.now()-Qt)),Rt&&(Rt=clearInterval(Rt))):(Rt||(Kt=zt.now(),Rt=setInterval(Qi,ar)),bt=1,fr(mr))}}const Ji=1664525,Zi=1013904223,pr=4294967296;function Ai(){let n=1;return()=>(n=(Ji*n+Zi)%pr)/pr}var to=10,eo=Math.PI*(3-Math.sqrt(5));function ro(n){var e,r=1,t=.001,i=1-Math.pow(t,1/300),o=0,s=.6,u=new Map,h=gr(f),l=lr("tick","end"),a=Ai();n==null&&(n=[]);function f(){c(),l.call("tick",e),r<t&&(h.stop(),l.call("end",e))}function c(m){var d,v=n.length,M;m===void 0&&(m=1);for(var N=0;N<m;++N)for(r+=(o-r)*i,u.forEach(function(S){S(r)}),d=0;d<v;++d)M=n[d],M.fx==null?M.x+=M.vx*=s:(M.x=M.fx,M.vx=0),M.fy==null?M.y+=M.vy*=s:(M.y=M.fy,M.vy=0);return e}function w(){for(var m=0,d=n.length,v;m<d;++m){if(v=n[m],v.index=m,v.fx!=null&&(v.x=v.fx),v.fy!=null&&(v.y=v.fy),isNaN(v.x)||isNaN(v.y)){var M=to*Math.sqrt(.5+m),N=m*eo;v.x=M*Math.cos(N),v.y=M*Math.sin(N)}(isNaN(v.vx)||isNaN(v.vy))&&(v.vx=v.vy=0)}}function p(m){return m.initialize&&m.initialize(n,a),m}return w(),e={tick:c,restart:function(){return h.restart(f),e},stop:function(){return h.stop(),e},nodes:function(m){return arguments.length?(n=m,w(),u.forEach(p),e):n},alpha:function(m){return arguments.length?(r=+m,e):r},alphaMin:function(m){return arguments.length?(t=+m,e):t},alphaDecay:function(m){return arguments.length?(i=+m,e):+i},alphaTarget:function(m){return arguments.length?(o=+m,e):o},velocityDecay:function(m){return arguments.length?(s=1-m,e):1-s},randomSource:function(m){return arguments.length?(a=m,u.forEach(p),e):a},force:function(m,d){return arguments.length>1?(d==null?u.delete(m):u.set(m,p(d)),e):u.get(m)},find:function(m,d,v){var M=0,N=n.length,S,E,F,k,j;for(v==null?v=1/0:v*=v,M=0;M<N;++M)k=n[M],S=m-k.x,E=d-k.y,F=S*S+E*E,F<v&&(j=k,v=F);return j},on:function(m,d){return arguments.length>1?(l.on(m,d),e):l.on(m)}}}function no(n){var e=ot(.1),r,t,i;typeof n!="function"&&(n=ot(n==null?0:+n));function o(u){for(var h=0,l=r.length,a;h<l;++h)a=r[h],a.vx+=(i[h]-a.x)*t[h]*u}function s(){if(r){var u,h=r.length;for(t=new Array(h),i=new Array(h),u=0;u<h;++u)t[u]=isNaN(i[u]=+n(r[u],u,r))?0:+e(r[u],u,r)}}return o.initialize=function(u){r=u,s()},o.strength=function(u){return arguments.length?(e=typeof u=="function"?u:ot(+u),s(),o):e},o.x=function(u){return arguments.length?(n=typeof u=="function"?u:ot(+u),s(),o):n},o}function io(n){var e=ot(.1),r,t,i;typeof n!="function"&&(n=ot(n==null?0:+n));function o(u){for(var h=0,l=r.length,a;h<l;++h)a=r[h],a.vy+=(i[h]-a.y)*t[h]*u}function s(){if(r){var u,h=r.length;for(t=new Array(h),i=new Array(h),u=0;u<h;++u)t[u]=isNaN(i[u]=+n(r[u],u,r))?0:+e(r[u],u,r)}}return o.initialize=function(u){r=u,s()},o.strength=function(u){return arguments.length?(e=typeof u=="function"?u:ot(+u),s(),o):e},o.y=function(u){return arguments.length?(n=typeof u=="function"?u:ot(+u),s(),o):n},o}function Ht(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function oo(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function wr(n){let e,r,t;n.length!==2?(e=Ht,r=(u,h)=>Ht(n(u),h),t=(u,h)=>n(u)-h):(e=n===Ht||n===oo?n:so,r=n,t=n);function i(u,h,l=0,a=u.length){if(l<a){if(e(h,h)!==0)return a;do{const f=l+a>>>1;r(u[f],h)<0?l=f+1:a=f}while(l<a)}return l}function o(u,h,l=0,a=u.length){if(l<a){if(e(h,h)!==0)return a;do{const f=l+a>>>1;r(u[f],h)<=0?l=f+1:a=f}while(l<a)}return l}function s(u,h,l=0,a=u.length){const f=i(u,h,l,a-1);return f>l&&t(u[f-1],h)>-t(u[f],h)?f-1:f}return{left:i,center:s,right:o}}function so(){return 0}function uo(n){return n===null?NaN:+n}const lo=wr(Ht).right;wr(uo).center;var ho=lo;const ao=Math.sqrt(50),fo=Math.sqrt(10),co=Math.sqrt(2);function Jt(n,e,r){const t=(e-n)/Math.max(0,r),i=Math.floor(Math.log10(t)),o=t/Math.pow(10,i),s=o>=ao?10:o>=fo?5:o>=co?2:1;let u,h,l;return i<0?(l=Math.pow(10,-i)/s,u=Math.round(n*l),h=Math.round(e*l),u/l<n&&++u,h/l>e&&--h,l=-l):(l=Math.pow(10,i)*s,u=Math.round(n/l),h=Math.round(e/l),u*l<n&&++u,h*l>e&&--h),h<u&&.5<=r&&r<2?Jt(n,e,r*2):[u,h,l]}function go(n,e,r){if(e=+e,n=+n,r=+r,!(r>0))return[];if(n===e)return[n];const t=e<n,[i,o,s]=t?Jt(e,n,r):Jt(n,e,r);if(!(o>=i))return[];const u=o-i+1,h=new Array(u);if(t)if(s<0)for(let l=0;l<u;++l)h[l]=(o-l)/-s;else for(let l=0;l<u;++l)h[l]=(o-l)*s;else if(s<0)for(let l=0;l<u;++l)h[l]=(i+l)/-s;else for(let l=0;l<u;++l)h[l]=(i+l)*s;return h}function ve(n,e,r){return e=+e,n=+n,r=+r,Jt(n,e,r)[2]}function mo(n,e,r){e=+e,n=+n,r=+r;const t=e<n,i=t?ve(e,n,r):ve(n,e,r);return(t?-1:1)*(i<0?1/-i:i)}function po(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function de(n,e,r){n.prototype=e.prototype=r,r.constructor=n}function vr(n,e){var r=Object.create(n.prototype);for(var t in e)r[t]=e[t];return r}function It(){}var Pt=.7,Zt=1/Pt,Mt="\\s*([+-]?\\d+)\\s*",Tt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",st="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",wo=/^#([0-9a-f]{3,8})$/,vo=new RegExp(`^rgb\\(${Mt},${Mt},${Mt}\\)$`),yo=new RegExp(`^rgb\\(${st},${st},${st}\\)$`),xo=new RegExp(`^rgba\\(${Mt},${Mt},${Mt},${Tt}\\)$`),bo=new RegExp(`^rgba\\(${st},${st},${st},${Tt}\\)$`),Mo=new RegExp(`^hsl\\(${Tt},${st},${st}\\)$`),So=new RegExp(`^hsla\\(${Tt},${st},${st},${Tt}\\)$`),dr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};de(It,Ft,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:yr,formatHex:yr,formatHex8:No,formatHsl:Eo,formatRgb:xr,toString:xr});function yr(){return this.rgb().formatHex()}function No(){return this.rgb().formatHex8()}function Eo(){return Er(this).formatHsl()}function xr(){return this.rgb().formatRgb()}function Ft(n){var e,r;return n=(n+"").trim().toLowerCase(),(e=wo.exec(n))?(r=e[1].length,e=parseInt(e[1],16),r===6?br(e):r===3?new J(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?At(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?At(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=vo.exec(n))?new J(e[1],e[2],e[3],1):(e=yo.exec(n))?new J(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=xo.exec(n))?At(e[1],e[2],e[3],e[4]):(e=bo.exec(n))?At(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Mo.exec(n))?Nr(e[1],e[2]/100,e[3]/100,1):(e=So.exec(n))?Nr(e[1],e[2]/100,e[3]/100,e[4]):dr.hasOwnProperty(n)?br(dr[n]):n==="transparent"?new J(NaN,NaN,NaN,0):null}function br(n){return new J(n>>16&255,n>>8&255,n&255,1)}function At(n,e,r,t){return t<=0&&(n=e=r=NaN),new J(n,e,r,t)}function _o(n){return n instanceof It||(n=Ft(n)),n?(n=n.rgb(),new J(n.r,n.g,n.b,n.opacity)):new J}function ye(n,e,r,t){return arguments.length===1?_o(n):new J(n,e,r,t??1)}function J(n,e,r,t){this.r=+n,this.g=+e,this.b=+r,this.opacity=+t}de(J,ye,vr(It,{brighter(n){return n=n==null?Zt:Math.pow(Zt,n),new J(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Pt:Math.pow(Pt,n),new J(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new J(gt(this.r),gt(this.g),gt(this.b),te(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Mr,formatHex:Mr,formatHex8:ko,formatRgb:Sr,toString:Sr}));function Mr(){return`#${mt(this.r)}${mt(this.g)}${mt(this.b)}`}function ko(){return`#${mt(this.r)}${mt(this.g)}${mt(this.b)}${mt((isNaN(this.opacity)?1:this.opacity)*255)}`}function Sr(){const n=te(this.opacity);return`${n===1?"rgb(":"rgba("}${gt(this.r)}, ${gt(this.g)}, ${gt(this.b)}${n===1?")":`, ${n})`}`}function te(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function gt(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function mt(n){return n=gt(n),(n<16?"0":"")+n.toString(16)}function Nr(n,e,r,t){return t<=0?n=e=r=NaN:r<=0||r>=1?n=e=NaN:e<=0&&(n=NaN),new nt(n,e,r,t)}function Er(n){if(n instanceof nt)return new nt(n.h,n.s,n.l,n.opacity);if(n instanceof It||(n=Ft(n)),!n)return new nt;if(n instanceof nt)return n;n=n.rgb();var e=n.r/255,r=n.g/255,t=n.b/255,i=Math.min(e,r,t),o=Math.max(e,r,t),s=NaN,u=o-i,h=(o+i)/2;return u?(e===o?s=(r-t)/u+(r<t)*6:r===o?s=(t-e)/u+2:s=(e-r)/u+4,u/=h<.5?o+i:2-o-i,s*=60):u=h>0&&h<1?0:s,new nt(s,u,h,n.opacity)}function jo(n,e,r,t){return arguments.length===1?Er(n):new nt(n,e,r,t??1)}function nt(n,e,r,t){this.h=+n,this.s=+e,this.l=+r,this.opacity=+t}de(nt,jo,vr(It,{brighter(n){return n=n==null?Zt:Math.pow(Zt,n),new nt(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Pt:Math.pow(Pt,n),new nt(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,r=this.l,t=r+(r<.5?r:1-r)*e,i=2*r-t;return new J(xe(n>=240?n-240:n+120,i,t),xe(n,i,t),xe(n<120?n+240:n-120,i,t),this.opacity)},clamp(){return new nt(_r(this.h),ee(this.s),ee(this.l),te(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=te(this.opacity);return`${n===1?"hsl(":"hsla("}${_r(this.h)}, ${ee(this.s)*100}%, ${ee(this.l)*100}%${n===1?")":`, ${n})`}`}}));function _r(n){return n=(n||0)%360,n<0?n+360:n}function ee(n){return Math.max(0,Math.min(1,n||0))}function xe(n,e,r){return(n<60?e+(r-e)*n/60:n<180?r:n<240?e+(r-e)*(240-n)/60:e)*255}var be=n=>()=>n;function Ro(n,e){return function(r){return n+r*e}}function $o(n,e,r){return n=Math.pow(n,r),e=Math.pow(e,r)-n,r=1/r,function(t){return Math.pow(n+t*e,r)}}function zo(n){return(n=+n)==1?kr:function(e,r){return r-e?$o(e,r,n):be(isNaN(e)?r:e)}}function kr(n,e){var r=e-n;return r?Ro(n,r):be(isNaN(n)?e:n)}var jr=function n(e){var r=zo(e);function t(i,o){var s=r((i=ye(i)).r,(o=ye(o)).r),u=r(i.g,o.g),h=r(i.b,o.b),l=kr(i.opacity,o.opacity);return function(a){return i.r=s(a),i.g=u(a),i.b=h(a),i.opacity=l(a),i+""}}return t.gamma=n,t}(1);function Io(n,e){e||(e=[]);var r=n?Math.min(e.length,n.length):0,t=e.slice(),i;return function(o){for(i=0;i<r;++i)t[i]=n[i]*(1-o)+e[i]*o;return t}}function Po(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function To(n,e){var r=e?e.length:0,t=n?Math.min(r,n.length):0,i=new Array(t),o=new Array(r),s;for(s=0;s<t;++s)i[s]=Ne(n[s],e[s]);for(;s<r;++s)o[s]=e[s];return function(u){for(s=0;s<t;++s)o[s]=i[s](u);return o}}function Fo(n,e){var r=new Date;return n=+n,e=+e,function(t){return r.setTime(n*(1-t)+e*t),r}}function re(n,e){return n=+n,e=+e,function(r){return n*(1-r)+e*r}}function Vo(n,e){var r={},t={},i;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in n?r[i]=Ne(n[i],e[i]):t[i]=e[i];return function(o){for(i in r)t[i]=r[i](o);return t}}var Me=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Se=new RegExp(Me.source,"g");function Oo(n){return function(){return n}}function Lo(n){return function(e){return n(e)+""}}function qo(n,e){var r=Me.lastIndex=Se.lastIndex=0,t,i,o,s=-1,u=[],h=[];for(n=n+"",e=e+"";(t=Me.exec(n))&&(i=Se.exec(e));)(o=i.index)>r&&(o=e.slice(r,o),u[s]?u[s]+=o:u[++s]=o),(t=t[0])===(i=i[0])?u[s]?u[s]+=i:u[++s]=i:(u[++s]=null,h.push({i:s,x:re(t,i)})),r=Se.lastIndex;return r<e.length&&(o=e.slice(r),u[s]?u[s]+=o:u[++s]=o),u.length<2?h[0]?Lo(h[0].x):Oo(e):(e=h.length,function(l){for(var a=0,f;a<e;++a)u[(f=h[a]).i]=f.x(l);return u.join("")})}function Ne(n,e){var r=typeof e,t;return e==null||r==="boolean"?be(e):(r==="number"?re:r==="string"?(t=Ft(e))?(e=t,jr):qo:e instanceof Ft?jr:e instanceof Date?Fo:Po(e)?Io:Array.isArray(e)?To:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Vo:re)(n,e)}function Do(n,e){return n=+n,e=+e,function(r){return Math.round(n*(1-r)+e*r)}}function Co(n){return function(){return n}}function Bo(n){return+n}var Rr=[0,1];function St(n){return n}function Ee(n,e){return(e-=n=+n)?function(r){return(r-n)/e}:Co(isNaN(e)?NaN:.5)}function Uo(n,e){var r;return n>e&&(r=n,n=e,e=r),function(t){return Math.max(n,Math.min(e,t))}}function Yo(n,e,r){var t=n[0],i=n[1],o=e[0],s=e[1];return i<t?(t=Ee(i,t),o=r(s,o)):(t=Ee(t,i),o=r(o,s)),function(u){return o(t(u))}}function Go(n,e,r){var t=Math.min(n.length,e.length)-1,i=new Array(t),o=new Array(t),s=-1;for(n[t]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++s<t;)i[s]=Ee(n[s],n[s+1]),o[s]=r(e[s],e[s+1]);return function(u){var h=ho(n,u,1,t)-1;return o[h](i[h](u))}}function Wo(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function Xo(){var n=Rr,e=Rr,r=Ne,t,i,o,s=St,u,h,l;function a(){var c=Math.min(n.length,e.length);return s!==St&&(s=Uo(n[0],n[c-1])),u=c>2?Go:Yo,h=l=null,f}function f(c){return c==null||isNaN(c=+c)?o:(h||(h=u(n.map(t),e,r)))(t(s(c)))}return f.invert=function(c){return s(i((l||(l=u(e,n.map(t),re)))(c)))},f.domain=function(c){return arguments.length?(n=Array.from(c,Bo),a()):n.slice()},f.range=function(c){return arguments.length?(e=Array.from(c),a()):e.slice()},f.rangeRound=function(c){return e=Array.from(c),r=Do,a()},f.clamp=function(c){return arguments.length?(s=c?!0:St,a()):s!==St},f.interpolate=function(c){return arguments.length?(r=c,a()):r},f.unknown=function(c){return arguments.length?(o=c,f):o},function(c,w){return t=c,i=w,a()}}function Ko(){return Xo()(St,St)}function Qo(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function ne(n,e){if((r=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var r,t=n.slice(0,r);return[t.length>1?t[0]+t.slice(2):t,+n.slice(r+1)]}function Nt(n){return n=ne(Math.abs(n)),n?n[1]:NaN}function Ho(n,e){return function(r,t){for(var i=r.length,o=[],s=0,u=n[0],h=0;i>0&&u>0&&(h+u+1>t&&(u=Math.max(1,t-h)),o.push(r.substring(i-=u,i+u)),!((h+=u+1)>t));)u=n[s=(s+1)%n.length];return o.reverse().join(e)}}function Jo(n){return function(e){return e.replace(/[0-9]/g,function(r){return n[+r]})}}var Zo=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ie(n){if(!(e=Zo.exec(n)))throw new Error("invalid format: "+n);var e;return new _e({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}ie.prototype=_e.prototype;function _e(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}_e.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Ao(n){t:for(var e=n.length,r=1,t=-1,i;r<e;++r)switch(n[r]){case".":t=i=r;break;case"0":t===0&&(t=r),i=r;break;default:if(!+n[r])break t;t>0&&(t=0);break}return t>0?n.slice(0,t)+n.slice(i+1):n}var $r;function ts(n,e){var r=ne(n,e);if(!r)return n+"";var t=r[0],i=r[1],o=i-($r=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=t.length;return o===s?t:o>s?t+new Array(o-s+1).join("0"):o>0?t.slice(0,o)+"."+t.slice(o):"0."+new Array(1-o).join("0")+ne(n,Math.max(0,e+o-1))[0]}function zr(n,e){var r=ne(n,e);if(!r)return n+"";var t=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+t:t.length>i+1?t.slice(0,i+1)+"."+t.slice(i+1):t+new Array(i-t.length+2).join("0")}var Ir={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:Qo,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>zr(n*100,e),r:zr,s:ts,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function Pr(n){return n}var Tr=Array.prototype.map,Fr=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function es(n){var e=n.grouping===void 0||n.thousands===void 0?Pr:Ho(Tr.call(n.grouping,Number),n.thousands+""),r=n.currency===void 0?"":n.currency[0]+"",t=n.currency===void 0?"":n.currency[1]+"",i=n.decimal===void 0?".":n.decimal+"",o=n.numerals===void 0?Pr:Jo(Tr.call(n.numerals,String)),s=n.percent===void 0?"%":n.percent+"",u=n.minus===void 0?"":n.minus+"",h=n.nan===void 0?"NaN":n.nan+"";function l(f){f=ie(f);var c=f.fill,w=f.align,p=f.sign,m=f.symbol,d=f.zero,v=f.width,M=f.comma,N=f.precision,S=f.trim,E=f.type;E==="n"?(M=!0,E="g"):Ir[E]||(N===void 0&&(N=12),S=!0,E="g"),(d||c==="0"&&w==="=")&&(d=!0,c="0",w="=");var F=m==="$"?r:m==="#"&&/[boxX]/.test(E)?"0"+E.toLowerCase():"",k=m==="$"?t:/[%p]/.test(E)?s:"",j=Ir[E],q=/[defgprs%]/.test(E);N=N===void 0?6:/[gprs]/.test(E)?Math.max(1,Math.min(21,N)):Math.max(0,Math.min(20,N));function g(y){var b=F,x=k,V,P,$;if(E==="c")x=j(y)+x,y="";else{y=+y;var T=y<0||1/y<0;if(y=isNaN(y)?h:j(Math.abs(y),N),S&&(y=Ao(y)),T&&+y==0&&p!=="+"&&(T=!1),b=(T?p==="("?p:u:p==="-"||p==="("?"":p)+b,x=(E==="s"?Fr[8+$r/3]:"")+x+(T&&p==="("?")":""),q){for(V=-1,P=y.length;++V<P;)if($=y.charCodeAt(V),48>$||$>57){x=($===46?i+y.slice(V+1):y.slice(V))+x,y=y.slice(0,V);break}}}M&&!d&&(y=e(y,1/0));var O=b.length+y.length+x.length,L=O<v?new Array(v-O+1).join(c):"";switch(M&&d&&(y=e(L+y,L.length?v-x.length:1/0),L=""),w){case"<":y=b+y+x+L;break;case"=":y=b+L+y+x;break;case"^":y=L.slice(0,O=L.length>>1)+b+y+x+L.slice(O);break;default:y=L+b+y+x;break}return o(y)}return g.toString=function(){return f+""},g}function a(f,c){var w=l((f=ie(f),f.type="f",f)),p=Math.max(-8,Math.min(8,Math.floor(Nt(c)/3)))*3,m=Math.pow(10,-p),d=Fr[8+p/3];return function(v){return w(m*v)+d}}return{format:l,formatPrefix:a}}var oe,Vr,Or;rs({thousands:",",grouping:[3],currency:["$",""]});function rs(n){return oe=es(n),Vr=oe.format,Or=oe.formatPrefix,oe}function ns(n){return Math.max(0,-Nt(Math.abs(n)))}function is(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Nt(e)/3)))*3-Nt(Math.abs(n)))}function os(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,Nt(e)-Nt(n))+1}function ss(n,e,r,t){var i=mo(n,e,r),o;switch(t=ie(t??",f"),t.type){case"s":{var s=Math.max(Math.abs(n),Math.abs(e));return t.precision==null&&!isNaN(o=is(i,s))&&(t.precision=o),Or(t,s)}case"":case"e":case"g":case"p":case"r":{t.precision==null&&!isNaN(o=os(i,Math.max(Math.abs(n),Math.abs(e))))&&(t.precision=o-(t.type==="e"));break}case"f":case"%":{t.precision==null&&!isNaN(o=ns(i))&&(t.precision=o-(t.type==="%")*2);break}}return Vr(t)}function us(n){var e=n.domain;return n.ticks=function(r){var t=e();return go(t[0],t[t.length-1],r??10)},n.tickFormat=function(r,t){var i=e();return ss(i[0],i[i.length-1],r??10,t)},n.nice=function(r){r==null&&(r=10);var t=e(),i=0,o=t.length-1,s=t[i],u=t[o],h,l,a=10;for(u<s&&(l=s,s=u,u=l,l=i,i=o,o=l);a-- >0;){if(l=ve(s,u,r),l===h)return t[i]=s,t[o]=u,e(t);if(l>0)s=Math.floor(s/l)*l,u=Math.ceil(u/l)*l;else if(l<0)s=Math.ceil(s*l)/l,u=Math.floor(u*l)/l;else break;h=l}return n},n}function Vt(){var n=Ko();return n.copy=function(){return Wo(n,Vt())},po.apply(n,arguments),us(n)}function ls(n){let e=1e3,r=-1e3,t=1e3,i=-1e3;return n.forEach(o=>{e=Math.min(e,o.x),r=Math.max(r,o.x),t=Math.min(t,o.y),i=Math.max(i,o.y)}),{minX:e,maxX:r,minY:t,maxY:i}}function hs(n){const e=500/n.width,r=Vt().domain([n.x,n.x+n.width]).range([n.x,n.x+n.width*e]),t=Vt().domain([n.y,n.y+n.height]).range([n.y,n.y+n.height*e]);return[r,t,.006*e]}function as(n){for(var e=0,r=Math.ceil(Math.log(n.alphaMin())/Math.log(1-n.alphaDecay()));e<r;++e)n.tick()}self.onmessage=({data:{X:n,D:e,N:r,area:t,type:i,xLayout:o,yLayout:s,axis:u}})=>{if(i!=="init")return;const h=u==="xy"?2:1;self.postMessage({type:"message",message:"Calculating embedding ..."});const a=new Ni({nComponents:h,nEpochs:200,nNeighbors:15}).fit(n);console.log(a);let f,c;u==="x"?f=a.map((S,E)=>({x:S[0],y:s[E]})):u==="y"?f=a.map((S,E)=>({y:S[0],x:o[E]})):u==="xy"&&(f=a.map(S=>({x:S[0],y:S[1]}))),c=structuredClone(f);const[w,p,m]=hs(t),d=ls(f),v=Vt().domain([d.minX,d.maxX]).range([t.x+t.width*.01,t.x+t.width*.99]),M=Vt().domain([d.minY,d.maxY]).range([t.y+t.height*.01,t.y+t.height*.99]);f=f.map(S=>({x:w(v(S.x)),y:p(M(S.y))})),self.postMessage({type:"message",message:"Force layout ..."});var N=ro(c).force("collision",Ui().radius(m)).force("x",no().x(function(S){return f[S.index].x})).force("y",io().y(function(S){return f[S.index].y})).stop();as(N),self.postMessage({type:"finish",Y:N.nodes().map(S=>({x:w.invert(S.x),y:p.invert(S.y)})),xLayout:f.map(S=>w.invert(S.x)),yLayout:f.map(S=>p.invert(S.y))})}})();

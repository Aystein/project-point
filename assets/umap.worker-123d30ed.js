(function(){"use strict";var z=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fr(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var r=function t(){if(this instanceof t){var i=[null];i.push.apply(i,arguments);var o=Function.bind.apply(e,i);return new o}return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(n).forEach(function(t){var i=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(r,t,i.get?i:{enumerable:!0,get:function(){return n[t]}})}),r}var fe={},st={},nt={},C={},cr=z&&z.__values||function(n){var e=typeof Symbol=="function"&&n[Symbol.iterator],r=0;return e?e.call(n):{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}}};Object.defineProperty(C,"__esModule",{value:!0});function ce(n,e){return Math.floor(e()*n)}C.tauRandInt=ce;function gr(n){return n()}C.tauRand=gr;function mr(n){var e,r,t=0;try{for(var i=cr(n),o=i.next();!o.done;o=i.next()){var s=o.value;t+=Math.pow(s,2)}}catch(l){e={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return Math.sqrt(t)}C.norm=mr;function Rt(n){for(var e=[],r=0;r<n;r++)e.push(void 0);return e}C.empty=Rt;function pr(n){return Rt(n).map(function(e,r){return r})}C.range=pr;function Wt(n,e){return Rt(n).map(function(){return e})}C.filled=Wt;function ge(n){return Wt(n,0)}C.zeros=ge;function wr(n){return Wt(n,1)}C.ones=wr;function dr(n,e,r){return Rt(r).map(function(t,i){return n+i*((e-n)/(r-1))})}C.linear=dr;function me(n){return n.reduce(function(e,r){return e+r})}C.sum=me;function vr(n){return me(n)/n.length}C.mean=vr;function yr(n){for(var e=0,r=0;r<n.length;r++)e=n[r]>e?n[r]:e;return e}C.max=yr;function br(n){for(var e=0,r=0;r<n.length;r++)for(var t=0;t<n[r].length;t++)e=n[r][t]>e?n[r][t]:e;return e}C.max2d=br;function Mr(n,e,r){for(var t=ge(n),i=0;i<n;i++)for(var o=!0;o;){for(var s=ce(e,r),l=!1,h=0;h<i;h++)if(s===t[h]){l=!0;break}l||(o=!1),t[i]=s}return t}C.rejectionSample=Mr;function Sr(n,e,r){var t=[],i=0;if(n.length!==e*r)throw new Error("Array dimensions must match input length.");for(var o=0;o<e;o++){for(var s=[],l=0;l<r;l++)s.push(n[i]),i+=1;t.push(s)}return t}C.reshape2d=Sr;var xr=z&&z.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var r in n)Object.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e.default=n,e};Object.defineProperty(nt,"__esModule",{value:!0});var Mt=xr(C);function pe(n,e){var r=function(i){return Mt.empty(n).map(function(){return Mt.filled(e,i)})},t=[];return t.push(r(-1)),t.push(r(1/0)),t.push(r(0)),t}nt.makeHeap=pe;function Er(n,e,r){for(var t=Mt.zeros(n),i=0;i<n;i++){for(var o=!0,s=0;o;){s=Mt.tauRandInt(e,r);for(var l=!1,h=0;h<i;h++)if(s===t[h]){l=!0;break}l||(o=!1)}t[i]=s}return t}nt.rejectionSample=Er;function Kt(n,e,r,t,i){e=Math.floor(e);var o=n[0][e],s=n[1][e];if(n[2][e],r>=s[0])return 0;for(var l=0;l<o.length;l++)if(t===o[l])return 0;return we(n,e,r,t,i)}nt.heapPush=Kt;function we(n,e,r,t,i){var o=n[0][e],s=n[1][e],l=n[2][e];if(r>=s[0])return 0;s[0]=r,o[0]=t,l[0]=i;for(var h=0,u=0;;){var a=2*h+1,f=a+1,g=n[0][0].length;if(a>=g)break;if(f>=g)if(s[a]>r)u=a;else break;else if(s[a]>=s[f])if(r<s[a])u=a;else break;else if(r<s[f])u=f;else break;s[h]=s[u],o[h]=o[u],l[h]=l[u],h=u}return s[h]=r,o[h]=t,l[h]=i,1}nt.uncheckedHeapPush=we;function Nr(n,e,r,t,i){for(var o=pe(e,t),s=0;s<e;s++)for(var l=0;l<r;l++)if(!(n[0][s][l]<0)){var h=n[0][s][l],u=n[2][s][l],a=Mt.tauRand(i);Kt(o,s,a,h,u),Kt(o,h,a,s,u),n[2][s][l]=0}return o}nt.buildCandidates=Nr;function kr(n){for(var e=n[0],r=n[1],t=0;t<e.length;t++)for(var i=e[t],o=r[t],s=0;s<i.length-1;s++){var l=i.length-s-1,h=o.length-s-1,u=i[0];i[0]=i[l],i[l]=u;var a=o[0];o[0]=o[h],o[h]=a,jr(o,i,h,0)}return{indices:e,weights:r}}nt.deheapSort=kr;function jr(n,e,r,t){for(;t*2+1<r;){var i=t*2+1,o=i+1,s=t;if(n[s]<n[i]&&(s=i),o<r&&n[s]<n[o]&&(s=o),s===t)break;var l=n[t];n[t]=n[s],n[s]=l;var h=e[t];e[t]=e[s],e[s]=h,t=s}}function Rr(n,e){for(var r=n[0][e],t=n[1][e],i=n[2][e],o=1/0,s=-1,l=0;l>r.length;l++)i[l]===1&&t[l]<o&&(o=t[l],s=l);return s>=0?(i[s]=0,Math.floor(r[s])):-1}nt.smallestFlagged=Rr;var K={},$t=z&&z.__read||function(n,e){var r=typeof Symbol=="function"&&n[Symbol.iterator];if(!r)return n;var t=r.call(n),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=t.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(r=t.return)&&r.call(t)}finally{if(s)throw s.error}}return o},$r=z&&z.__values||function(n){var e=typeof Symbol=="function"&&n[Symbol.iterator],r=0;return e?e.call(n):{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}}},_r=z&&z.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var r in n)Object.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e.default=n,e};Object.defineProperty(K,"__esModule",{value:!0});var St,de=_r(C),ct=function(){function n(e,r,t,i){if(this.entries=new Map,this.nRows=0,this.nCols=0,e.length!==r.length||e.length!==t.length)throw new Error("rows, cols and values arrays must all have the same length");this.nRows=i[0],this.nCols=i[1];for(var o=0;o<t.length;o++){var s=e[o],l=r[o];this.checkDims(s,l);var h=this.makeKey(s,l);this.entries.set(h,{value:t[o],row:s,col:l})}}return n.prototype.makeKey=function(e,r){return e+":"+r},n.prototype.checkDims=function(e,r){var t=e<this.nRows&&r<this.nCols;if(!t)throw new Error("row and/or col specified outside of matrix dimensions")},n.prototype.set=function(e,r,t){this.checkDims(e,r);var i=this.makeKey(e,r);this.entries.has(i)?this.entries.get(i).value=t:this.entries.set(i,{value:t,row:e,col:r})},n.prototype.get=function(e,r,t){t===void 0&&(t=0),this.checkDims(e,r);var i=this.makeKey(e,r);return this.entries.has(i)?this.entries.get(i).value:t},n.prototype.getAll=function(e){e===void 0&&(e=!0);var r=[];return this.entries.forEach(function(t){r.push(t)}),e&&r.sort(function(t,i){return t.row===i.row?t.col-i.col:t.row-i.row}),r},n.prototype.getDims=function(){return[this.nRows,this.nCols]},n.prototype.getRows=function(){return Array.from(this.entries,function(e){var r=$t(e,2);r[0];var t=r[1];return t.row})},n.prototype.getCols=function(){return Array.from(this.entries,function(e){var r=$t(e,2);r[0];var t=r[1];return t.col})},n.prototype.getValues=function(){return Array.from(this.entries,function(e){var r=$t(e,2);r[0];var t=r[1];return t.value})},n.prototype.forEach=function(e){this.entries.forEach(function(r){return e(r.value,r.row,r.col)})},n.prototype.map=function(e){var r=[];this.entries.forEach(function(i){r.push(e(i.value,i.row,i.col))});var t=[this.nRows,this.nCols];return new n(this.getRows(),this.getCols(),r,t)},n.prototype.toArray=function(){var e=this,r=de.empty(this.nRows),t=r.map(function(){return de.zeros(e.nCols)});return this.entries.forEach(function(i){t[i.row][i.col]=i.value}),t},n}();K.SparseMatrix=ct;function zr(n){var e=[],r=[],t=[];n.forEach(function(o,s,l){e.push(s),r.push(l),t.push(o)});var i=[n.nCols,n.nRows];return new ct(r,e,t,i)}K.transpose=zr;function Ir(n){for(var e=$t(n,1),r=e[0],t=new ct([],[],[],n),i=0;i<r;i++)t.set(i,i,1);return t}K.identity=Ir;function Pr(n,e){return _t(n,e,function(r,t){return r*t})}K.pairwiseMultiply=Pr;function Fr(n,e){return _t(n,e,function(r,t){return r+t})}K.add=Fr;function Tr(n,e){return _t(n,e,function(r,t){return r-t})}K.subtract=Tr;function Vr(n,e){return _t(n,e,function(r,t){return r>t?r:t})}K.maximum=Vr;function Or(n,e){return n.map(function(r){return r*e})}K.multiplyScalar=Or;function Lr(n){for(var e=new Set,r=n.getValues(),t=n.getRows(),i=n.getCols(),o=0;o<r.length;o++)r[o]===0&&e.add(o);var s=function(a,f){return!e.has(f)},l=r.filter(s),h=t.filter(s),u=i.filter(s);return new ct(h,u,l,n.getDims())}K.eliminateZeros=Lr;function qr(n,e){e===void 0&&(e="l2");var r,t,i=Cr[e],o=new Map;n.forEach(function(f,g,d){var m=o.get(g)||[];m.push(d),o.set(g,m)});var s=new ct([],[],[],n.getDims()),l=function(f){for(var g=o.get(f).sort(),d=g.map(function(b){return n.get(f,b)}),m=i(d),p=0;p<m.length;p++)s.set(f,g[p],m[p])};try{for(var h=$r(o.keys()),u=h.next();!u.done;u=h.next()){var a=u.value;l(a)}}catch(f){r={error:f}}finally{try{u&&!u.done&&(t=h.return)&&t.call(h)}finally{if(r)throw r.error}}return s}K.normalize=qr;var Cr=(St={},St.max=function(n){for(var e=-1/0,r=0;r<n.length;r++)e=n[r]>e?n[r]:e;return n.map(function(t){return t/e})},St.l1=function(n){for(var e=0,r=0;r<n.length;r++)e+=n[r];return n.map(function(t){return t/e})},St.l2=function(n){for(var e=0,r=0;r<n.length;r++)e+=Math.pow(n[r],2);return n.map(function(t){return Math.sqrt(Math.pow(t,2)/e)})},St);function _t(n,e,r){for(var t=new Set,i=[],o=[],s=[],l=function(S,k){i.push(S),o.push(k);var E=r(n.get(S,k),e.get(S,k));s.push(E)},h=n.getValues(),u=n.getRows(),a=n.getCols(),f=0;f<h.length;f++){var g=u[f],d=a[f],m=g+":"+d;t.add(m),l(g,d)}for(var p=e.getValues(),b=e.getRows(),v=e.getCols(),f=0;f<p.length;f++){var g=b[f],d=v[f],m=g+":"+d;t.has(m)||l(g,d)}var N=[n.nRows,n.nCols];return new ct(i,o,s,N)}function Dr(n){var e=[];n.forEach(function(f,g,d){e.push({value:f,row:g,col:d})}),e.sort(function(f,g){return f.row===g.row?f.col-g.col:f.row-g.row});for(var r=[],t=[],i=[],o=-1,s=0;s<e.length;s++){var l=e[s],h=l.row,u=l.col,a=l.value;h!==o&&(o=h,i.push(s)),r.push(u),t.push(a)}return{indices:r,values:t,indptr:i}}K.getCSR=Dr;var gt={},ut={},Br=z&&z.__read||function(n,e){var r=typeof Symbol=="function"&&n[Symbol.iterator];if(!r)return n;var t=r.call(n),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=t.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(r=t.return)&&r.call(t)}finally{if(s)throw s.error}}return o},ve=z&&z.__spread||function(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(Br(arguments[e]));return n},Yr=z&&z.__values||function(n){var e=typeof Symbol=="function"&&n[Symbol.iterator],r=0;return e?e.call(n):{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}}},Ur=z&&z.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var r in n)Object.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e.default=n,e};Object.defineProperty(ut,"__esModule",{value:!0});var G=Ur(C),ye=function(){function n(e,r,t,i){this.hyperplanes=e,this.offsets=r,this.children=t,this.indices=i}return n}();ut.FlatTree=ye;function Xr(n,e,r,t){var i=Math.max(10,e),o=G.range(r).map(function(l,h){return Gr(n,i,h,t)}),s=o.map(function(l){return Kr(l,i)});return s}ut.makeForest=Xr;function Gr(n,e,r,t){e===void 0&&(e=30);var i=G.range(n.length),o=Qt(n,i,e,r,t);return o}function Qt(n,e,r,t,i){if(r===void 0&&(r=30),e.length>r){var o=Wr(n,e,i),s=o.indicesLeft,l=o.indicesRight,h=o.hyperplane,u=o.offset,a=Qt(n,s,r,t+1,i),f=Qt(n,l,r,t+1,i),g={leftChild:a,rightChild:f,isLeaf:!1,hyperplane:h,offset:u};return g}else{var g={indices:e,isLeaf:!0};return g}}function Wr(n,e,r){var t=n[0].length,i=G.tauRandInt(e.length,r),o=G.tauRandInt(e.length,r);o+=i===o?1:0,o=o%e.length;for(var s=e[i],l=e[o],h=0,u=G.zeros(t),a=0;a<u.length;a++)u[a]=n[s][a]-n[l][a],h-=u[a]*(n[s][a]+n[l][a])/2;for(var f=0,g=0,d=G.zeros(e.length),a=0;a<e.length;a++){for(var m=h,p=0;p<t;p++)m+=u[p]*n[e[a]][p];m===0?(d[a]=G.tauRandInt(2,r),d[a]===0?f+=1:g+=1):m>0?(d[a]=0,f+=1):(d[a]=1,g+=1)}var b=G.zeros(f),v=G.zeros(g);f=0,g=0;for(var a=0;a<d.length;a++)d[a]===0?(b[f]=e[a],f+=1):(v[g]=e[a],g+=1);return{indicesLeft:b,indicesRight:v,hyperplane:u,offset:h}}function Kr(n,e){var r=Jt(n),t=Zt(n),i=G.range(r).map(function(){return G.zeros(n.hyperplane?n.hyperplane.length:0)}),o=G.zeros(r),s=G.range(r).map(function(){return[-1,-1]}),l=G.range(t).map(function(){return G.range(e).map(function(){return-1})});return Ht(n,i,o,s,l,0,0),new ye(i,o,s,l)}function Ht(n,e,r,t,i,o,s){var l;if(n.isLeaf)return t[o][0]=-s,(l=i[s]).splice.apply(l,ve([0,n.indices.length],n.indices)),s+=1,{nodeNum:o,leafNum:s};e[o]=n.hyperplane,r[o]=n.offset,t[o][0]=o+1;var h=o,u=Ht(n.leftChild,e,r,t,i,o+1,s);return o=u.nodeNum,s=u.leafNum,t[h][1]=o+1,u=Ht(n.rightChild,e,r,t,i,o+1,s),{nodeNum:u.nodeNum,leafNum:u.leafNum}}function Jt(n){return n.isLeaf?1:1+Jt(n.leftChild)+Jt(n.rightChild)}function Zt(n){return n.isLeaf?1:Zt(n.leftChild)+Zt(n.rightChild)}function Qr(n){var e,r;if(n.length>0){var t=[];try{for(var i=Yr(n),o=i.next();!o.done;o=i.next()){var s=o.value;t.push.apply(t,ve(s.indices))}}catch(l){e={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return t}else return[[-1]]}ut.makeLeafArray=Qr;function Hr(n,e,r,t){for(var i=e,o=0;o<r.length;o++)i+=n[o]*r[o];if(i===0){var s=G.tauRandInt(2,t);return s}else return i>0?0:1}function Jr(n,e,r){for(var t=0;e.children[t][0]>0;){var i=Hr(e.hyperplanes[t],e.offsets[t],n,r);i===0?t=e.children[t][0]:t=e.children[t][1]}var o=-1*e.children[t][0];return e.indices[o]}ut.searchFlatTree=Jr;var be=z&&z.__values||function(n){var e=typeof Symbol=="function"&&n[Symbol.iterator],r=0;return e?e.call(n):{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}}},zt=z&&z.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var r in n)Object.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e.default=n,e};Object.defineProperty(gt,"__esModule",{value:!0});var W=zt(nt),Zr=zt(K),Ar=zt(ut),Me=zt(C);function tn(n,e){return function(t,i,o,s,l,h,u,a){s===void 0&&(s=10),l===void 0&&(l=50),h===void 0&&(h=.001),u===void 0&&(u=.5),a===void 0&&(a=!0);for(var f=t.length,g=W.makeHeap(t.length,o),d=0;d<t.length;d++)for(var m=W.rejectionSample(o,t.length,e),p=0;p<m.length;p++){var b=n(t[d],t[m[p]]);W.heapPush(g,d,b,m[p],1),W.heapPush(g,m[p],b,d,1)}if(a)for(var v=0;v<i.length;v++)for(var d=0;d<i[v].length&&!(i[v][d]<0);d++)for(var p=d+1;p<i[v].length&&!(i[v][p]<0);p++){var b=n(t[i[v][d]],t[i[v][p]]);W.heapPush(g,i[v][d],b,i[v][p],1),W.heapPush(g,i[v][p],b,i[v][d],1)}for(var v=0;v<s;v++){for(var N=W.buildCandidates(g,f,o,l,e),S=0,d=0;d<f;d++)for(var p=0;p<l;p++){var k=Math.floor(N[0][d][p]);if(!(k<0||Me.tauRand(e)<u))for(var E=0;E<l;E++){var L=Math.floor(N[0][d][E]),j=N[2][d][p],T=N[2][d][E];if(!(L<0||!j&&!T)){var b=n(t[k],t[L]);S+=W.heapPush(g,k,b,L,1),S+=W.heapPush(g,L,b,k,1)}}}if(S<=h*o*t.length)break}var U=W.deheapSort(g);return U}}gt.makeNNDescent=tn;function en(n){function e(t,i,o,s,l){for(var h=0;h<o.length;h++)for(var u=Me.rejectionSample(t,i.length,l),a=0;a<u.length;a++)if(!(u[a]<0)){var f=n(i[u[a]],o[h]);W.heapPush(s,h,f,u[a],1)}}function r(t,i,o,s,l){for(var h=0;h<o.length;h++)for(var u=Ar.searchFlatTree(o[h],t,l),a=0;a<u.length;a++){if(u[a]<0)return;var f=n(i[u[a]],o[h]);W.heapPush(s,h,f,u[a],1)}}return{initFromRandom:e,initFromTree:r}}gt.makeInitializations=en;function rn(n){return function(r,t,i,o){for(var s,l,h=Zr.getCSR(t),u=h.indices,a=h.indptr,f=0;f<o.length;f++)for(var g=new Set(i[0][f]);;){var d=W.smallestFlagged(i,f);if(d===-1)break;var m=u.slice(a[d],a[d+1]);try{for(var p=be(m),b=p.next();!b.done;b=p.next()){var v=b.value;if(!(v===d||v===-1||g.has(v))){var N=n(r[v],o[f]);W.uncheckedHeapPush(i,f,N,v,1),g.add(v)}}}catch(S){s={error:S}}finally{try{b&&!b.done&&(l=p.return)&&l.call(p)}finally{if(s)throw s.error}}}return i}}gt.makeInitializedNNSearch=rn;function nn(n,e,r,t,i,o,s){var l,h,u=W.makeHeap(r.length,t);if(i(t,e,r,u,s),n)try{for(var a=be(n),f=a.next();!f.done;f=a.next()){var g=f.value;o(g,e,r,u,s)}}catch(d){l={error:d}}finally{try{f&&!f.done&&(h=a.return)&&h.call(a)}finally{if(l)throw l.error}}return u}gt.initializeSearch=nn;const on=Object.prototype.toString;function At(n){return on.call(n).endsWith("Array]")}function Se(n,e,r){let t=0;const i=r(e);for(let o=0;o<n.x.length;o++)t+=Math.abs(n.y[o]-i(n.x[o]));return t}const sn=Object.prototype.toString;function H(n){const e=sn.call(n);return e.endsWith("Array]")&&!e.includes("Big")}function ln(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!H(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var r=e.fromIndex,t=r===void 0?0:r,i=e.toIndex,o=i===void 0?n.length:i;if(t<0||t>=n.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=t||o>n.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var s=n[t],l=t+1;l<o;l++)n[l]>s&&(s=n[l]);return s}function un(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!H(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var r=e.fromIndex,t=r===void 0?0:r,i=e.toIndex,o=i===void 0?n.length:i;if(t<0||t>=n.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(o<=t||o>n.length||!Number.isInteger(o))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var s=n[t],l=t+1;l<o;l++)n[l]<s&&(s=n[l]);return s}function xe(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(H(n)){if(n.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var r;if(e.output!==void 0){if(!H(e.output))throw new TypeError("output option must be an array if specified");r=e.output}else r=new Array(n.length);var t=un(n),i=ln(n);if(t===i)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var o=e.min,s=o===void 0?e.autoMinMax?t:0:o,l=e.max,h=l===void 0?e.autoMinMax?i:1:l;if(s>=h)throw new RangeError("min option must be smaller than max option");for(var u=(h-s)/(i-t),a=0;a<n.length;a++)r[a]=(n[a]-t)*u+s;return r}const It=" ".repeat(2),Ee=" ".repeat(4);function hn(){return Ne(this)}function Ne(n,e={}){const{maxRows:r=15,maxColumns:t=10,maxNumSize:i=8,padMinus:o="auto"}=e;return`${n.constructor.name} {
${It}[
${Ee}${an(n,r,t,i,o)}
${It}]
${It}rows: ${n.rows}
${It}columns: ${n.columns}
}`}function an(n,e,r,t,i){const{rows:o,columns:s}=n,l=Math.min(o,e),h=Math.min(s,r),u=[];if(i==="auto"){i=!1;t:for(let a=0;a<l;a++)for(let f=0;f<h;f++)if(n.get(a,f)<0){i=!0;break t}}for(let a=0;a<l;a++){let f=[];for(let g=0;g<h;g++)f.push(fn(n.get(a,g),t,i));u.push(`${f.join(" ")}`)}return h!==s&&(u[u.length-1]+=` ... ${s-r} more columns`),l!==o&&u.push(`... ${o-e} more rows`),u.join(`
${Ee}`)}function fn(n,e,r){return(n>=0&&r?` ${ke(n,e-1)}`:ke(n,e)).padEnd(e)}function ke(n,e){let r=n.toString();if(r.length<=e)return r;let t=n.toFixed(e);if(t.length>e&&(t=n.toFixed(Math.max(0,e-(t.length-e)))),t.length<=e&&!t.startsWith("0.000")&&!t.startsWith("-0.000"))return t;let i=n.toExponential(e);return i.length>e&&(i=n.toExponential(Math.max(0,e-(i.length-e)))),i.slice(0)}function cn(n,e){n.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},n.prototype.addS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)+t);return this},n.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)+t.get(i,o));return this},n.add=function(t,i){return new e(t).add(i)},n.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},n.prototype.subS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)-t);return this},n.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)-t.get(i,o));return this},n.sub=function(t,i){return new e(t).sub(i)},n.prototype.subtract=n.prototype.sub,n.prototype.subtractS=n.prototype.subS,n.prototype.subtractM=n.prototype.subM,n.subtract=n.sub,n.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},n.prototype.mulS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)*t);return this},n.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)*t.get(i,o));return this},n.mul=function(t,i){return new e(t).mul(i)},n.prototype.multiply=n.prototype.mul,n.prototype.multiplyS=n.prototype.mulS,n.prototype.multiplyM=n.prototype.mulM,n.multiply=n.mul,n.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},n.prototype.divS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)/t);return this},n.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)/t.get(i,o));return this},n.div=function(t,i){return new e(t).div(i)},n.prototype.divide=n.prototype.div,n.prototype.divideS=n.prototype.divS,n.prototype.divideM=n.prototype.divM,n.divide=n.div,n.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},n.prototype.modS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)%t);return this},n.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)%t.get(i,o));return this},n.mod=function(t,i){return new e(t).mod(i)},n.prototype.modulus=n.prototype.mod,n.prototype.modulusS=n.prototype.modS,n.prototype.modulusM=n.prototype.modM,n.modulus=n.mod,n.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},n.prototype.andS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)&t);return this},n.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)&t.get(i,o));return this},n.and=function(t,i){return new e(t).and(i)},n.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},n.prototype.orS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)|t);return this},n.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)|t.get(i,o));return this},n.or=function(t,i){return new e(t).or(i)},n.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},n.prototype.xorS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)^t);return this},n.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)^t.get(i,o));return this},n.xor=function(t,i){return new e(t).xor(i)},n.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},n.prototype.leftShiftS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)<<t);return this},n.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)<<t.get(i,o));return this},n.leftShift=function(t,i){return new e(t).leftShift(i)},n.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},n.prototype.signPropagatingRightShiftS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)>>t);return this},n.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)>>t.get(i,o));return this},n.signPropagatingRightShift=function(t,i){return new e(t).signPropagatingRightShift(i)},n.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},n.prototype.rightShiftS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)>>>t);return this},n.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,this.get(i,o)>>>t.get(i,o));return this},n.rightShift=function(t,i){return new e(t).rightShift(i)},n.prototype.zeroFillRightShift=n.prototype.rightShift,n.prototype.zeroFillRightShiftS=n.prototype.rightShiftS,n.prototype.zeroFillRightShiftM=n.prototype.rightShiftM,n.zeroFillRightShift=n.rightShift,n.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,~this.get(t,i));return this},n.not=function(t){return new e(t).not()},n.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.abs(this.get(t,i)));return this},n.abs=function(t){return new e(t).abs()},n.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.acos(this.get(t,i)));return this},n.acos=function(t){return new e(t).acos()},n.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.acosh(this.get(t,i)));return this},n.acosh=function(t){return new e(t).acosh()},n.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.asin(this.get(t,i)));return this},n.asin=function(t){return new e(t).asin()},n.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.asinh(this.get(t,i)));return this},n.asinh=function(t){return new e(t).asinh()},n.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.atan(this.get(t,i)));return this},n.atan=function(t){return new e(t).atan()},n.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.atanh(this.get(t,i)));return this},n.atanh=function(t){return new e(t).atanh()},n.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.cbrt(this.get(t,i)));return this},n.cbrt=function(t){return new e(t).cbrt()},n.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.ceil(this.get(t,i)));return this},n.ceil=function(t){return new e(t).ceil()},n.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.clz32(this.get(t,i)));return this},n.clz32=function(t){return new e(t).clz32()},n.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.cos(this.get(t,i)));return this},n.cos=function(t){return new e(t).cos()},n.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.cosh(this.get(t,i)));return this},n.cosh=function(t){return new e(t).cosh()},n.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.exp(this.get(t,i)));return this},n.exp=function(t){return new e(t).exp()},n.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.expm1(this.get(t,i)));return this},n.expm1=function(t){return new e(t).expm1()},n.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.floor(this.get(t,i)));return this},n.floor=function(t){return new e(t).floor()},n.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.fround(this.get(t,i)));return this},n.fround=function(t){return new e(t).fround()},n.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.log(this.get(t,i)));return this},n.log=function(t){return new e(t).log()},n.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.log1p(this.get(t,i)));return this},n.log1p=function(t){return new e(t).log1p()},n.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.log10(this.get(t,i)));return this},n.log10=function(t){return new e(t).log10()},n.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.log2(this.get(t,i)));return this},n.log2=function(t){return new e(t).log2()},n.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.round(this.get(t,i)));return this},n.round=function(t){return new e(t).round()},n.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.sign(this.get(t,i)));return this},n.sign=function(t){return new e(t).sign()},n.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.sin(this.get(t,i)));return this},n.sin=function(t){return new e(t).sin()},n.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.sinh(this.get(t,i)));return this},n.sinh=function(t){return new e(t).sinh()},n.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.sqrt(this.get(t,i)));return this},n.sqrt=function(t){return new e(t).sqrt()},n.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.tan(this.get(t,i)));return this},n.tan=function(t){return new e(t).tan()},n.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.tanh(this.get(t,i)));return this},n.tanh=function(t){return new e(t).tanh()},n.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.set(t,i,Math.trunc(this.get(t,i)));return this},n.trunc=function(t){return new e(t).trunc()},n.pow=function(t,i){return new e(t).pow(i)},n.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},n.prototype.powS=function(t){for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,Math.pow(this.get(i,o),t));return this},n.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let i=0;i<this.rows;i++)for(let o=0;o<this.columns;o++)this.set(i,o,Math.pow(this.get(i,o),t.get(i,o)));return this}}function A(n,e,r){let t=r?n.rows:n.rows-1;if(e<0||e>t)throw new RangeError("Row index out of range")}function tt(n,e,r){let t=r?n.columns:n.columns-1;if(e<0||e>t)throw new RangeError("Column index out of range")}function mt(n,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==n.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function pt(n,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==n.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function gn(n,e){if(!H(e))throw new TypeError("row indices must be an array");for(let r=0;r<e.length;r++)if(e[r]<0||e[r]>=n.rows)throw new RangeError("row indices are out of range")}function mn(n,e){if(!H(e))throw new TypeError("column indices must be an array");for(let r=0;r<e.length;r++)if(e[r]<0||e[r]>=n.columns)throw new RangeError("column indices are out of range")}function je(n,e,r,t,i){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(Ft("startRow",e),Ft("endRow",r),Ft("startColumn",t),Ft("endColumn",i),e>r||t>i||e<0||e>=n.rows||r<0||r>=n.rows||t<0||t>=n.columns||i<0||i>=n.columns)throw new RangeError("Submatrix indices are out of range")}function Pt(n,e=0){let r=[];for(let t=0;t<n;t++)r.push(e);return r}function Ft(n,e){if(typeof e!="number")throw new TypeError(`${n} must be a number`)}function wt(n){if(n.isEmpty())throw new Error("Empty matrix has no elements to index")}function pn(n){let e=Pt(n.rows);for(let r=0;r<n.rows;++r)for(let t=0;t<n.columns;++t)e[r]+=n.get(r,t);return e}function wn(n){let e=Pt(n.columns);for(let r=0;r<n.rows;++r)for(let t=0;t<n.columns;++t)e[t]+=n.get(r,t);return e}function dn(n){let e=0;for(let r=0;r<n.rows;r++)for(let t=0;t<n.columns;t++)e+=n.get(r,t);return e}function vn(n){let e=Pt(n.rows,1);for(let r=0;r<n.rows;++r)for(let t=0;t<n.columns;++t)e[r]*=n.get(r,t);return e}function yn(n){let e=Pt(n.columns,1);for(let r=0;r<n.rows;++r)for(let t=0;t<n.columns;++t)e[t]*=n.get(r,t);return e}function bn(n){let e=1;for(let r=0;r<n.rows;r++)for(let t=0;t<n.columns;t++)e*=n.get(r,t);return e}function Mn(n,e,r){const t=n.rows,i=n.columns,o=[];for(let s=0;s<t;s++){let l=0,h=0,u=0;for(let a=0;a<i;a++)u=n.get(s,a)-r[s],l+=u,h+=u*u;e?o.push((h-l*l/i)/(i-1)):o.push((h-l*l/i)/i)}return o}function Sn(n,e,r){const t=n.rows,i=n.columns,o=[];for(let s=0;s<i;s++){let l=0,h=0,u=0;for(let a=0;a<t;a++)u=n.get(a,s)-r[s],l+=u,h+=u*u;e?o.push((h-l*l/t)/(t-1)):o.push((h-l*l/t)/t)}return o}function xn(n,e,r){const t=n.rows,i=n.columns,o=t*i;let s=0,l=0,h=0;for(let u=0;u<t;u++)for(let a=0;a<i;a++)h=n.get(u,a)-r,s+=h,l+=h*h;return e?(l-s*s/o)/(o-1):(l-s*s/o)/o}function En(n,e){for(let r=0;r<n.rows;r++)for(let t=0;t<n.columns;t++)n.set(r,t,n.get(r,t)-e[r])}function Nn(n,e){for(let r=0;r<n.rows;r++)for(let t=0;t<n.columns;t++)n.set(r,t,n.get(r,t)-e[t])}function kn(n,e){for(let r=0;r<n.rows;r++)for(let t=0;t<n.columns;t++)n.set(r,t,n.get(r,t)-e)}function jn(n){const e=[];for(let r=0;r<n.rows;r++){let t=0;for(let i=0;i<n.columns;i++)t+=Math.pow(n.get(r,i),2)/(n.columns-1);e.push(Math.sqrt(t))}return e}function Rn(n,e){for(let r=0;r<n.rows;r++)for(let t=0;t<n.columns;t++)n.set(r,t,n.get(r,t)/e[r])}function $n(n){const e=[];for(let r=0;r<n.columns;r++){let t=0;for(let i=0;i<n.rows;i++)t+=Math.pow(n.get(i,r),2)/(n.rows-1);e.push(Math.sqrt(t))}return e}function _n(n,e){for(let r=0;r<n.rows;r++)for(let t=0;t<n.columns;t++)n.set(r,t,n.get(r,t)/e[t])}function zn(n){const e=n.size-1;let r=0;for(let t=0;t<n.columns;t++)for(let i=0;i<n.rows;i++)r+=Math.pow(n.get(i,t),2)/e;return Math.sqrt(r)}function In(n,e){for(let r=0;r<n.rows;r++)for(let t=0;t<n.columns;t++)n.set(r,t,n.get(r,t)/e)}class R{static from1DArray(e,r,t){if(e*r!==t.length)throw new RangeError("data length does not match given dimensions");let o=new x(e,r);for(let s=0;s<e;s++)for(let l=0;l<r;l++)o.set(s,l,t[s*r+l]);return o}static rowVector(e){let r=new x(1,e.length);for(let t=0;t<e.length;t++)r.set(0,t,e[t]);return r}static columnVector(e){let r=new x(e.length,1);for(let t=0;t<e.length;t++)r.set(t,0,e[t]);return r}static zeros(e,r){return new x(e,r)}static ones(e,r){return new x(e,r).fill(1)}static rand(e,r,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{random:i=Math.random}=t;let o=new x(e,r);for(let s=0;s<e;s++)for(let l=0;l<r;l++)o.set(s,l,i());return o}static randInt(e,r,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:i=0,max:o=1e3,random:s=Math.random}=t;if(!Number.isInteger(i))throw new TypeError("min must be an integer");if(!Number.isInteger(o))throw new TypeError("max must be an integer");if(i>=o)throw new RangeError("min must be smaller than max");let l=o-i,h=new x(e,r);for(let u=0;u<e;u++)for(let a=0;a<r;a++){let f=i+Math.round(s()*l);h.set(u,a,f)}return h}static eye(e,r,t){r===void 0&&(r=e),t===void 0&&(t=1);let i=Math.min(e,r),o=this.zeros(e,r);for(let s=0;s<i;s++)o.set(s,s,t);return o}static diag(e,r,t){let i=e.length;r===void 0&&(r=i),t===void 0&&(t=r);let o=Math.min(i,r,t),s=this.zeros(r,t);for(let l=0;l<o;l++)s.set(l,l,e[l]);return s}static min(e,r){e=this.checkMatrix(e),r=this.checkMatrix(r);let t=e.rows,i=e.columns,o=new x(t,i);for(let s=0;s<t;s++)for(let l=0;l<i;l++)o.set(s,l,Math.min(e.get(s,l),r.get(s,l)));return o}static max(e,r){e=this.checkMatrix(e),r=this.checkMatrix(r);let t=e.rows,i=e.columns,o=new this(t,i);for(let s=0;s<t;s++)for(let l=0;l<i;l++)o.set(s,l,Math.max(e.get(s,l),r.get(s,l)));return o}static checkMatrix(e){return R.isMatrix(e)?e:new x(e)}static isMatrix(e){return e!=null&&e.klass==="Matrix"}get size(){return this.rows*this.columns}apply(e){if(typeof e!="function")throw new TypeError("callback must be a function");for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.call(this,r,t);return this}to1DArray(){let e=[];for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.push(this.get(r,t));return e}to2DArray(){let e=[];for(let r=0;r<this.rows;r++){e.push([]);for(let t=0;t<this.columns;t++)e[r].push(this.get(r,t))}return e}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let r=0;r<=e;r++)if(this.get(e,r)!==this.get(r,e))return!1;return!0}return!1}isEchelonForm(){let e=0,r=0,t=-1,i=!0,o=!1;for(;e<this.rows&&i;){for(r=0,o=!1;r<this.columns&&o===!1;)this.get(e,r)===0?r++:this.get(e,r)===1&&r>t?(o=!0,t=r):(i=!1,o=!0);e++}return i}isReducedEchelonForm(){let e=0,r=0,t=-1,i=!0,o=!1;for(;e<this.rows&&i;){for(r=0,o=!1;r<this.columns&&o===!1;)this.get(e,r)===0?r++:this.get(e,r)===1&&r>t?(o=!0,t=r):(i=!1,o=!0);for(let s=r+1;s<this.rows;s++)this.get(e,s)!==0&&(i=!1);e++}return i}echelonForm(){let e=this.clone(),r=0,t=0;for(;r<e.rows&&t<e.columns;){let i=r;for(let o=r;o<e.rows;o++)e.get(o,t)>e.get(i,t)&&(i=o);if(e.get(i,t)===0)t++;else{e.swapRows(r,i);let o=e.get(r,t);for(let s=t;s<e.columns;s++)e.set(r,s,e.get(r,s)/o);for(let s=r+1;s<e.rows;s++){let l=e.get(s,t)/e.get(r,t);e.set(s,t,0);for(let h=t+1;h<e.columns;h++)e.set(s,h,e.get(s,h)-e.get(r,h)*l)}r++,t++}}return e}reducedEchelonForm(){let e=this.echelonForm(),r=e.columns,t=e.rows,i=t-1;for(;i>=0;)if(e.maxRow(i)===0)i--;else{let o=0,s=!1;for(;o<t&&s===!1;)e.get(i,o)===1?s=!0:o++;for(let l=0;l<i;l++){let h=e.get(l,o);for(let u=o;u<r;u++){let a=e.get(l,u)-h*e.get(i,u);e.set(l,u,a)}}i--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{rows:r=1,columns:t=1}=e;if(!Number.isInteger(r)||r<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let i=new x(this.rows*r,this.columns*t);for(let o=0;o<r;o++)for(let s=0;s<t;s++)i.setSubMatrix(this,this.rows*o,this.columns*s);return i}fill(e){for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,e);return this}neg(){return this.mulS(-1)}getRow(e){A(this,e);let r=[];for(let t=0;t<this.columns;t++)r.push(this.get(e,t));return r}getRowVector(e){return x.rowVector(this.getRow(e))}setRow(e,r){A(this,e),r=mt(this,r);for(let t=0;t<this.columns;t++)this.set(e,t,r[t]);return this}swapRows(e,r){A(this,e),A(this,r);for(let t=0;t<this.columns;t++){let i=this.get(e,t);this.set(e,t,this.get(r,t)),this.set(r,t,i)}return this}getColumn(e){tt(this,e);let r=[];for(let t=0;t<this.rows;t++)r.push(this.get(t,e));return r}getColumnVector(e){return x.columnVector(this.getColumn(e))}setColumn(e,r){tt(this,e),r=pt(this,r);for(let t=0;t<this.rows;t++)this.set(t,e,r[t]);return this}swapColumns(e,r){tt(this,e),tt(this,r);for(let t=0;t<this.rows;t++){let i=this.get(t,e);this.set(t,e,this.get(t,r)),this.set(t,r,i)}return this}addRowVector(e){e=mt(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)+e[t]);return this}subRowVector(e){e=mt(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)-e[t]);return this}mulRowVector(e){e=mt(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e[t]);return this}divRowVector(e){e=mt(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)/e[t]);return this}addColumnVector(e){e=pt(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)+e[r]);return this}subColumnVector(e){e=pt(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)-e[r]);return this}mulColumnVector(e){e=pt(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e[r]);return this}divColumnVector(e){e=pt(this,e);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)/e[r]);return this}mulRow(e,r){A(this,e);for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r);return this}mulColumn(e,r){tt(this,e);for(let t=0;t<this.rows;t++)this.set(t,e,this.get(t,e)*r);return this}max(e){if(this.isEmpty())return NaN;switch(e){case"row":{const r=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)>r[t]&&(r[t]=this.get(t,i));return r}case"column":{const r=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)>r[i]&&(r[i]=this.get(t,i));return r}case void 0:{let r=this.get(0,0);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)>r&&(r=this.get(t,i));return r}default:throw new Error(`invalid option: ${e}`)}}maxIndex(){wt(this);let e=this.get(0,0),r=[0,0];for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)>e&&(e=this.get(t,i),r[0]=t,r[1]=i);return r}min(e){if(this.isEmpty())return NaN;switch(e){case"row":{const r=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)<r[t]&&(r[t]=this.get(t,i));return r}case"column":{const r=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)<r[i]&&(r[i]=this.get(t,i));return r}case void 0:{let r=this.get(0,0);for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)<r&&(r=this.get(t,i));return r}default:throw new Error(`invalid option: ${e}`)}}minIndex(){wt(this);let e=this.get(0,0),r=[0,0];for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.get(t,i)<e&&(e=this.get(t,i),r[0]=t,r[1]=i);return r}maxRow(e){if(A(this,e),this.isEmpty())return NaN;let r=this.get(e,0);for(let t=1;t<this.columns;t++)this.get(e,t)>r&&(r=this.get(e,t));return r}maxRowIndex(e){A(this,e),wt(this);let r=this.get(e,0),t=[e,0];for(let i=1;i<this.columns;i++)this.get(e,i)>r&&(r=this.get(e,i),t[1]=i);return t}minRow(e){if(A(this,e),this.isEmpty())return NaN;let r=this.get(e,0);for(let t=1;t<this.columns;t++)this.get(e,t)<r&&(r=this.get(e,t));return r}minRowIndex(e){A(this,e),wt(this);let r=this.get(e,0),t=[e,0];for(let i=1;i<this.columns;i++)this.get(e,i)<r&&(r=this.get(e,i),t[1]=i);return t}maxColumn(e){if(tt(this,e),this.isEmpty())return NaN;let r=this.get(0,e);for(let t=1;t<this.rows;t++)this.get(t,e)>r&&(r=this.get(t,e));return r}maxColumnIndex(e){tt(this,e),wt(this);let r=this.get(0,e),t=[0,e];for(let i=1;i<this.rows;i++)this.get(i,e)>r&&(r=this.get(i,e),t[0]=i);return t}minColumn(e){if(tt(this,e),this.isEmpty())return NaN;let r=this.get(0,e);for(let t=1;t<this.rows;t++)this.get(t,e)<r&&(r=this.get(t,e));return r}minColumnIndex(e){tt(this,e),wt(this);let r=this.get(0,e),t=[0,e];for(let i=1;i<this.rows;i++)this.get(i,e)<r&&(r=this.get(i,e),t[0]=i);return t}diag(){let e=Math.min(this.rows,this.columns),r=[];for(let t=0;t<e;t++)r.push(this.get(t,t));return r}norm(e="frobenius"){let r=0;if(e==="max")return this.max();if(e==="frobenius"){for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)r=r+this.get(t,i)*this.get(t,i);return Math.sqrt(r)}else throw new RangeError(`unknown norm type: ${e}`)}cumulativeSum(){let e=0;for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e+=this.get(r,t),this.set(r,t,e);return this}dot(e){R.isMatrix(e)&&(e=e.to1DArray());let r=this.to1DArray();if(r.length!==e.length)throw new RangeError("vectors do not have the same size");let t=0;for(let i=0;i<r.length;i++)t+=r[i]*e[i];return t}mmul(e){e=x.checkMatrix(e);let r=this.rows,t=this.columns,i=e.columns,o=new x(r,i),s=new Float64Array(t);for(let l=0;l<i;l++){for(let h=0;h<t;h++)s[h]=e.get(h,l);for(let h=0;h<r;h++){let u=0;for(let a=0;a<t;a++)u+=this.get(h,a)*s[a];o.set(h,l,u)}}return o}strassen2x2(e){e=x.checkMatrix(e);let r=new x(2,2);const t=this.get(0,0),i=e.get(0,0),o=this.get(0,1),s=e.get(0,1),l=this.get(1,0),h=e.get(1,0),u=this.get(1,1),a=e.get(1,1),f=(t+u)*(i+a),g=(l+u)*i,d=t*(s-a),m=u*(h-i),p=(t+o)*a,b=(l-t)*(i+s),v=(o-u)*(h+a),N=f+m-p+v,S=d+p,k=g+m,E=f-g+d+b;return r.set(0,0,N),r.set(0,1,S),r.set(1,0,k),r.set(1,1,E),r}strassen3x3(e){e=x.checkMatrix(e);let r=new x(3,3);const t=this.get(0,0),i=this.get(0,1),o=this.get(0,2),s=this.get(1,0),l=this.get(1,1),h=this.get(1,2),u=this.get(2,0),a=this.get(2,1),f=this.get(2,2),g=e.get(0,0),d=e.get(0,1),m=e.get(0,2),p=e.get(1,0),b=e.get(1,1),v=e.get(1,2),N=e.get(2,0),S=e.get(2,1),k=e.get(2,2),E=(t+i+o-s-l-a-f)*b,L=(t-s)*(-d+b),j=l*(-g+d+p-b-v-N+k),T=(-t+s+l)*(g-d+b),U=(s+l)*(-g+d),c=t*g,w=(-t+u+a)*(g-m+v),M=(-t+u)*(m-v),y=(u+a)*(-g+m),F=(t+i+o-l-h-u-a)*v,I=a*(-g+m+p-b-v-N+S),$=(-o+a+f)*(b+N-S),P=(o-f)*(b-S),V=o*N,O=(a+f)*(-N+S),B=(-o+l+h)*(v+N-k),ot=(o-h)*(v-k),lt=(l+h)*(-N+k),_=i*p,X=h*S,J=s*m,Z=u*d,Y=f*k,io=c+V+_,oo=E+T+U+c+$+V+O,so=c+w+y+F+V+B+lt,lo=L+j+T+c+V+B+ot,uo=L+T+U+c+X,ho=V+B+ot+lt+J,ao=c+w+M+I+$+P+V,fo=$+P+V+O+Z,co=c+w+M+y+Y;return r.set(0,0,io),r.set(0,1,oo),r.set(0,2,so),r.set(1,0,lo),r.set(1,1,uo),r.set(1,2,ho),r.set(2,0,ao),r.set(2,1,fo),r.set(2,2,co),r}mmulStrassen(e){e=x.checkMatrix(e);let r=this.clone(),t=r.rows,i=r.columns,o=e.rows,s=e.columns;i!==o&&console.warn(`Multiplying ${t} x ${i} and ${o} x ${s} matrix: dimensions do not match.`);function l(f,g,d){let m=f.rows,p=f.columns;if(m===g&&p===d)return f;{let b=R.zeros(g,d);return b=b.setSubMatrix(f,0,0),b}}let h=Math.max(t,o),u=Math.max(i,s);r=l(r,h,u),e=l(e,h,u);function a(f,g,d,m){if(d<=512||m<=512)return f.mmul(g);d%2===1&&m%2===1?(f=l(f,d+1,m+1),g=l(g,d+1,m+1)):d%2===1?(f=l(f,d+1,m),g=l(g,d+1,m)):m%2===1&&(f=l(f,d,m+1),g=l(g,d,m+1));let p=parseInt(f.rows/2,10),b=parseInt(f.columns/2,10),v=f.subMatrix(0,p-1,0,b-1),N=g.subMatrix(0,p-1,0,b-1),S=f.subMatrix(0,p-1,b,f.columns-1),k=g.subMatrix(0,p-1,b,g.columns-1),E=f.subMatrix(p,f.rows-1,0,b-1),L=g.subMatrix(p,g.rows-1,0,b-1),j=f.subMatrix(p,f.rows-1,b,f.columns-1),T=g.subMatrix(p,g.rows-1,b,g.columns-1),U=a(R.add(v,j),R.add(N,T),p,b),c=a(R.add(E,j),N,p,b),w=a(v,R.sub(k,T),p,b),M=a(j,R.sub(L,N),p,b),y=a(R.add(v,S),T,p,b),F=a(R.sub(E,v),R.add(N,k),p,b),I=a(R.sub(S,j),R.add(L,T),p,b),$=R.add(U,M);$.sub(y),$.add(I);let P=R.add(w,y),V=R.add(c,M),O=R.sub(U,c);O.add(w),O.add(F);let B=R.zeros(2*$.rows,2*$.columns);return B=B.setSubMatrix($,0,0),B=B.setSubMatrix(P,$.rows,0),B=B.setSubMatrix(V,0,$.columns),B=B.setSubMatrix(O,$.rows,$.columns),B.subMatrix(0,d-1,0,m-1)}return a(r,e,h,u)}scaleRows(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:r=0,max:t=1}=e;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(r>=t)throw new RangeError("min must be smaller than max");let i=new x(this.rows,this.columns);for(let o=0;o<this.rows;o++){const s=this.getRow(o);s.length>0&&xe(s,{min:r,max:t,output:s}),i.setRow(o,s)}return i}scaleColumns(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:r=0,max:t=1}=e;if(!Number.isFinite(r))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(r>=t)throw new RangeError("min must be smaller than max");let i=new x(this.rows,this.columns);for(let o=0;o<this.columns;o++){const s=this.getColumn(o);s.length&&xe(s,{min:r,max:t,output:s}),i.setColumn(o,s)}return i}flipRows(){const e=Math.ceil(this.columns/2);for(let r=0;r<this.rows;r++)for(let t=0;t<e;t++){let i=this.get(r,t),o=this.get(r,this.columns-1-t);this.set(r,t,o),this.set(r,this.columns-1-t,i)}return this}flipColumns(){const e=Math.ceil(this.rows/2);for(let r=0;r<this.columns;r++)for(let t=0;t<e;t++){let i=this.get(t,r),o=this.get(this.rows-1-t,r);this.set(t,r,o),this.set(this.rows-1-t,r,i)}return this}kroneckerProduct(e){e=x.checkMatrix(e);let r=this.rows,t=this.columns,i=e.rows,o=e.columns,s=new x(r*i,t*o);for(let l=0;l<r;l++)for(let h=0;h<t;h++)for(let u=0;u<i;u++)for(let a=0;a<o;a++)s.set(i*l+u,o*h+a,this.get(l,h)*e.get(u,a));return s}kroneckerSum(e){if(e=x.checkMatrix(e),!this.isSquare()||!e.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let r=this.rows,t=e.rows,i=this.kroneckerProduct(x.eye(t,t)),o=x.eye(r,r).kroneckerProduct(e);return i.add(o)}transpose(){let e=new x(this.columns,this.rows);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.set(t,r,this.get(r,t));return e}sortRows(e=Re){for(let r=0;r<this.rows;r++)this.setRow(r,this.getRow(r).sort(e));return this}sortColumns(e=Re){for(let r=0;r<this.columns;r++)this.setColumn(r,this.getColumn(r).sort(e));return this}subMatrix(e,r,t,i){je(this,e,r,t,i);let o=new x(r-e+1,i-t+1);for(let s=e;s<=r;s++)for(let l=t;l<=i;l++)o.set(s-e,l-t,this.get(s,l));return o}subMatrixRow(e,r,t){if(r===void 0&&(r=0),t===void 0&&(t=this.columns-1),r>t||r<0||r>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let i=new x(e.length,t-r+1);for(let o=0;o<e.length;o++)for(let s=r;s<=t;s++){if(e[o]<0||e[o]>=this.rows)throw new RangeError(`Row index out of range: ${e[o]}`);i.set(o,s-r,this.get(e[o],s))}return i}subMatrixColumn(e,r,t){if(r===void 0&&(r=0),t===void 0&&(t=this.rows-1),r>t||r<0||r>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let i=new x(t-r+1,e.length);for(let o=0;o<e.length;o++)for(let s=r;s<=t;s++){if(e[o]<0||e[o]>=this.columns)throw new RangeError(`Column index out of range: ${e[o]}`);i.set(s-r,o,this.get(s,e[o]))}return i}setSubMatrix(e,r,t){if(e=x.checkMatrix(e),e.isEmpty())return this;let i=r+e.rows-1,o=t+e.columns-1;je(this,r,i,t,o);for(let s=0;s<e.rows;s++)for(let l=0;l<e.columns;l++)this.set(r+s,t+l,e.get(s,l));return this}selection(e,r){gn(this,e),mn(this,r);let t=new x(e.length,r.length);for(let i=0;i<e.length;i++){let o=e[i];for(let s=0;s<r.length;s++){let l=r[s];t.set(i,s,this.get(o,l))}}return t}trace(){let e=Math.min(this.rows,this.columns),r=0;for(let t=0;t<e;t++)r+=this.get(t,t);return r}clone(){let e=new x(this.rows,this.columns);for(let r=0;r<this.rows;r++)for(let t=0;t<this.columns;t++)e.set(r,t,this.get(r,t));return e}sum(e){switch(e){case"row":return pn(this);case"column":return wn(this);case void 0:return dn(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return vn(this);case"column":return yn(this);case void 0:return bn(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){const r=this.sum(e);switch(e){case"row":{for(let t=0;t<this.rows;t++)r[t]/=this.columns;return r}case"column":{for(let t=0;t<this.columns;t++)r[t]/=this.rows;return r}case void 0:return r/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");const{unbiased:t=!0,mean:i=this.mean(e)}=r;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(e){case"row":{if(!H(i))throw new TypeError("mean must be an array");return Mn(this,t,i)}case"column":{if(!H(i))throw new TypeError("mean must be an array");return Sn(this,t,i)}case void 0:{if(typeof i!="number")throw new TypeError("mean must be a number");return xn(this,t,i)}default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,r){typeof e=="object"&&(r=e,e=void 0);const t=this.variance(e,r);if(e===void 0)return Math.sqrt(t);for(let i=0;i<t.length;i++)t[i]=Math.sqrt(t[i]);return t}center(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");const{center:t=this.mean(e)}=r;switch(e){case"row":{if(!H(t))throw new TypeError("center must be an array");return En(this,t),this}case"column":{if(!H(t))throw new TypeError("center must be an array");return Nn(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return kn(this,t),this}default:throw new Error(`invalid option: ${e}`)}}scale(e,r={}){if(typeof e=="object"&&(r=e,e=void 0),typeof r!="object")throw new TypeError("options must be an object");let t=r.scale;switch(e){case"row":{if(t===void 0)t=jn(this);else if(!H(t))throw new TypeError("scale must be an array");return Rn(this,t),this}case"column":{if(t===void 0)t=$n(this);else if(!H(t))throw new TypeError("scale must be an array");return _n(this,t),this}case void 0:{if(t===void 0)t=zn(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return In(this,t),this}default:throw new Error(`invalid option: ${e}`)}}toString(e){return Ne(this,e)}}R.prototype.klass="Matrix",typeof Symbol<"u"&&(R.prototype[Symbol.for("nodejs.util.inspect.custom")]=hn);function Re(n,e){return n-e}function Pn(n){return n.every(e=>typeof e=="number")}R.random=R.rand,R.randomInt=R.randInt,R.diagonal=R.diag,R.prototype.diagonal=R.prototype.diag,R.identity=R.eye,R.prototype.negate=R.prototype.neg,R.prototype.tensorProduct=R.prototype.kroneckerProduct;class x extends R{constructor(e,r){if(super(),x.isMatrix(e))return e.clone();if(Number.isInteger(e)&&e>=0)if(this.data=[],Number.isInteger(r)&&r>=0)for(let t=0;t<e;t++)this.data.push(new Float64Array(r));else throw new TypeError("nColumns must be a positive integer");else if(H(e)){const t=e;if(e=t.length,r=e?t[0].length:0,typeof r!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let i=0;i<e;i++){if(t[i].length!==r)throw new RangeError("Inconsistent array dimensions");if(!Pn(t[i]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(t[i]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=e,this.columns=r}set(e,r,t){return this.data[e][r]=t,this}get(e,r){return this.data[e][r]}removeRow(e){return A(this,e),this.data.splice(e,1),this.rows-=1,this}addRow(e,r){return r===void 0&&(r=e,e=this.rows),A(this,e,!0),r=Float64Array.from(mt(this,r)),this.data.splice(e,0,r),this.rows+=1,this}removeColumn(e){tt(this,e);for(let r=0;r<this.rows;r++){const t=new Float64Array(this.columns-1);for(let i=0;i<e;i++)t[i]=this.data[r][i];for(let i=e+1;i<this.columns;i++)t[i-1]=this.data[r][i];this.data[r]=t}return this.columns-=1,this}addColumn(e,r){typeof r>"u"&&(r=e,e=this.columns),tt(this,e,!0),r=pt(this,r);for(let t=0;t<this.rows;t++){const i=new Float64Array(this.columns+1);let o=0;for(;o<e;o++)i[o]=this.data[t][o];for(i[o++]=r[t];o<this.columns+1;o++)i[o]=this.data[t][o-1];this.data[t]=i}return this.columns+=1,this}}cn(R,x);class dt extends R{constructor(e){super(),this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,r,t){return this.data[e][r]=t,this}get(e,r){return this.data[e][r]}}class Fn{constructor(e){e=dt.checkMatrix(e);let r=e.clone(),t=r.rows,i=r.columns,o=new Float64Array(t),s=1,l,h,u,a,f,g,d,m,p;for(l=0;l<t;l++)o[l]=l;for(m=new Float64Array(t),h=0;h<i;h++){for(l=0;l<t;l++)m[l]=r.get(l,h);for(l=0;l<t;l++){for(p=Math.min(l,h),f=0,u=0;u<p;u++)f+=r.get(l,u)*m[u];m[l]-=f,r.set(l,h,m[l])}for(a=h,l=h+1;l<t;l++)Math.abs(m[l])>Math.abs(m[a])&&(a=l);if(a!==h){for(u=0;u<i;u++)g=r.get(a,u),r.set(a,u,r.get(h,u)),r.set(h,u,g);d=o[a],o[a]=o[h],o[h]=d,s=-s}if(h<t&&r.get(h,h)!==0)for(l=h+1;l<t;l++)r.set(l,h,r.get(l,h)/r.get(h,h))}this.LU=r,this.pivotVector=o,this.pivotSign=s}isSingular(){let e=this.LU,r=e.columns;for(let t=0;t<r;t++)if(e.get(t,t)===0)return!0;return!1}solve(e){e=x.checkMatrix(e);let r=this.LU;if(r.rows!==e.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let i=e.columns,o=e.subMatrixRow(this.pivotVector,0,i-1),s=r.columns,l,h,u;for(u=0;u<s;u++)for(l=u+1;l<s;l++)for(h=0;h<i;h++)o.set(l,h,o.get(l,h)-o.get(u,h)*r.get(l,u));for(u=s-1;u>=0;u--){for(h=0;h<i;h++)o.set(u,h,o.get(u,h)/r.get(u,u));for(l=0;l<u;l++)for(h=0;h<i;h++)o.set(l,h,o.get(l,h)-o.get(u,h)*r.get(l,u))}return o}get determinant(){let e=this.LU;if(!e.isSquare())throw new Error("Matrix must be square");let r=this.pivotSign,t=e.columns;for(let i=0;i<t;i++)r*=e.get(i,i);return r}get lowerTriangularMatrix(){let e=this.LU,r=e.rows,t=e.columns,i=new x(r,t);for(let o=0;o<r;o++)for(let s=0;s<t;s++)o>s?i.set(o,s,e.get(o,s)):o===s?i.set(o,s,1):i.set(o,s,0);return i}get upperTriangularMatrix(){let e=this.LU,r=e.rows,t=e.columns,i=new x(r,t);for(let o=0;o<r;o++)for(let s=0;s<t;s++)o<=s?i.set(o,s,e.get(o,s)):i.set(o,s,0);return i}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function ht(n,e){let r=0;return Math.abs(n)>Math.abs(e)?(r=e/n,Math.abs(n)*Math.sqrt(1+r*r)):e!==0?(r=n/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class Tn{constructor(e){e=dt.checkMatrix(e);let r=e.clone(),t=e.rows,i=e.columns,o=new Float64Array(i),s,l,h,u;for(h=0;h<i;h++){let a=0;for(s=h;s<t;s++)a=ht(a,r.get(s,h));if(a!==0){for(r.get(h,h)<0&&(a=-a),s=h;s<t;s++)r.set(s,h,r.get(s,h)/a);for(r.set(h,h,r.get(h,h)+1),l=h+1;l<i;l++){for(u=0,s=h;s<t;s++)u+=r.get(s,h)*r.get(s,l);for(u=-u/r.get(h,h),s=h;s<t;s++)r.set(s,l,r.get(s,l)+u*r.get(s,h))}}o[h]=-a}this.QR=r,this.Rdiag=o}solve(e){e=x.checkMatrix(e);let r=this.QR,t=r.rows;if(e.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let i=e.columns,o=e.clone(),s=r.columns,l,h,u,a;for(u=0;u<s;u++)for(h=0;h<i;h++){for(a=0,l=u;l<t;l++)a+=r.get(l,u)*o.get(l,h);for(a=-a/r.get(u,u),l=u;l<t;l++)o.set(l,h,o.get(l,h)+a*r.get(l,u))}for(u=s-1;u>=0;u--){for(h=0;h<i;h++)o.set(u,h,o.get(u,h)/this.Rdiag[u]);for(l=0;l<u;l++)for(h=0;h<i;h++)o.set(l,h,o.get(l,h)-o.get(u,h)*r.get(l,u))}return o.subMatrix(0,s-1,0,i-1)}isFullRank(){let e=this.QR.columns;for(let r=0;r<e;r++)if(this.Rdiag[r]===0)return!1;return!0}get upperTriangularMatrix(){let e=this.QR,r=e.columns,t=new x(r,r),i,o;for(i=0;i<r;i++)for(o=0;o<r;o++)i<o?t.set(i,o,e.get(i,o)):i===o?t.set(i,o,this.Rdiag[i]):t.set(i,o,0);return t}get orthogonalMatrix(){let e=this.QR,r=e.rows,t=e.columns,i=new x(r,t),o,s,l,h;for(l=t-1;l>=0;l--){for(o=0;o<r;o++)i.set(o,l,0);for(i.set(l,l,1),s=l;s<t;s++)if(e.get(l,l)!==0){for(h=0,o=l;o<r;o++)h+=e.get(o,l)*i.get(o,s);for(h=-h/e.get(l,l),o=l;o<r;o++)i.set(o,s,i.get(o,s)+h*e.get(o,l))}}return i}}class $e{constructor(e,r={}){if(e=dt.checkMatrix(e),e.isEmpty())throw new Error("Matrix must be non-empty");let t=e.rows,i=e.columns;const{computeLeftSingularVectors:o=!0,computeRightSingularVectors:s=!0,autoTranspose:l=!1}=r;let h=!!o,u=!!s,a=!1,f;if(t<i)if(!l)f=e.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{f=e.transpose(),t=f.rows,i=f.columns,a=!0;let c=h;h=u,u=c}else f=e.clone();let g=Math.min(t,i),d=Math.min(t+1,i),m=new Float64Array(d),p=new x(t,g),b=new x(i,i),v=new Float64Array(i),N=new Float64Array(t),S=new Float64Array(d);for(let c=0;c<d;c++)S[c]=c;let k=Math.min(t-1,i),E=Math.max(0,Math.min(i-2,t)),L=Math.max(k,E);for(let c=0;c<L;c++){if(c<k){m[c]=0;for(let w=c;w<t;w++)m[c]=ht(m[c],f.get(w,c));if(m[c]!==0){f.get(c,c)<0&&(m[c]=-m[c]);for(let w=c;w<t;w++)f.set(w,c,f.get(w,c)/m[c]);f.set(c,c,f.get(c,c)+1)}m[c]=-m[c]}for(let w=c+1;w<i;w++){if(c<k&&m[c]!==0){let M=0;for(let y=c;y<t;y++)M+=f.get(y,c)*f.get(y,w);M=-M/f.get(c,c);for(let y=c;y<t;y++)f.set(y,w,f.get(y,w)+M*f.get(y,c))}v[w]=f.get(c,w)}if(h&&c<k)for(let w=c;w<t;w++)p.set(w,c,f.get(w,c));if(c<E){v[c]=0;for(let w=c+1;w<i;w++)v[c]=ht(v[c],v[w]);if(v[c]!==0){v[c+1]<0&&(v[c]=0-v[c]);for(let w=c+1;w<i;w++)v[w]/=v[c];v[c+1]+=1}if(v[c]=-v[c],c+1<t&&v[c]!==0){for(let w=c+1;w<t;w++)N[w]=0;for(let w=c+1;w<t;w++)for(let M=c+1;M<i;M++)N[w]+=v[M]*f.get(w,M);for(let w=c+1;w<i;w++){let M=-v[w]/v[c+1];for(let y=c+1;y<t;y++)f.set(y,w,f.get(y,w)+M*N[y])}}if(u)for(let w=c+1;w<i;w++)b.set(w,c,v[w])}}let j=Math.min(i,t+1);if(k<i&&(m[k]=f.get(k,k)),t<j&&(m[j-1]=0),E+1<j&&(v[E]=f.get(E,j-1)),v[j-1]=0,h){for(let c=k;c<g;c++){for(let w=0;w<t;w++)p.set(w,c,0);p.set(c,c,1)}for(let c=k-1;c>=0;c--)if(m[c]!==0){for(let w=c+1;w<g;w++){let M=0;for(let y=c;y<t;y++)M+=p.get(y,c)*p.get(y,w);M=-M/p.get(c,c);for(let y=c;y<t;y++)p.set(y,w,p.get(y,w)+M*p.get(y,c))}for(let w=c;w<t;w++)p.set(w,c,-p.get(w,c));p.set(c,c,1+p.get(c,c));for(let w=0;w<c-1;w++)p.set(w,c,0)}else{for(let w=0;w<t;w++)p.set(w,c,0);p.set(c,c,1)}}if(u)for(let c=i-1;c>=0;c--){if(c<E&&v[c]!==0)for(let w=c+1;w<i;w++){let M=0;for(let y=c+1;y<i;y++)M+=b.get(y,c)*b.get(y,w);M=-M/b.get(c+1,c);for(let y=c+1;y<i;y++)b.set(y,w,b.get(y,w)+M*b.get(y,c))}for(let w=0;w<i;w++)b.set(w,c,0);b.set(c,c,1)}let T=j-1,U=Number.EPSILON;for(;j>0;){let c,w;for(c=j-2;c>=-1&&c!==-1;c--){const M=Number.MIN_VALUE+U*Math.abs(m[c]+Math.abs(m[c+1]));if(Math.abs(v[c])<=M||Number.isNaN(v[c])){v[c]=0;break}}if(c===j-2)w=4;else{let M;for(M=j-1;M>=c&&M!==c;M--){let y=(M!==j?Math.abs(v[M]):0)+(M!==c+1?Math.abs(v[M-1]):0);if(Math.abs(m[M])<=U*y){m[M]=0;break}}M===c?w=3:M===j-1?w=1:(w=2,c=M)}switch(c++,w){case 1:{let M=v[j-2];v[j-2]=0;for(let y=j-2;y>=c;y--){let F=ht(m[y],M),I=m[y]/F,$=M/F;if(m[y]=F,y!==c&&(M=-$*v[y-1],v[y-1]=I*v[y-1]),u)for(let P=0;P<i;P++)F=I*b.get(P,y)+$*b.get(P,j-1),b.set(P,j-1,-$*b.get(P,y)+I*b.get(P,j-1)),b.set(P,y,F)}break}case 2:{let M=v[c-1];v[c-1]=0;for(let y=c;y<j;y++){let F=ht(m[y],M),I=m[y]/F,$=M/F;if(m[y]=F,M=-$*v[y],v[y]=I*v[y],h)for(let P=0;P<t;P++)F=I*p.get(P,y)+$*p.get(P,c-1),p.set(P,c-1,-$*p.get(P,y)+I*p.get(P,c-1)),p.set(P,y,F)}break}case 3:{const M=Math.max(Math.abs(m[j-1]),Math.abs(m[j-2]),Math.abs(v[j-2]),Math.abs(m[c]),Math.abs(v[c])),y=m[j-1]/M,F=m[j-2]/M,I=v[j-2]/M,$=m[c]/M,P=v[c]/M,V=((F+y)*(F-y)+I*I)/2,O=y*I*(y*I);let B=0;(V!==0||O!==0)&&(V<0?B=0-Math.sqrt(V*V+O):B=Math.sqrt(V*V+O),B=O/(V+B));let ot=($+y)*($-y)+B,lt=$*P;for(let _=c;_<j-1;_++){let X=ht(ot,lt);X===0&&(X=Number.MIN_VALUE);let J=ot/X,Z=lt/X;if(_!==c&&(v[_-1]=X),ot=J*m[_]+Z*v[_],v[_]=J*v[_]-Z*m[_],lt=Z*m[_+1],m[_+1]=J*m[_+1],u)for(let Y=0;Y<i;Y++)X=J*b.get(Y,_)+Z*b.get(Y,_+1),b.set(Y,_+1,-Z*b.get(Y,_)+J*b.get(Y,_+1)),b.set(Y,_,X);if(X=ht(ot,lt),X===0&&(X=Number.MIN_VALUE),J=ot/X,Z=lt/X,m[_]=X,ot=J*v[_]+Z*m[_+1],m[_+1]=-Z*v[_]+J*m[_+1],lt=Z*v[_+1],v[_+1]=J*v[_+1],h&&_<t-1)for(let Y=0;Y<t;Y++)X=J*p.get(Y,_)+Z*p.get(Y,_+1),p.set(Y,_+1,-Z*p.get(Y,_)+J*p.get(Y,_+1)),p.set(Y,_,X)}v[j-2]=ot;break}case 4:{if(m[c]<=0&&(m[c]=m[c]<0?-m[c]:0,u))for(let M=0;M<=T;M++)b.set(M,c,-b.get(M,c));for(;c<T&&!(m[c]>=m[c+1]);){let M=m[c];if(m[c]=m[c+1],m[c+1]=M,u&&c<i-1)for(let y=0;y<i;y++)M=b.get(y,c+1),b.set(y,c+1,b.get(y,c)),b.set(y,c,M);if(h&&c<t-1)for(let y=0;y<t;y++)M=p.get(y,c+1),p.set(y,c+1,p.get(y,c)),p.set(y,c,M);c++}j--;break}}}if(a){let c=b;b=p,p=c}this.m=t,this.n=i,this.s=m,this.U=p,this.V=b}solve(e){let r=e,t=this.threshold,i=this.s.length,o=x.zeros(i,i);for(let g=0;g<i;g++)Math.abs(this.s[g])<=t?o.set(g,g,0):o.set(g,g,1/this.s[g]);let s=this.U,l=this.rightSingularVectors,h=l.mmul(o),u=l.rows,a=s.rows,f=x.zeros(u,a);for(let g=0;g<u;g++)for(let d=0;d<a;d++){let m=0;for(let p=0;p<i;p++)m+=h.get(g,p)*s.get(d,p);f.set(g,d,m)}return f.mmul(r)}solveForDiagonal(e){return this.solve(x.diag(e))}inverse(){let e=this.V,r=this.threshold,t=e.rows,i=e.columns,o=new x(t,this.s.length);for(let a=0;a<t;a++)for(let f=0;f<i;f++)Math.abs(this.s[f])>r&&o.set(a,f,e.get(a,f)/this.s[f]);let s=this.U,l=s.rows,h=s.columns,u=new x(t,l);for(let a=0;a<t;a++)for(let f=0;f<l;f++){let g=0;for(let d=0;d<h;d++)g+=o.get(a,d)*s.get(f,d);u.set(a,f,g)}return u}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let e=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,r=0,t=this.s;for(let i=0,o=t.length;i<o;i++)t[i]>e&&r++;return r}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return x.diag(this.s)}}function Vn(n,e=!1){return n=dt.checkMatrix(n),e?new $e(n).inverse():On(n,x.eye(n.rows))}function On(n,e,r=!1){return n=dt.checkMatrix(n),e=dt.checkMatrix(e),r?new $e(n).solve(e):n.isSquare()?new Fn(n).solve(e):new Tn(n).solve(e)}function Ln(n,e,r,t,i){const o=r.length,s=n.x.length;let l=new Array(o);for(let h=0;h<o;h++){l[h]=new Array(s);let u=r.slice();u[h]+=t;let a=i(u);for(let f=0;f<s;f++)l[h][f]=e[f]-a(n.x[f])}return new x(l)}function qn(n,e){const r=n.x.length;let t=new Array(r);for(let i=0;i<r;i++)t[i]=[n.y[i]-e[i]];return new x(t)}function Cn(n,e,r,t,i){let o=r*t*t,s=x.eye(e.length,e.length,o);const l=i(e);let h=new Float64Array(n.x.length);for(let g=0;g<n.x.length;g++)h[g]=l(n.x[g]);let u=Ln(n,h,e,t,i),a=qn(n,h),f=Vn(s.add(u.mmul(u.transpose())));return e=new x([e]),e=e.sub(f.mmul(u).mmul(a).mul(t).transpose()),e.to1DArray()}function Dn(n,e,r={}){let{maxIterations:t=100,gradientDifference:i=.1,damping:o=0,errorTolerance:s=.01,minValues:l,maxValues:h,initialValues:u}=r;if(o<=0)throw new Error("The damping option must be a positive number");if(!n.x||!n.y)throw new Error("The data parameter must have x and y elements");if(!At(n.x)||n.x.length<2||!At(n.y)||n.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(n.x.length!==n.y.length)throw new Error("The data parameter elements must have the same size");let a=u||new Array(e.length).fill(1),f=a.length;if(h=h||new Array(f).fill(Number.MAX_SAFE_INTEGER),l=l||new Array(f).fill(Number.MIN_SAFE_INTEGER),h.length!==l.length)throw new Error("minValues and maxValues must be the same size");if(!At(a))throw new Error("initialValues must be an array");let g=Se(n,a,e),d=g<=s,m;for(m=0;m<t&&!d;m++){a=Cn(n,a,o,i,e);for(let p=0;p<f;p++)a[p]=Math.min(Math.max(l[p],a[p]),h[p]);if(g=Se(n,a,e),isNaN(g))break;d=g<=s}return{parameterValues:a,parameterError:g,iterations:m}}var Bn=Object.freeze({__proto__:null,default:Dn}),Yn=fr(Bn),_e=z&&z.__awaiter||function(n,e,r,t){return new(r||(r=Promise))(function(i,o){function s(u){try{h(t.next(u))}catch(a){o(a)}}function l(u){try{h(t.throw(u))}catch(a){o(a)}}function h(u){u.done?i(u.value):new r(function(a){a(u.value)}).then(s,l)}h((t=t.apply(n,e||[])).next())})},ze=z&&z.__generator||function(n,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},t,i,o,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(u){return function(a){return h([u,a])}}function h(u){if(t)throw new TypeError("Generator is already executing.");for(;r;)try{if(t=1,i&&(o=u[0]&2?i.return:u[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,u[1])).done)return o;switch(i=0,o&&(u=[u[0]&2,o.value]),u[0]){case 0:case 1:o=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!o||u[1]>o[0]&&u[1]<o[3])){r.label=u[1];break}if(u[0]===6&&r.label<o[1]){r.label=o[1],o=u;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(u);break}o[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(n,r)}catch(a){u=[6,a],i=0}finally{t=o=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},te=z&&z.__read||function(n,e){var r=typeof Symbol=="function"&&n[Symbol.iterator];if(!r)return n;var t=r.call(n),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=t.next()).done;)o.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(r=t.return)&&r.call(t)}finally{if(s)throw s.error}}return o},Ie=z&&z.__spread||function(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(te(arguments[e]));return n},xt=z&&z.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var r in n)Object.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e.default=n,e},Un=z&&z.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(st,"__esModule",{value:!0});var Xn=xt(nt),q=xt(K),Tt=xt(gt),Pe=xt(ut),D=xt(C),Gn=Un(Yn),Fe=1e-5,Vt=.001,Wn=function(){function n(e){e===void 0&&(e={});var r=this;this.learningRate=1,this.localConnectivity=1,this.minDist=.1,this.nComponents=2,this.nEpochs=0,this.nNeighbors=15,this.negativeSampleRate=5,this.random=Math.random,this.repulsionStrength=1,this.setOpMixRatio=1,this.spread=1,this.transformQueueSize=4,this.targetMetric="categorical",this.targetWeight=.5,this.targetNNeighbors=this.nNeighbors,this.distanceFn=Te,this.isInitialized=!1,this.rpForest=[],this.embedding=[],this.optimizationState=new Qn;var t=function(i){e[i]!==void 0&&(r[i]=e[i])};t("distanceFn"),t("learningRate"),t("localConnectivity"),t("minDist"),t("nComponents"),t("nEpochs"),t("nNeighbors"),t("negativeSampleRate"),t("random"),t("repulsionStrength"),t("setOpMixRatio"),t("spread"),t("transformQueueSize")}return n.prototype.fit=function(e){return this.initializeFit(e),this.optimizeLayout(),this.embedding},n.prototype.fitAsync=function(e,r){return r===void 0&&(r=function(){return!0}),_e(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return this.initializeFit(e),[4,this.optimizeLayoutAsync(r)];case 1:return t.sent(),[2,this.embedding]}})})},n.prototype.setSupervisedProjection=function(e,r){r===void 0&&(r={}),this.Y=e,this.targetMetric=r.targetMetric||this.targetMetric,this.targetWeight=r.targetWeight||this.targetWeight,this.targetNNeighbors=r.targetNNeighbors||this.targetNNeighbors},n.prototype.setPrecomputedKNN=function(e,r){this.knnIndices=e,this.knnDistances=r},n.prototype.initializeFit=function(e){if(e.length<=this.nNeighbors)throw new Error("Not enough data points ("+e.length+") to create nNeighbors: "+this.nNeighbors+".  Add more data points or adjust the configuration.");if(this.X===e&&this.isInitialized)return this.getNEpochs();if(this.X=e,!this.knnIndices&&!this.knnDistances){var r=this.nearestNeighbors(e);this.knnIndices=r.knnIndices,this.knnDistances=r.knnDistances}this.graph=this.fuzzySimplicialSet(e,this.nNeighbors,this.setOpMixRatio),this.makeSearchFns(),this.searchGraph=this.makeSearchGraph(e),this.processGraphForSupervisedProjection();var t=this.initializeSimplicialSetEmbedding(),i=t.head,o=t.tail,s=t.epochsPerSample;return this.optimizationState.head=i,this.optimizationState.tail=o,this.optimizationState.epochsPerSample=s,this.initializeOptimization(),this.prepareForOptimizationLoop(),this.isInitialized=!0,this.getNEpochs()},n.prototype.makeSearchFns=function(){var e=Tt.makeInitializations(this.distanceFn),r=e.initFromTree,t=e.initFromRandom;this.initFromTree=r,this.initFromRandom=t,this.search=Tt.makeInitializedNNSearch(this.distanceFn)},n.prototype.makeSearchGraph=function(e){for(var r=this.knnIndices,t=this.knnDistances,i=[e.length,e.length],o=new q.SparseMatrix([],[],[],i),s=0;s<r.length;s++)for(var l=r[s],h=t[s],u=0;u<l.length;u++){var a=l[u],f=h[u];f>0&&o.set(s,a,f)}var g=q.transpose(o);return q.maximum(o,g)},n.prototype.transform=function(e){var r=this,t=this.X;if(t===void 0||t.length===0)throw new Error("No data has been fit.");var i=Math.floor(this.nNeighbors*this.transformQueueSize);i=Math.min(t.length,i);var o=Tt.initializeSearch(this.rpForest,t,e,i,this.initFromRandom,this.initFromTree,this.random),s=this.search(t,this.searchGraph,o,e),l=Xn.deheapSort(s),h=l.indices,u=l.weights;h=h.map(function(I){return I.slice(0,r.nNeighbors)}),u=u.map(function(I){return I.slice(0,r.nNeighbors)});var a=Math.max(0,this.localConnectivity-1),f=this.smoothKNNDistance(u,this.nNeighbors,a),g=f.sigmas,d=f.rhos,m=this.computeMembershipStrengths(h,u,g,d),p=m.rows,b=m.cols,v=m.vals,N=[e.length,t.length],S=new q.SparseMatrix(p,b,v,N),k=q.normalize(S,"l1"),E=q.getCSR(k),L=e.length,j=D.reshape2d(E.indices,L,this.nNeighbors),T=D.reshape2d(E.values,L,this.nNeighbors),U=De(j,T,this.embedding),c=this.nEpochs?this.nEpochs/3:S.nRows<=1e4?100:30,w=S.getValues().reduce(function(I,$){return $>I?$:I},0);S=S.map(function(I){return I<w/c?0:I}),S=q.eliminateZeros(S);var M=this.makeEpochsPerSample(S.getValues(),c),y=S.getRows(),F=S.getCols();return this.assignOptimizationStateParameters({headEmbedding:U,tailEmbedding:this.embedding,head:y,tail:F,currentEpoch:0,nEpochs:c,nVertices:S.getDims()[1],epochsPerSample:M}),this.prepareForOptimizationLoop(),this.optimizeLayout()},n.prototype.processGraphForSupervisedProjection=function(){var e=this,r=e.Y,t=e.X;if(r){if(r.length!==t.length)throw new Error("Length of X and y must be equal");if(this.targetMetric==="categorical"){var i=this.targetWeight<1,o=i?2.5*(1/(1-this.targetWeight)):1e12;this.graph=this.categoricalSimplicialSetIntersection(this.graph,r,o)}}},n.prototype.step=function(){var e=this.optimizationState.currentEpoch;return e<this.getNEpochs()&&this.optimizeLayoutStep(e),this.optimizationState.currentEpoch},n.prototype.getEmbedding=function(){return this.embedding},n.prototype.nearestNeighbors=function(e){var r=this,t=r.distanceFn,i=r.nNeighbors,o=function(m){return Math.log(m)/Math.log(2)},s=Tt.makeNNDescent(t,this.random),l=function(m){return m===.5?0:Math.round(m)},h=5+Math.floor(l(Math.pow(e.length,.5)/20)),u=Math.max(5,Math.floor(Math.round(o(e.length))));this.rpForest=Pe.makeForest(e,i,h,this.random);var a=Pe.makeLeafArray(this.rpForest),f=s(e,a,i,u),g=f.indices,d=f.weights;return{knnIndices:g,knnDistances:d}},n.prototype.fuzzySimplicialSet=function(e,r,t){t===void 0&&(t=1);var i=this,o=i.knnIndices,s=o===void 0?[]:o,l=i.knnDistances,h=l===void 0?[]:l,u=i.localConnectivity,a=this.smoothKNNDistance(h,r,u),f=a.sigmas,g=a.rhos,d=this.computeMembershipStrengths(s,h,f,g),m=d.rows,p=d.cols,b=d.vals,v=[e.length,e.length],N=new q.SparseMatrix(m,p,b,v),S=q.transpose(N),k=q.pairwiseMultiply(N,S),E=q.subtract(q.add(N,S),k),L=q.multiplyScalar(E,t),j=q.multiplyScalar(k,1-t),T=q.add(L,j);return T},n.prototype.categoricalSimplicialSetIntersection=function(e,r,t,i){i===void 0&&(i=1);var o=qe(e,r,i,t);return o=q.eliminateZeros(o),Ce(o)},n.prototype.smoothKNNDistance=function(e,r,t,i,o){t===void 0&&(t=1),i===void 0&&(i=64),o===void 0&&(o=1);for(var s=Math.log(r)/Math.log(2)*o,l=D.zeros(e.length),h=D.zeros(e.length),u=0;u<e.length;u++){var a=0,f=1/0,g=1,d=e[u],m=d.filter(function(j){return j>0});if(m.length>=t){var p=Math.floor(t),b=t-p;p>0?(l[u]=m[p-1],b>Fe&&(l[u]+=b*(m[p]-m[p-1]))):l[u]=b*m[0]}else m.length>0&&(l[u]=D.max(m));for(var v=0;v<i;v++){for(var N=0,S=1;S<e[u].length;S++){var k=e[u][S]-l[u];k>0?N+=Math.exp(-(k/g)):N+=1}if(Math.abs(N-s)<Fe)break;N>s?(f=g,g=(a+f)/2):(a=g,f===1/0?g*=2:g=(a+f)/2)}if(h[u]=g,l[u]>0){var E=D.mean(d);h[u]<Vt*E&&(h[u]=Vt*E)}else{var L=D.mean(e.map(D.mean));h[u]<Vt*L&&(h[u]=Vt*L)}}return{sigmas:h,rhos:l}},n.prototype.computeMembershipStrengths=function(e,r,t,i){for(var o=e.length,s=e[0].length,l=D.zeros(o*s),h=D.zeros(o*s),u=D.zeros(o*s),a=0;a<o;a++)for(var f=0;f<s;f++){var g=0;e[a][f]!==-1&&(e[a][f]===a?g=0:r[a][f]-i[a]<=0?g=1:g=Math.exp(-((r[a][f]-i[a])/t[a])),l[a*s+f]=a,h[a*s+f]=e[a][f],u[a*s+f]=g)}return{rows:l,cols:h,vals:u}},n.prototype.initializeSimplicialSetEmbedding=function(){for(var e=this,r=this.getNEpochs(),t=this.nComponents,i=this.graph.getValues(),o=0,s=0;s<i.length;s++){var l=i[s];o<i[s]&&(o=l)}var h=this.graph.map(function(p){return p<o/r?0:p});this.embedding=D.zeros(h.nRows).map(function(){return D.zeros(t).map(function(){return D.tauRand(e.random)*20+-10})});for(var u=[],a=[],f=[],g=h.getAll(),s=0;s<g.length;s++){var d=g[s];d.value&&(u.push(d.value),f.push(d.row),a.push(d.col))}var m=this.makeEpochsPerSample(u,r);return{head:a,tail:f,epochsPerSample:m}},n.prototype.makeEpochsPerSample=function(e,r){var t=D.filled(e.length,-1),i=D.max(e),o=e.map(function(s){return s/i*r});return o.forEach(function(s,l){s>0&&(t[l]=r/o[l])}),t},n.prototype.assignOptimizationStateParameters=function(e){Object.assign(this.optimizationState,e)},n.prototype.prepareForOptimizationLoop=function(){var e=this,r=e.repulsionStrength,t=e.learningRate,i=e.negativeSampleRate,o=this.optimizationState,s=o.epochsPerSample,l=o.headEmbedding,h=o.tailEmbedding,u=l[0].length,a=l.length===h.length,f=s.map(function(m){return m/i}),g=Ie(f),d=Ie(s);this.assignOptimizationStateParameters({epochOfNextSample:d,epochOfNextNegativeSample:g,epochsPerNegativeSample:f,moveOther:a,initialAlpha:t,alpha:t,gamma:r,dim:u})},n.prototype.initializeOptimization=function(){var e=this.embedding,r=this.embedding,t=this.optimizationState,i=t.head,o=t.tail,s=t.epochsPerSample,l=this.getNEpochs(),h=this.graph.nCols,u=Le(this.spread,this.minDist),a=u.a,f=u.b;this.assignOptimizationStateParameters({headEmbedding:e,tailEmbedding:r,head:i,tail:o,epochsPerSample:s,a,b:f,nEpochs:l,nVertices:h})},n.prototype.optimizeLayoutStep=function(e){for(var r=this.optimizationState,t=r.head,i=r.tail,o=r.headEmbedding,s=r.tailEmbedding,l=r.epochsPerSample,h=r.epochOfNextSample,u=r.epochOfNextNegativeSample,a=r.epochsPerNegativeSample,f=r.moveOther,g=r.initialAlpha,d=r.alpha,m=r.gamma,p=r.a,b=r.b,v=r.dim,N=r.nEpochs,S=r.nVertices,k=4,E=0;E<l.length;E++)if(!(h[E]>e)){var L=t[E],j=i[E],T=o[L],U=s[j],c=Oe(T,U),w=0;c>0&&(w=-2*p*b*Math.pow(c,b-1),w/=p*Math.pow(c,b)+1);for(var M=0;M<v;M++){var y=Ve(w*(T[M]-U[M]),k);T[M]+=y*d,f&&(U[M]+=-y*d)}h[E]+=l[E];for(var F=Math.floor((e-u[E])/a[E]),I=0;I<F;I++){var $=D.tauRandInt(S,this.random),P=s[$],V=Oe(T,P),O=0;if(V>0)O=2*m*b,O/=(.001+V)*(p*Math.pow(V,b)+1);else if(L===$)continue;for(var M=0;M<v;M++){var y=4;O>0&&(y=Ve(O*(T[M]-P[M]),k)),T[M]+=y*d}}u[E]+=F*a[E]}return r.alpha=g*(1-e/N),r.currentEpoch+=1,o},n.prototype.optimizeLayoutAsync=function(e){var r=this;return e===void 0&&(e=function(){return!0}),new Promise(function(t,i){var o=function(){return _e(r,void 0,void 0,function(){var s,l,h,u,a,f;return ze(this,function(g){try{if(s=this.optimizationState,l=s.nEpochs,h=s.currentEpoch,this.embedding=this.optimizeLayoutStep(h),u=this.optimizationState.currentEpoch,a=e(u)===!1,f=u===l,!a&&!f)setTimeout(function(){return o()},0);else return[2,t(f)]}catch(d){i(d)}return[2]})})};setTimeout(function(){return o()},0)})},n.prototype.optimizeLayout=function(e){e===void 0&&(e=function(){return!0});for(var r=!1,t=[];!r;){var i=this.optimizationState,o=i.nEpochs,s=i.currentEpoch;t=this.optimizeLayoutStep(s);var l=this.optimizationState.currentEpoch,h=e(l)===!1;r=l===o||h}return t},n.prototype.getNEpochs=function(){var e=this.graph;if(this.nEpochs>0)return this.nEpochs;var r=e.nRows;return r<=2500?500:r<=5e3?400:r<=7500?300:200},n}();st.UMAP=Wn;function Te(n,e){for(var r=0,t=0;t<n.length;t++)r+=Math.pow(n[t]-e[t],2);return Math.sqrt(r)}st.euclidean=Te;function Kn(n,e){for(var r=0,t=0,i=0,o=0;o<n.length;o++)r+=n[o]*e[o],t+=Math.pow(n[o],2),i+=Math.pow(e[o],2);return t===0&&i===0?0:t===0||i===0?1:1-r/Math.sqrt(t*i)}st.cosine=Kn;var Qn=function(){function n(){this.currentEpoch=0,this.headEmbedding=[],this.tailEmbedding=[],this.head=[],this.tail=[],this.epochsPerSample=[],this.epochOfNextSample=[],this.epochOfNextNegativeSample=[],this.epochsPerNegativeSample=[],this.moveOther=!0,this.initialAlpha=1,this.alpha=1,this.gamma=1,this.a=1.5769434603113077,this.b=.8950608779109733,this.dim=2,this.nEpochs=500,this.nVertices=0}return n}();function Ve(n,e){return n>e?e:n<-e?-e:n}function Oe(n,e){for(var r=0,t=0;t<n.length;t++)r+=Math.pow(n[t]-e[t],2);return r}function Le(n,e){var r=function(g){var d=te(g,2),m=d[0],p=d[1];return function(b){return 1/(1+m*Math.pow(b,2*p))}},t=D.linear(0,n*3,300).map(function(g){return g<e?1:g}),i=D.zeros(t.length).map(function(g,d){var m=t[d]>=e;return m?Math.exp(-(t[d]-e)/n):g}),o=[.5,.5],s={x:t,y:i},l={damping:1.5,initialValues:o,gradientDifference:.1,maxIterations:100,errorTolerance:.01},h=Gn.default(s,r,l).parameterValues,u=te(h,2),a=u[0],f=u[1];return{a,b:f}}st.findABParams=Le;function qe(n,e,r,t){return r===void 0&&(r=1),t===void 0&&(t=5),n.map(function(i,o,s){return e[o]===-1||e[s]===-1?i*Math.exp(-r):e[o]!==e[s]?i*Math.exp(-t):i})}st.fastIntersection=qe;function Ce(n){n=q.normalize(n,"max");var e=q.transpose(n),r=q.pairwiseMultiply(e,n);return n=q.add(n,q.subtract(e,r)),q.eliminateZeros(n)}st.resetLocalConnectivity=Ce;function De(n,e,r){for(var t=D.zeros(n.length).map(function(h){return D.zeros(r[0].length)}),i=0;i<n.length;i++)for(var o=0;o<n[0].length;o++)for(var s=0;s<r[0].length;s++){var l=n[i][o];t[i][s]+=e[i][o]*r[l][s]}return t}st.initTransform=De,Object.defineProperty(fe,"__esModule",{value:!0});var Hn=st,Jn=fe.UMAP=Hn.UMAP;function Ot(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function Zn(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function Be(n){let e,r,t;n.length!==2?(e=Ot,r=(l,h)=>Ot(n(l),h),t=(l,h)=>n(l)-h):(e=n===Ot||n===Zn?n:An,r=n,t=n);function i(l,h,u=0,a=l.length){if(u<a){if(e(h,h)!==0)return a;do{const f=u+a>>>1;r(l[f],h)<0?u=f+1:a=f}while(u<a)}return u}function o(l,h,u=0,a=l.length){if(u<a){if(e(h,h)!==0)return a;do{const f=u+a>>>1;r(l[f],h)<=0?u=f+1:a=f}while(u<a)}return u}function s(l,h,u=0,a=l.length){const f=i(l,h,u,a-1);return f>u&&t(l[f-1],h)>-t(l[f],h)?f-1:f}return{left:i,center:s,right:o}}function An(){return 0}function ti(n){return n===null?NaN:+n}const ei=Be(Ot).right;Be(ti).center;var ri=ei;const ni=Math.sqrt(50),ii=Math.sqrt(10),oi=Math.sqrt(2);function Lt(n,e,r){const t=(e-n)/Math.max(0,r),i=Math.floor(Math.log10(t)),o=t/Math.pow(10,i),s=o>=ni?10:o>=ii?5:o>=oi?2:1;let l,h,u;return i<0?(u=Math.pow(10,-i)/s,l=Math.round(n*u),h=Math.round(e*u),l/u<n&&++l,h/u>e&&--h,u=-u):(u=Math.pow(10,i)*s,l=Math.round(n/u),h=Math.round(e/u),l*u<n&&++l,h*u>e&&--h),h<l&&.5<=r&&r<2?Lt(n,e,r*2):[l,h,u]}function si(n,e,r){if(e=+e,n=+n,r=+r,!(r>0))return[];if(n===e)return[n];const t=e<n,[i,o,s]=t?Lt(e,n,r):Lt(n,e,r);if(!(o>=i))return[];const l=o-i+1,h=new Array(l);if(t)if(s<0)for(let u=0;u<l;++u)h[u]=(o-u)/-s;else for(let u=0;u<l;++u)h[u]=(o-u)*s;else if(s<0)for(let u=0;u<l;++u)h[u]=(i+u)/-s;else for(let u=0;u<l;++u)h[u]=(i+u)*s;return h}function ee(n,e,r){return e=+e,n=+n,r=+r,Lt(n,e,r)[2]}function li(n,e,r){e=+e,n=+n,r=+r;const t=e<n,i=t?ee(e,n,r):ee(n,e,r);return(t?-1:1)*(i<0?1/-i:i)}function ui(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function re(n,e,r){n.prototype=e.prototype=r,r.constructor=n}function Ye(n,e){var r=Object.create(n.prototype);for(var t in e)r[t]=e[t];return r}function Et(){}var Nt=.7,qt=1/Nt,vt="\\s*([+-]?\\d+)\\s*",kt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",it="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",hi=/^#([0-9a-f]{3,8})$/,ai=new RegExp(`^rgb\\(${vt},${vt},${vt}\\)$`),fi=new RegExp(`^rgb\\(${it},${it},${it}\\)$`),ci=new RegExp(`^rgba\\(${vt},${vt},${vt},${kt}\\)$`),gi=new RegExp(`^rgba\\(${it},${it},${it},${kt}\\)$`),mi=new RegExp(`^hsl\\(${kt},${it},${it}\\)$`),pi=new RegExp(`^hsla\\(${kt},${it},${it},${kt}\\)$`),Ue={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};re(Et,jt,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:Xe,formatHex:Xe,formatHex8:wi,formatHsl:di,formatRgb:Ge,toString:Ge});function Xe(){return this.rgb().formatHex()}function wi(){return this.rgb().formatHex8()}function di(){return Je(this).formatHsl()}function Ge(){return this.rgb().formatRgb()}function jt(n){var e,r;return n=(n+"").trim().toLowerCase(),(e=hi.exec(n))?(r=e[1].length,e=parseInt(e[1],16),r===6?We(e):r===3?new Q(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?Ct(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?Ct(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=ai.exec(n))?new Q(e[1],e[2],e[3],1):(e=fi.exec(n))?new Q(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=ci.exec(n))?Ct(e[1],e[2],e[3],e[4]):(e=gi.exec(n))?Ct(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=mi.exec(n))?He(e[1],e[2]/100,e[3]/100,1):(e=pi.exec(n))?He(e[1],e[2]/100,e[3]/100,e[4]):Ue.hasOwnProperty(n)?We(Ue[n]):n==="transparent"?new Q(NaN,NaN,NaN,0):null}function We(n){return new Q(n>>16&255,n>>8&255,n&255,1)}function Ct(n,e,r,t){return t<=0&&(n=e=r=NaN),new Q(n,e,r,t)}function vi(n){return n instanceof Et||(n=jt(n)),n?(n=n.rgb(),new Q(n.r,n.g,n.b,n.opacity)):new Q}function ne(n,e,r,t){return arguments.length===1?vi(n):new Q(n,e,r,t??1)}function Q(n,e,r,t){this.r=+n,this.g=+e,this.b=+r,this.opacity=+t}re(Q,ne,Ye(Et,{brighter(n){return n=n==null?qt:Math.pow(qt,n),new Q(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Nt:Math.pow(Nt,n),new Q(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Q(at(this.r),at(this.g),at(this.b),Dt(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ke,formatHex:Ke,formatHex8:yi,formatRgb:Qe,toString:Qe}));function Ke(){return`#${ft(this.r)}${ft(this.g)}${ft(this.b)}`}function yi(){return`#${ft(this.r)}${ft(this.g)}${ft(this.b)}${ft((isNaN(this.opacity)?1:this.opacity)*255)}`}function Qe(){const n=Dt(this.opacity);return`${n===1?"rgb(":"rgba("}${at(this.r)}, ${at(this.g)}, ${at(this.b)}${n===1?")":`, ${n})`}`}function Dt(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function at(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function ft(n){return n=at(n),(n<16?"0":"")+n.toString(16)}function He(n,e,r,t){return t<=0?n=e=r=NaN:r<=0||r>=1?n=e=NaN:e<=0&&(n=NaN),new et(n,e,r,t)}function Je(n){if(n instanceof et)return new et(n.h,n.s,n.l,n.opacity);if(n instanceof Et||(n=jt(n)),!n)return new et;if(n instanceof et)return n;n=n.rgb();var e=n.r/255,r=n.g/255,t=n.b/255,i=Math.min(e,r,t),o=Math.max(e,r,t),s=NaN,l=o-i,h=(o+i)/2;return l?(e===o?s=(r-t)/l+(r<t)*6:r===o?s=(t-e)/l+2:s=(e-r)/l+4,l/=h<.5?o+i:2-o-i,s*=60):l=h>0&&h<1?0:s,new et(s,l,h,n.opacity)}function bi(n,e,r,t){return arguments.length===1?Je(n):new et(n,e,r,t??1)}function et(n,e,r,t){this.h=+n,this.s=+e,this.l=+r,this.opacity=+t}re(et,bi,Ye(Et,{brighter(n){return n=n==null?qt:Math.pow(qt,n),new et(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Nt:Math.pow(Nt,n),new et(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,r=this.l,t=r+(r<.5?r:1-r)*e,i=2*r-t;return new Q(ie(n>=240?n-240:n+120,i,t),ie(n,i,t),ie(n<120?n+240:n-120,i,t),this.opacity)},clamp(){return new et(Ze(this.h),Bt(this.s),Bt(this.l),Dt(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=Dt(this.opacity);return`${n===1?"hsl(":"hsla("}${Ze(this.h)}, ${Bt(this.s)*100}%, ${Bt(this.l)*100}%${n===1?")":`, ${n})`}`}}));function Ze(n){return n=(n||0)%360,n<0?n+360:n}function Bt(n){return Math.max(0,Math.min(1,n||0))}function ie(n,e,r){return(n<60?e+(r-e)*n/60:n<180?r:n<240?e+(r-e)*(240-n)/60:e)*255}var oe=n=>()=>n;function Mi(n,e){return function(r){return n+r*e}}function Si(n,e,r){return n=Math.pow(n,r),e=Math.pow(e,r)-n,r=1/r,function(t){return Math.pow(n+t*e,r)}}function xi(n){return(n=+n)==1?Ae:function(e,r){return r-e?Si(e,r,n):oe(isNaN(e)?r:e)}}function Ae(n,e){var r=e-n;return r?Mi(n,r):oe(isNaN(n)?e:n)}var tr=function n(e){var r=xi(e);function t(i,o){var s=r((i=ne(i)).r,(o=ne(o)).r),l=r(i.g,o.g),h=r(i.b,o.b),u=Ae(i.opacity,o.opacity);return function(a){return i.r=s(a),i.g=l(a),i.b=h(a),i.opacity=u(a),i+""}}return t.gamma=n,t}(1);function Ei(n,e){e||(e=[]);var r=n?Math.min(e.length,n.length):0,t=e.slice(),i;return function(o){for(i=0;i<r;++i)t[i]=n[i]*(1-o)+e[i]*o;return t}}function Ni(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function ki(n,e){var r=e?e.length:0,t=n?Math.min(r,n.length):0,i=new Array(t),o=new Array(r),s;for(s=0;s<t;++s)i[s]=ue(n[s],e[s]);for(;s<r;++s)o[s]=e[s];return function(l){for(s=0;s<t;++s)o[s]=i[s](l);return o}}function ji(n,e){var r=new Date;return n=+n,e=+e,function(t){return r.setTime(n*(1-t)+e*t),r}}function Yt(n,e){return n=+n,e=+e,function(r){return n*(1-r)+e*r}}function Ri(n,e){var r={},t={},i;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in n?r[i]=ue(n[i],e[i]):t[i]=e[i];return function(o){for(i in r)t[i]=r[i](o);return t}}var se=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,le=new RegExp(se.source,"g");function $i(n){return function(){return n}}function _i(n){return function(e){return n(e)+""}}function zi(n,e){var r=se.lastIndex=le.lastIndex=0,t,i,o,s=-1,l=[],h=[];for(n=n+"",e=e+"";(t=se.exec(n))&&(i=le.exec(e));)(o=i.index)>r&&(o=e.slice(r,o),l[s]?l[s]+=o:l[++s]=o),(t=t[0])===(i=i[0])?l[s]?l[s]+=i:l[++s]=i:(l[++s]=null,h.push({i:s,x:Yt(t,i)})),r=le.lastIndex;return r<e.length&&(o=e.slice(r),l[s]?l[s]+=o:l[++s]=o),l.length<2?h[0]?_i(h[0].x):$i(e):(e=h.length,function(u){for(var a=0,f;a<e;++a)l[(f=h[a]).i]=f.x(u);return l.join("")})}function ue(n,e){var r=typeof e,t;return e==null||r==="boolean"?oe(e):(r==="number"?Yt:r==="string"?(t=jt(e))?(e=t,tr):zi:e instanceof jt?tr:e instanceof Date?ji:Ni(e)?Ei:Array.isArray(e)?ki:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Ri:Yt)(n,e)}function Ii(n,e){return n=+n,e=+e,function(r){return Math.round(n*(1-r)+e*r)}}function Pi(n){return function(){return n}}function Fi(n){return+n}var er=[0,1];function yt(n){return n}function he(n,e){return(e-=n=+n)?function(r){return(r-n)/e}:Pi(isNaN(e)?NaN:.5)}function Ti(n,e){var r;return n>e&&(r=n,n=e,e=r),function(t){return Math.max(n,Math.min(e,t))}}function Vi(n,e,r){var t=n[0],i=n[1],o=e[0],s=e[1];return i<t?(t=he(i,t),o=r(s,o)):(t=he(t,i),o=r(o,s)),function(l){return o(t(l))}}function Oi(n,e,r){var t=Math.min(n.length,e.length)-1,i=new Array(t),o=new Array(t),s=-1;for(n[t]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++s<t;)i[s]=he(n[s],n[s+1]),o[s]=r(e[s],e[s+1]);return function(l){var h=ri(n,l,1,t)-1;return o[h](i[h](l))}}function Li(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function qi(){var n=er,e=er,r=ue,t,i,o,s=yt,l,h,u;function a(){var g=Math.min(n.length,e.length);return s!==yt&&(s=Ti(n[0],n[g-1])),l=g>2?Oi:Vi,h=u=null,f}function f(g){return g==null||isNaN(g=+g)?o:(h||(h=l(n.map(t),e,r)))(t(s(g)))}return f.invert=function(g){return s(i((u||(u=l(e,n.map(t),Yt)))(g)))},f.domain=function(g){return arguments.length?(n=Array.from(g,Fi),a()):n.slice()},f.range=function(g){return arguments.length?(e=Array.from(g),a()):e.slice()},f.rangeRound=function(g){return e=Array.from(g),r=Ii,a()},f.clamp=function(g){return arguments.length?(s=g?!0:yt,a()):s!==yt},f.interpolate=function(g){return arguments.length?(r=g,a()):r},f.unknown=function(g){return arguments.length?(o=g,f):o},function(g,d){return t=g,i=d,a()}}function Ci(){return qi()(yt,yt)}function Di(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function Ut(n,e){if((r=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var r,t=n.slice(0,r);return[t.length>1?t[0]+t.slice(2):t,+n.slice(r+1)]}function bt(n){return n=Ut(Math.abs(n)),n?n[1]:NaN}function Bi(n,e){return function(r,t){for(var i=r.length,o=[],s=0,l=n[0],h=0;i>0&&l>0&&(h+l+1>t&&(l=Math.max(1,t-h)),o.push(r.substring(i-=l,i+l)),!((h+=l+1)>t));)l=n[s=(s+1)%n.length];return o.reverse().join(e)}}function Yi(n){return function(e){return e.replace(/[0-9]/g,function(r){return n[+r]})}}var Ui=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Xt(n){if(!(e=Ui.exec(n)))throw new Error("invalid format: "+n);var e;return new ae({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Xt.prototype=ae.prototype;function ae(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}ae.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Xi(n){t:for(var e=n.length,r=1,t=-1,i;r<e;++r)switch(n[r]){case".":t=i=r;break;case"0":t===0&&(t=r),i=r;break;default:if(!+n[r])break t;t>0&&(t=0);break}return t>0?n.slice(0,t)+n.slice(i+1):n}var rr;function Gi(n,e){var r=Ut(n,e);if(!r)return n+"";var t=r[0],i=r[1],o=i-(rr=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=t.length;return o===s?t:o>s?t+new Array(o-s+1).join("0"):o>0?t.slice(0,o)+"."+t.slice(o):"0."+new Array(1-o).join("0")+Ut(n,Math.max(0,e+o-1))[0]}function nr(n,e){var r=Ut(n,e);if(!r)return n+"";var t=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+t:t.length>i+1?t.slice(0,i+1)+"."+t.slice(i+1):t+new Array(i-t.length+2).join("0")}var ir={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:Di,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>nr(n*100,e),r:nr,s:Gi,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function or(n){return n}var sr=Array.prototype.map,lr=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Wi(n){var e=n.grouping===void 0||n.thousands===void 0?or:Bi(sr.call(n.grouping,Number),n.thousands+""),r=n.currency===void 0?"":n.currency[0]+"",t=n.currency===void 0?"":n.currency[1]+"",i=n.decimal===void 0?".":n.decimal+"",o=n.numerals===void 0?or:Yi(sr.call(n.numerals,String)),s=n.percent===void 0?"%":n.percent+"",l=n.minus===void 0?"":n.minus+"",h=n.nan===void 0?"NaN":n.nan+"";function u(f){f=Xt(f);var g=f.fill,d=f.align,m=f.sign,p=f.symbol,b=f.zero,v=f.width,N=f.comma,S=f.precision,k=f.trim,E=f.type;E==="n"?(N=!0,E="g"):ir[E]||(S===void 0&&(S=12),k=!0,E="g"),(b||g==="0"&&d==="=")&&(b=!0,g="0",d="=");var L=p==="$"?r:p==="#"&&/[boxX]/.test(E)?"0"+E.toLowerCase():"",j=p==="$"?t:/[%p]/.test(E)?s:"",T=ir[E],U=/[defgprs%]/.test(E);S=S===void 0?6:/[gprs]/.test(E)?Math.max(1,Math.min(21,S)):Math.max(0,Math.min(20,S));function c(w){var M=L,y=j,F,I,$;if(E==="c")y=T(w)+y,w="";else{w=+w;var P=w<0||1/w<0;if(w=isNaN(w)?h:T(Math.abs(w),S),k&&(w=Xi(w)),P&&+w==0&&m!=="+"&&(P=!1),M=(P?m==="("?m:l:m==="-"||m==="("?"":m)+M,y=(E==="s"?lr[8+rr/3]:"")+y+(P&&m==="("?")":""),U){for(F=-1,I=w.length;++F<I;)if($=w.charCodeAt(F),48>$||$>57){y=($===46?i+w.slice(F+1):w.slice(F))+y,w=w.slice(0,F);break}}}N&&!b&&(w=e(w,1/0));var V=M.length+w.length+y.length,O=V<v?new Array(v-V+1).join(g):"";switch(N&&b&&(w=e(O+w,O.length?v-y.length:1/0),O=""),d){case"<":w=M+w+y+O;break;case"=":w=M+O+w+y;break;case"^":w=O.slice(0,V=O.length>>1)+M+w+y+O.slice(V);break;default:w=O+M+w+y;break}return o(w)}return c.toString=function(){return f+""},c}function a(f,g){var d=u((f=Xt(f),f.type="f",f)),m=Math.max(-8,Math.min(8,Math.floor(bt(g)/3)))*3,p=Math.pow(10,-m),b=lr[8+m/3];return function(v){return d(p*v)+b}}return{format:u,formatPrefix:a}}var Gt,ur,hr;Ki({thousands:",",grouping:[3],currency:["$",""]});function Ki(n){return Gt=Wi(n),ur=Gt.format,hr=Gt.formatPrefix,Gt}function Qi(n){return Math.max(0,-bt(Math.abs(n)))}function Hi(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(bt(e)/3)))*3-bt(Math.abs(n)))}function Ji(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,bt(e)-bt(n))+1}function Zi(n,e,r,t){var i=li(n,e,r),o;switch(t=Xt(t??",f"),t.type){case"s":{var s=Math.max(Math.abs(n),Math.abs(e));return t.precision==null&&!isNaN(o=Hi(i,s))&&(t.precision=o),hr(t,s)}case"":case"e":case"g":case"p":case"r":{t.precision==null&&!isNaN(o=Ji(i,Math.max(Math.abs(n),Math.abs(e))))&&(t.precision=o-(t.type==="e"));break}case"f":case"%":{t.precision==null&&!isNaN(o=Qi(i))&&(t.precision=o-(t.type==="%")*2);break}}return ur(t)}function Ai(n){var e=n.domain;return n.ticks=function(r){var t=e();return si(t[0],t[t.length-1],r??10)},n.tickFormat=function(r,t){var i=e();return Zi(i[0],i[i.length-1],r??10,t)},n.nice=function(r){r==null&&(r=10);var t=e(),i=0,o=t.length-1,s=t[i],l=t[o],h,u,a=10;for(l<s&&(u=s,s=l,l=u,u=i,i=o,o=u);a-- >0;){if(u=ee(s,l,r),u===h)return t[i]=s,t[o]=l,e(t);if(u>0)s=Math.floor(s/u)*u,l=Math.ceil(l/u)*u;else if(u<0)s=Math.ceil(s*u)/u,l=Math.floor(l*u)/u;else break;h=u}return n},n}function rt(){var n=Ci();return n.copy=function(){return Li(n,rt())},ui.apply(n,arguments),Ai(n)}function ar(n){let e=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;return n.forEach(t=>{e=Math.min(e,t),r=Math.max(r,t)}),[e,r]}function to(n){let e=1e3,r=-1e3,t=1e3,i=-1e3;return n.forEach(o=>{e=Math.min(e,o.x),r=Math.max(r,o.x),t=Math.min(t,o.y),i=Math.max(i,o.y)}),{minX:e,maxX:r,minY:t,maxY:i,centerX:(e+r)/2,centerY:(t+i)/2,extentX:r-e,extentY:i-t}}function eo(n){const e=to(n);let r,t;if(e.extentX>=e.extentY){const i=e.extentY/e.extentX;r=rt().domain([e.minX,e.maxX]).range([0,1]),t=rt().domain([e.minY,e.maxY]).range([1-i,i])}else{const i=e.extentX/e.extentY;r=rt().domain([e.minX,e.maxX]).range([1-i,i]),t=rt().domain([e.minY,e.maxY]).range([0,1])}return n.map(i=>({x:r(i.x),y:t(i.y)}))}const ro=.012;function no(n){const e=500/n.width,r=rt().domain([0,1]).range([0,n.width*e]),t=rt().domain([0,1]).range([0,n.height*e]),i=rt().domain([0,1]).range([n.x+n.width*.01,n.x+n.width*.99]),o=rt().domain([0,1]).range([n.y+n.height*.01,n.y+n.height*.99]);return[r,t,i,o,ro*e]}self.onmessage=({data:{X:n,D:e,N:r,area:t,type:i,xLayout:o,yLayout:s,axis:l}})=>{if(i!=="init")return;const h=l==="xy"?2:1;self.postMessage({type:"message",message:"Calculating embedding ..."});const a=new Jn({nComponents:h,nEpochs:200,nNeighbors:15}).fit(n);let f;if(l==="x"){const v=a.map(S=>S[0]),N=rt().domain(ar(v)).range([0,1]);f=v.map((S,k)=>({x:N(S),y:s[k]}))}else if(l==="y"){const v=a.map(S=>S[0]),N=rt().domain(ar(v)).range([0,1]);f=v.map((S,k)=>({y:N(S),x:o[k]}))}else l==="xy"&&(f=a.map(v=>({x:v[0],y:v[1]})),f=eo(f));structuredClone(f);const[g,d,m,p,b]=no(t);self.postMessage({type:"message",message:"Force layout ..."}),self.postMessage({type:"finish",Y:f.map(v=>({x:m(v.x),y:p(v.y)})),xLayout:f.map(v=>v.x),yLayout:f.map(v=>v.y)})}})();
